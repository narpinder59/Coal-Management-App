<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Calculator</title>

<!--JSPDF CDN-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js">    </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Generate PDF  bby Including the jsPDF library in HTML -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<!-- Include Bootstrap CSS (you can use a CDN link) -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<!-- Include a manifest file for PWA -->
<link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.bundle.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

<!-- Add this line to include Font Awesome CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-dziQRd3wxnWwH4qwqH6fJf77xlSzN9UwMy1hvTqzW6k1e5J6L6tNLeH6qF6Sv9N" crossorigin="anonymous">

<!--Bootstrap Icons library-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<!-- Include jsPDF library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Include jsPDF AutoTable library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.22/jspdf.plugin.autotable.min.js"></script>

<style>

/* Style for the active accordion tab button */
.accordion-button:not(.collapsed) {
        background-color: #65d30a; /* Change this to your desired color */
        color: #fff; /* Change this to the text color you prefer */
    }

/* Defination of Calculator in accordion tab */ 
.calulatordiscription {  color: rgb(7, 7, 7); text-align: center; margin-top: 1;  }

.resultStyle{color: rgb(136, 209, 26); 
    font-size: 12px; 
    text-align: left; 
    margin-top: 2px; 
    margin-bottom: 2px;
    padding: 2px;
    background-color: #000000; /* Light background for better contrast */
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.resultcardStyle{border-radius: 10px; width: fit-content
; display:none; background-color: #000000; /* Light background for better contrast */ 
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
    


/* Define a custom background color for the active tab */
.active-tab { 
    background-color: rgb(114, 114, 114); /* Change this to your desired color */
            }

/* Your CSS styles here */
.custom-table {
    border: 2px solid #ccc;
    border-collapse: collapse;
    width: 100%;
    font-size: 10px; /* Adjust the font size as needed */
}

/* Style for odd rows */
.custom-table tr:nth-child(odd) {
    background-color: #ffffff; /* You can change this color to your preference */
}

/* Style for even rows */
.custom-table tr:nth-child(even) {
    background-color: #bcbcbc; /* You can change this color to your preference */
}

/* Reduce padding and width for table cells */
.custom-table th,
.custom-table td {
    padding: 4px; /* Adjust as needed to reduce cell padding */
    width: auto; /* Adjust as needed to reduce cell width */
    max-width: 80px; /* Set a maximum width for cells to prevent excessive stretching */
    border: 1.5px solid #4a4949;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: text-top; /* Align cell content to the top */
    font-size: 12px; /* Adjust the font size as needed */
    font-weight: bold;
    text-align:center ;

}

.custom-table th {
    background: linear-gradient(45deg, #343a40, #495057);
    color: #fff;
    vertical-align: top !important;         /* Center text vertically */
    white-space: normal;            /* Allow header text to wrap */
    word-break: break-word;         /* Break long words */
    padding: 4px 3px;               /* More padding for better spacing */
    font-size: 1rem;                /* Larger font for headers */
    font-weight: 500;               /* Bolder header text */
    letter-spacing: 0.03em;         /* Slightly more space between letters */
    border-bottom: 2.5px solid #198754; /* Accent border for separation */
    text-align: center;             /* Center align header text */
    box-shadow: 0 2px 6px rgba(0,0,0,0.07); /* Subtle shadow for depth */
    position: sticky;               /* Keep header visible on scroll */
    top: 0;
    z-index: 2;
    /* Optional: Add a hover effect for interactivity */
    transition: background 0.2s, color 0.2s;
}
.custom-table th:hover {
    background: linear-gradient(45deg, #495057, #343a40);
    color: #ffe066;
    cursor: pointer;
}

/* Style for the Total Row and Table Footer */
.total-row,
.custom-table tfoot {
    background-color: rgb(15, 15, 15); /* Set the background color of tfoot to grey */
    color: black; /* Set the text color to white */
    text-align: center; /* Center-align text in the footer row */
    vertical-align: top; /* Align footer text to the top */
    font-weight: bold; /* Make the text bold */
    font-size: 10px; /* Adjust the font size as needed */
}


 
    /* Add 3D effect to buttons */
    .btn {
        transition: all 0.3s ease-in-out;
    }

    .btn:hover {
        transform: translate(0, -2px) scale(1.02);
    }
/* Table For coal linakge advance calculator*/
  /* Add subtle shadows and rounded corners */
.table {
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
}

/* Change background color on focus */
[contenteditable="true"]:focus {
    background-color: #90e076;
    border: 2px dashed #000306;
    outline: none;
}


/* Highlight only the Generation Capacity input cells in Table1 */
#Table1 tbody tr td:nth-child(2) input,
#Table1 tbody tr td:nth-child(3) input,
#Table1 tbody tr td:nth-child(5) input,
#Table1 tbody tr td:nth-child(7) input,
#Table1 tbody tr td:nth-child(8) input{
  background-color: #eaffd0;
  color: #1a4d0a;
  border: 2px solid #65d30a;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1rem;
  padding: 6px 10px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.06);
  transition: border-color 0.2s, box-shadow 0.2s;
}

#Table1 tbody tr td:nth-child(2) input:focus,
#Table1 tbody tr td:nth-child(3) input:focus,
#Table1 tbody tr td:nth-child(5) input:focus,
#Table1 tbody tr td:nth-child(7) input:focus,
#Table1 tbody tr td:nth-child(8) input:focus {
  border-color: #0de84f;
  box-shadow: 0 0 0 2px #0de84f33;
  outline: none;
}

/* Ensure table inputs never overflow their cell */
#Table1 td {
  padding: 4px !important;
  box-sizing: border-box;
  text-align: center; /* Center content horizontally */
  vertical-align: middle;
}

#Table1 td input,
#Table1 td input[type="number"],
#Table1 td input[type="text"] {
  width: 100%;
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
  padding: 4px 8px; /* Equal left and right padding */
  margin: 0;
  border-radius: 6px;
  font-size: 1rem;
  text-align: center; /* Center text inside input */
  background-color: #d9d0ff;
  color: #1a4d0a;
  border: 2px solid #65d30a;
  font-weight: bold;
  /* Remove any fixed width or extra margin */
}


    /* Animated text style */
    .animate-charcter {
        text-transform: uppercase;
        background-image: linear-gradient(
            -225deg,
            #0de84f 0%,
            #44107a 29%,
            #ff1361 67%,
            #fff800 100%
        );
        background-size: 200% auto;
        background-clip: text;
        -webkit-background-clip: text;
        color: #fff;
        -webkit-text-fill-color: transparent;
        animation: textclip 2s linear infinite;
        display: inline-block;
        font-size: 40px;
        text-align: center; /* Center text */
        width: 100%; /* Ensure gradient spans entire width */
        }

    @keyframes textclip {
    to {
        background-position: 200% center;
    }
    }
/* Style for span cells in the table */
.table span {
  display: inline-block;
  padding: 8px 12px;
  background-color: #f1f1f1;
    border: 1px solid #ccc;
  color: #333;
  border-radius: 4px;
  font-weight: bold;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin-right: 5px;
  }

/* Additional styles for hover effect */
.table span:hover {
  background-color: #ddd;
  cursor: pointer;
}

/* Style for input cells in the table */
.custom-table input {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  font-size: 12px;
  text-align: center;

}

/* Style for select cells in the table */
.custom-table select {
  width: 100%;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  font-size: 12px;
  font-weight:bold;
  text-align: center;

}

/* Additional styles for hover effect on input and select cells */
.custom-table input:hover,
.custom-table select:hover {
  border-color: #888;
}

/* Additional styles for focus effect on input and select cells */
.custom-table input:focus,
.custom-table select:focus {
  outline: none;
  border-color: #4CAF50;
  box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
}

/* Add animation to the text on the tab button when active */
@keyframes tabTextAnimation {
  0% {
    opacity: 1;
    transform: translateY(0);
  }

  50% {
    opacity: 0.5;
    transform: translateY(-5px);
  }

  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Apply styles when a tab is active */
.card-header.active .btn .tab-text{
  animation: tabTextAnimation 0.5s infinite; /* Adjust the animation duration as needed */
  font-size: 20px; /* Adjust the font size as needed */

}

/* Hide the container text when the tab is active */
.card-header.active .calulatordiscription {
  display: none;
}
/* Apply styles when a tab is inactive */
.card-header:not(.active) .btn .tab-text {
  animation: none; /* Stop the animation */
}

/* Display the container text when the tab is inactive */
.card-header:not(.active) .calulatordiscription {
  display: block;
}

.card-body {
    background-color: #f8f9fa; /* Light background for better contrast */
    padding: 0.4rem; /* Add some padding for better spacing */
    border-radius: 0.5rem; /* Rounded corners for the card body */
}

/* Define keyframes for color change */
@keyframes textColorChange {
  0% { color: rgb(225, 12, 12); }
  50% { color: rgb(44, 7, 145); }
  100% { color: rgb(247, 242, 242); }
}

/* Apply animation to the button text */
.btn-color-change {
  animation: textColorChange 1s infinite; /* Adjust the duration as needed */
}


/* Button Glow */
.glow-on-hover {
    width: 220px;
    height: 50px;
    border: none;
    outline: none;
    color: #fff;
    background: #111;
    cursor: pointer;
    position: relative;
    z-index: 0;
    border-radius: 10px;
}

.glow-on-hover:before {
    content: '';
    background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
    position: absolute;
    top: -2px;
    left:-2px;
    background-size: 400%;
    z-index: -1;
    filter: blur(5px);
    width: calc(100% + 4px);
    height: calc(100% + 4px);
    animation: glowing 20s linear infinite;
    opacity: 0;
    transition: opacity .3s ease-in-out;
    border-radius: 10px;
}

.glow-on-hover:active {
    color: #000
}

.glow-on-hover:active:after {
    background: transparent;
}

.glow-on-hover:hover:before {
    opacity: 1;
}

.glow-on-hover:after {
    z-index: -1;
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: #111;
    left: 0;
    top: 0;
    border-radius: 10px;
}

@keyframes glowing {
    0% { background-position: 0 0; }
    50% { background-position: 400% 0; }
    100% { background-position: 0 0; }
}




/* Add 3D effect to input elements */
 /* Style for input groups */
 
  
.input-group {
    position: relative;
    /* Ensure space for the bar */
}
.form-control {
    margin: 0px 0px 0px 0px !important; /* Remove margin */
    border: 1px solid #ced4da;
    position: relative;
    background:
        linear-gradient(to right, #007bff 4px, transparent 4px) no-repeat left center; 
    background-size: 4px 70%; /* 4px wide, 70% height of input */
    background-position: 0 50%;
    
    padding-left: 10px !important; /* Add space for the bar */
    transition: background-size 0.2s;
}

/* Show the bar only when input is focused or has value */
.form-control:not(:focus):not(:valid) {
    background-size: 0 70%; /* Hide the bar */
}

/* For Tick mark
.input-group:has(input:focus) .input-group-text1::after,
.input-group:has(input:valid) .input-group-text1::after {
    content: " \2714"; 
    color: #28a745;    
    font-size: 1.1em;
    margin-left: 8px;
    vertical-align: middle;
    font-weight: bold;
    transition: opacity 0.2s;
    opacity: 1;
}
.input-group .input-group-text1::after {
    content: "";
    opacity: 0;
    transition: opacity 0.2s;
}*/


.input-group-text1{
  font-size: small;
  font-weight: bold;
  width: 10rem;
  color: #495057 ;
  align-content: center;
  padding-left: 5px;
  background-color: #e9ecef; /* Light background for better contrast */
  border: 1px solid #ced4da; /* Border to match Bootstrap */
  border-radius: 5px 0px 0px 5px; /* Rounded corners */

}
.input-group-text2{
  font-size: xx-small;
  font-weight: bold;
  width: 60px;
  color: #474747;;
  align-content: center;
  padding-left: 5px;
  background-color: #ecedee; /* Light background for better contrast */
  border-top: 1px solid #ced4da;
  border-bottom: 1px solid #ced4da;
  border-right: 1px solid #ced4da; /* Border to match Bootstrap */
}
.input-group-text3{
  font-size: small;
  font-weight: bold;
  width: 100px;
  color: #495057 ;
  align-content: center;
  padding-left: 10px;
  background-color: #e9ecef; /* Light background for better contrast */
  border: 1px solid #ced4da; /* Border to match Bootstrap */
  border-radius: 5px 0px 0px 5px; /* Rounded corners */

}
.input-group-text4{
  font-size: xx-small;
  font-weight: bold;
  width: 30px;
  color: #474747;;
  align-content: center;
  padding-left: 10px;
  background-color: #ecedee; /* Light background for better contrast */
  border-top: 1px solid #ced4da;
  border-bottom: 1px solid #ced4da;
  border-right: 1px solid #ced4da; /* Border to match Bootstrap */
}

.input-group-text5{
  font-size: small;
  font-weight: bold;
  width: 200px;
  color: #495057 ;
  align-content: center;
  padding-left: 10px;
  background-color: #e9ecef; /* Light background for better contrast */
  border: 1px solid #ced4da; /* Border to match Bootstrap */
  border-radius: 5px 0px 0px 5px; /* Rounded corners */

}

 /* Style for input groups on hover */
 .input-group:hover .form-control {
        border-color: #696a6a;
        box-shadow: 0 0 10px rgba(2, 37, 61, 0.5);
        transform: translate(0, -2px) scale(1.01);
        
       }
       
.badge-info-custom {
    background-color: #d1ecf1 !important;   /* Light blue info background */
    color: #0699d3 !important;              /* Info text color */
    font-size: 0.95rem !important;          /* Font size */
    font-weight: 600;
    padding: 4px 14px !important;           /* Vertical and horizontal padding */
    border-radius: 8px !important;          /* Rounded corners */
    border: 1px solid #b8ddff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    display: inline-block;
    margin-bottom: 0.5rem;
}

/* Modern Minimal Result Card - Updated for left alignment, minimal padding, and border 
.result-card {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  border: 2px solid #b8ddff;     
  width: fit-content;
  min-width: 220px;
  margin: 0;                    
  padding: 0;
  overflow: hidden;
  transition: box-shadow 0.2s;
}

.result-card-header {
  background: #f6f8fa;
  color: #222;
  font-weight: 600;
  font-size: 1.05rem;
  border-bottom: 1px solid #e0e0e0;
  padding: 0.4rem 0.8rem;       
  letter-spacing: 0.01em;
}

.result-card-body {
  background: #fff;
  padding: 0.01rem; 
}

.resultStyle {
  color: #1a7f37;
  background: #f6f8fa;
  border-radius: 5px;
  font-size: 0.98rem;
  font-weight: 200;
  margin: 0.1em 0;
  padding: 0.1em 0.1em;
  border: none;
  box-shadow: none;
  letter-spacing: 0.01em;
  transition: background 0.2s;
}

.resultStyle span {
  color: #222;
  font-weight: 500;
  font-size: 0.8em;
  line-height: 0.1em;
}

@media (max-width: 600px) {
  .result-card {
    min-width: 90vw;
    padding: 0;
  }
  .result-card-body {
    padding: 0.5rem 0.4rem;
  }
}

*/

/* Modern Minimal Result Cards for Blending Section 
.result-card-error {
  background: #222;
  border-radius: 10px;
  border: 2px solid #ff4d4f;
  color: #fff;
  width: fit-content;
  min-width: 220px;
  margin: 0;
  padding: 0;
  box-shadow: 0 2px 8px rgba(255,0,0,0.08);
}
.result-card-error .card-header {
  background: #ff4d4f;
  color: #fff;
  font-weight: 600;
  font-size: 1.05rem;
  border-bottom: 1px solid #ff4d4f;
  padding: 0.4rem 0.8rem;
}
.result-card-error .card-body {
  background: #222;
  padding: 0.5rem 0.8rem;
}

.result-card-indigenous {
  background: #fffbe6;
  border-radius: 10px;
  border: 2px solid #ffe58f;
  color: #664d03;
  width: fit-content;
  min-width: 220px;
  margin: 0;
  padding: 0;
  box-shadow: 0 2px 8px rgba(255,193,7,0.08);
}
.result-card-indigenous .card-header {
  background: #ffe58f;
  color: #664d03;
  font-weight: 600;
  font-size: 1.05rem;
  border-bottom: 1px solid #e0e0e0;
  padding: 0.4rem 0.8rem;
}
.result-card-indigenous .card-body {
  background: #fffbe6;
  padding: 0.5rem 0.8rem;
}

.result-card-imported {
  background: #f6ffed;
  border-radius: 10px;
  border: 2px solid #b7eb8f;
  color: #135200;
  width: fit-content;
  min-width: 220px;
  margin: 0;
  padding: 0;
  box-shadow: 0 2px 8px rgba(40,167,69,0.08);
}
.result-card-imported .card-header {
  background: #b7eb8f;
  color: #135200;
  font-weight: 600;
  font-size: 1.05rem;
  border-bottom: 1px solid #e0e0e0;
  padding: 0.4rem 0.8rem;
}
.result-card-imported .card-body {
  background: #f6ffed;
  padding: 0.5rem 0.8rem;
}

.result-card-blended {
  background: #f0f5ff;
  border-radius: 10px;
  border: 2px solid #adc6ff;
  color: #10239e;
  width: fit-content;
  min-width: 220px;
  margin: 0;
  padding: 0;
  box-shadow: 0 2px 8px rgba(24,144,255,0.08);
}
.result-card-blended .card-header {
  background: #adc6ff;
  color: #10239e;
  font-weight: 600;
  font-size: 1.05rem;
  border-bottom: 1px solid #e0e0e0;
  padding: 0.4rem 0.8rem;
}
.result-card-blended .card-body {
  background: #f0f5ff;
  padding: 0.5rem 0.8rem;
}

.resultStyle, .card-text {
  color: inherit;
  background: transparent;
  border-radius: 5px;
  font-size: 0.98rem;
  font-weight: 500;
  margin: 0.2em 0;
  padding: 0.3em 0.7em;
  border: none;
  box-shadow: none;
  letter-spacing: 0.01em;
  transition: background 0.2s;
}
*/

/* Custom style for coal month select only */
.coal-month-select {
    height: 32px;
    font-size: 0.95rem;
    padding: 4px 4px;
    border: 2px solid #65d30a;
    border-radius: 6px;
    background-color: #f8fff3;
    color: #222;
    transition: border-color 0.2s;
}
.coal-month-select:focus {
    border-color: #0d6efd;
    background-color: #eaffd0;
    outline: none;
}

/* Make badges fit nicely inside card body */
/* Common badge style */
.badge.rounded-pill {
  display: inline-block;
  border-radius: 50rem;
  font-size: 0.95rem;
  font-weight: 500;
  padding: 0.5em 1.2em;   /* px-3 py-2 equivalent */
  margin-right: 0.3em;
  margin-bottom: 0.3em;
  vertical-align: middle;
  text-align: left;
  box-sizing: border-box;
  min-width: 120px;
  max-width: auto;
  white-space: normal;
  word-break: break-word;
  overflow-wrap: break-word;
}

/* Primary badge */
.badge.bg-primary {
  background-color: #0d6efd !important;
  color: #fff !important;
}

/* Success badge */
.badge.bg-success {
  background-color: #198754 !important;
  color: #fff !important;
}

/* Warning badge */
.badge.bg-warning {
  background-color: #ffe066 !important;
  color: #212529 !important;
}




/* Custom styles for the Two Coal Analysis table for mobile-friendliness */
.two-coal-analysis-table {
    font-size: 0.8rem; /* Smaller font for compactness */
    table-layout: fixed; /* Helps with column width control */
    width: 100%;
    word-wrap: break-word;
    border: 1px solid #dee2e6;
}
.two-coal-analysis-table th,
.two-coal-analysis-table td {
    padding: 0.4rem 0.3rem; /* Reduced padding */
    vertical-align: middle;

}



/* First column (Parameter names) styling */
.two-coal-analysis-table td:first-child {
    font-size: .9rem;
    white-space: normal; /* Allow text to wrap */
    text-align: left;
    font-weight: 500;
    background-color: #f8f9fa; /* Slightly different background */
    padding: .1rem 0.2rem; /* Reduced padding for first column */
}

.two-coal-analysis-table thead.table-dark th {
    white-space: normal; /* Allow header text to wrap */
}

/* Remove extra styling from the span elements inside the table */
.two-coal-analysis-table span {
    display: inline;
    padding: 0;
    background-color: transparent;
    box-shadow: none;
    font-weight: normal;
    font-size: 1.0rem; /* Larger font size for emphasis */
    color: inherit;
    margin: 0;
    border: none !important;

}

/* Add this to your <style> section */
#coalAvscoalB-result {
  background-color: #212529;
  color: #fff;
  padding: 4px 12px;
  border-radius: 6px;
  font-weight: bold;
  display: inline-block;
  text-align: center;
  margin: 0 auto;
  align-content: center;
}
.two-coal-analysis-footer td {
  text-align: center;

}

/* Custom style for Coal Name inputs */
#coalA-Name, #coalA-blending-name
 {
  background-color: #e4e4e4;
  color: #050505;
  border: 2px solid #65d30a;
  border-radius: 0px;
  font-weight: bold;
  font-size: 1rem;
  padding: 8px 12px;
  margin-bottom: 4px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
#coalB-Name, #coalB-blending-name {
  background-color: #e4e4e4;
  color: #050505;
  border: 2px solid #0a64d3;
  border-radius: 0px 8px 8px 0px;
  font-weight: bold;
  font-size: 1rem;
  padding: 8px 12px;
  margin-bottom: 4px;
  transition: border-color 0.2s, box-shadow 0.2s;
}

#coalA-Name:focus:focus {
  border-color: #0de84f;
  box-shadow: 0 0 0 2px #0de84f33;
  outline: none;
}
#coalB-Name:focus {
  border-color: #0a64d3;
  box-shadow: 0 0 0 2px #0b29d233;
  outline: none;
}
/* Responsive adjustments for very small screens */
@media (max-width: 576px) {
    .two-coal-analysis-table {
        font-size: 0.75rem; /* Even smaller font */
    }

    .two-coal-analysis-table th,
    .two-coal-analysis-table td {
        padding: 0.3rem 0.2rem;
    }
}
/* Custom styles for the Two Coal Analysis table caption */
.two-coal-analysis-table > caption {
    caption-side: top; /* Ensures the caption is at the top */
    font-weight: bolder;
    font-size: 2.5rem; /* A bit larger to act as a title */
    text-align: center;
    color: #212529; /* Dark text for readability */
    padding-top: 0;
    padding-bottom: 0.3rem;
}
#twoCoalCompHeader {
  background-color: #212529;
  color: #fff;
  padding: 4px 8px;   /* Less padding */
  border-radius: 5px;
  font-weight: bold;
  display: inline-block;
  text-align: center;
  margin: 0 auto;
  font-size: 1.2rem;
}


.centered-span {
    background-color: #212529;
  color: #fff;
    border-radius: 5px;
  padding: 4px 8px;   /* Less padding */
  max-width: fit-content;
  display: block;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}



/* Custom styles for the Coal Linkage Adavance table for mobile-friendliness */
.CoalLinkageAdvance-table {
    font-size: 0.8rem; /* Smaller font for compactness */
    table-layout: fixed; /* Helps with column width control */
    width: 100%;
    word-wrap: break-word;
    border: 1px solid #dee2e6;
}
.CoalLinkageAdvance-table th,
.CoalLinkageAdvance-table td {
    padding: 0.4rem 0.3rem; /* Reduced padding */
    vertical-align: middle;
}



/* First column (Parameter names) styling */
.CoalLinkageAdvance-table td:first-child {
    font-size: .9rem;
    white-space: normal; /* Allow text to wrap */
    text-align: left;
    font-weight: 500;
    background-color: #f8f9fa; /* Slightly different background */
    padding: .1rem 0.2rem; /* Reduced padding for first column */
}

.CoalLinkageAdvance-table thead.table-dark th {
    white-space: normal; /* Allow header text to wrap */
      text-align:center; vertical-align: middle; 
}

/* Remove extra styling from the span elements inside the table */
.CoalLinkageAdvance-table span {
    display: inline;
    padding: 0;
    background-color: transparent;
    box-shadow: none;
    font-weight: normal;
    font-size: 0.9rem; /* Larger font size for emphasis */
    color: inherit;
    margin: 0;
}

/* Responsive adjustments for very small screens */
@media (max-width: 576px) {
    .CoalLinkageAdvance-table {
        font-size: 0.75rem; /* Even smaller font */
    }

   .CoalLinkageAdvance-table th,
    .CoalLinkageAdvance-table td {
        padding: 0.3rem 0.2rem;
    }
}





/* Custom styles for the Blended Coal Analysis table for mobile-friendliness */
.blended-analysis-table {
    font-size: 0.8rem; /* Smaller font for compactness */
    table-layout: fixed; /* Helps with column width control */
    width: 100%;
    word-wrap: break-word;
    border: 1px solid #dee2e6;
}

.blended-analysis-table th,
.blended-analysis-table td {
    padding: 0.4rem 0.3rem; /* Reduced padding */
    vertical-align: middle;
}

/* First column (Parameter names) styling */
.blended-analysis-table td:first-child {
    white-space: normal; /* Allow text to wrap */
    text-align: left;
    font-weight: 500;
    background-color: #f8f9fa; /* Slightly different background */
}

.blended-analysis-table thead.table-dark th {
    white-space: normal; /* Allow header text to wrap */
}

/* Remove extra styling from the span elements inside the table */
.blended-analysis-table span {
    display: inline;
    padding: 0;
    background-color: transparent;
    box-shadow: none;
    font-weight: normal;
    color: inherit;
    margin: 0;
        border: none !important;

}

/* Responsive adjustments for very small screens */
@media (max-width: 576px) {
    .blended-analysis-table {
        font-size: 0.75rem; /* Even smaller font */
    }

    .blended-analysis-table th,
    .blended-analysis-table td {
        padding: 0.3rem 0.2rem;
    }
}


/* Custom style for Plant Name  */
 #powerplantName
 {
  background-color: #e4e4e4;
  color: #050505;
  border: 2px solid #65d30a;
  border-radius: 0px 5px 5px 0px;
  font-weight: bold;
  font-size: 1rem;
  size: 0.5rem;
  transition: border-color 0.2s, box-shadow 0.2s;
  height: fit-content;
}
#powerplantName:focus {
  border-color: #0de84f;
  box-shadow: 0 0 0 2px #0de84f33;
  outline: none;
}


.form-control3 {
  height: 28px !important;
  line-height: 1.2 !important;
  padding-top: 2px !important;
  padding-bottom: 2px !important;
  font-size: 0.95rem !important;
}
</style>

</head>
<body>
<div class="container mt-1">        <h3 class="animate-charcter">Coal Calculat<i class="bi bi-calculator"></i>rs</h3>

<!-- Accordion for Tabs -->
<div class="accordion" id="coalTabs">

<!-- Tab 1: Energy Charges Calculator -->
<div class="card-body">
<div class="card" id="energyChargesHeader"> 
    <div class="card-header" id="energyChargesHeader1">
            <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#energyChargesTab"
                    aria-expanded="false" aria-controls="energyChargesTab" onclick="delayedScrollToAccordionTab('energyChargesHeader')">
                    <span class="tab-text">Energy Charges</span>
            </button>
            <h6 class="calulatordiscription">
                Calculate Energy Charges, Coal Cost, Railway Freight, SHR, and GCV
            </h6>
    </div>

    <div id="energyChargesTab" class="collapse" aria-labelledby="energyChargesHeader" data-parent="#coalTabs">

        <div class="card-body">
            <!-- Result section for Energy Charges Calculator -->
                        <!-- Flex Info Chips Output Style -->
            <div class="mt-0 mb-1" id="resultshow1" style="display: none;">
            <div class="d-flex flex-wrap gap-1">
                <span class="badge rounded-pill bg-primary">
                    <span id="ec-energy-charges-result"></span>
                </span>
                <span class="badge rounded-pill bg-success">
                <span id="ec-SCC-result"></span>
                </span>
                <span class="badge rounded-pill bg-warning">
                    <span id="ec-LandedCostMC-result"></span>
                </span>
            </div>
            </div>     
            <!-- Content for Energy Charges Calculator -->

            <!-- Coal Cost -->
            <div class="input-group input-group-sm mb-1">
            <div class="input-group-prepend">
            <span class="input-group-text1">Coal Cost</span>
            <span class="input-group-text2">Rs / MT</span>
            </div>
            <input type="number" step="0.01" min="0" class="form-control" id="ec-coal-cost" placeholder="" required>
            </div>

            <!-- Railway Freight -->
            <div class="input-group input-group-sm mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text1">Railway Freight</span>
                <span class="input-group-text2">Rs / MT</span>
            </div>
            <input type="number" step="0.01" min="0" class="form-control" id="ec-railway-freight" placeholder="" required>
            </div>

            <!-- Station Heat Rate -->
            <div class="input-group input-group-sm mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text1">Station Heat Rate</span>
                <span class="input-group-text2">Kcal / Kwh</span>
            </div>
            <input type="number" step="0.01" min="0" class="form-control" id="ec-shr-energy" placeholder="" required>
            </div>

            <!-- Gross Calorific Value -->
            <div class="input-group input-group-sm mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text1">Gross Calorific Value</span>
                <span class="input-group-text2">Kcal / Kg</span>
            </div>
            <input type="number" step="0.01" min="0" class="form-control" id="ec-gcv-energy" placeholder="" required>
            </div>

            <!-- Energy Charges -->
            <div class="input-group input-group-sm mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text1">Energy Charges</span>
                <span class="input-group-text2">Rs / Kwh</span>
            </div>
            <input type="number" step="0.000001" min="0" class="form-control" id="ec-energy-charges" placeholder="" required>
            </div>
            
            <!-- Buttons for calculations -->
            <!-- Option Button to show/hide the action buttons -->
            <button class="btn btn-secondary btn-sm mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#energyChargesOptions" aria-expanded="false" aria-controls="energyChargesOptions">
                <i class="bi bi-three-dots"></i>
            </button>

            <!-- Collapsible button group -->
             
            <div class="collapse small" id="energyChargesOptions">
                <div class="d-flex flex-wrap gap-2 mt-1">
                    <button class="btn btn-outline-dark btn-sm" type="button" data-bs-toggle="collapse" 
                        data-bs-target="#EnergyChargesFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                    <button class="btn btn-outline-danger btn-sm" onclick="generatePDFWithStoredValuesEnergyCharges()">Print PDF</button>
                    <button type="button" class="btn btn-primary btn-sm" onclick="storeEnergyChargesValues()">Store Data</button>
                    <button type="button" class="btn btn-outline-success btn-sm position-relative" onclick="clearEnergyChargesValues()">
                        Clear Data
                        <span class="position-absolute top-0 start-100 translate-middle badge bg-danger" id="rowCountBadgeEnergyCharges">0</span>
                    </button>
                </div>
            </div>

            <!-- Collapse for formula -->
                        <div class="collapse" id="EnergyChargesFormula">
                            <div class="card card-body mt-2" style="width: fit-content;">
                                <li><em style="font-size: smaller;"> <b>Energy Charges: </b> [(Coal Cost + Railway Freight) x SHR] / (GCV x 1000)  </em></li> 
                                <li><em style="font-size: smaller;"> <b>GCV : </b>[(Coal Cost + Railway Freight) x SHR] / (Energy Charges x 1000)</em></li>
                                <li><em style="font-size: smaller;"> <b>SHR : </b>[(Energy Charges x GCV x 1000)] / [(Coal Cost + Railway Freight)]</em></li>
                                <li><em style="font-size: smaller;"> <b>Railway Freight : </b>[(Energy Charges x GCV x 1000) / SHR] - Coal Cost</em></li>
                                <li><em style="font-size: smaller;"> <b>Coal Cost : </b>[(Energy Charges x GCV x 1000) / SHR] - Railway Freight</em></li>
                                <li><em style="font-size: smaller;"> <b>Specific Coal Consumption : </b>SHR / GCV</em></li> 
                                <li><em style="font-size: smaller;"> <b>Landed Cost : </b>(Coal Cost + Railway Freight) / GCV</em></li>                                                                                         
                            </div>
                        </div>

                        
        </div>
    </div>
</div></div>


<!-- Tab 2: Coal Requirement Calculator -->
 <div class="card-body">
            <div class="card" id="coalRequirementHeader">
                <div class="card-header" id="coalRequirementHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#coalRequirementTab"
                                aria-expanded="false" aria-controls="coalRequirementTab" onclick="delayedScrollToAccordionTab('coalRequirementHeader')">
                                <span class="tab-text">Coal Requirement Calculator</span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Calculate Coal Requirement, Generation, PLF, SHR and  GCV</H6>
                </div>
    
                <div id="coalRequirementTab" class="collapse" aria-labelledby="coalRequirementHeader"
                     data-parent="#coalTabs">
                    <div class="card-body">
                                              <!-- Result section for Coal Requirement Calculator - Modern Minimal Style -->
                                    <!-- Flex Info Chips Output Style for Generation Result (matching Energy Charges style) -->
<div class="mt-0 mb-1" id="resultshow2" style="display: none;">
  <div class="d-flex flex-wrap gap-1">
    <span class="badge rounded-pill bg-primary">
      <span id="result-gen"></span>
    </span>
    <span class="badge rounded-pill bg-success">
      <span id="result-gen-scc"></span>
    </span>
    <span class="badge rounded-pill bg-warning">
      <span id="result-generatedunits"></span>
    </span>
  </div>
</div>

                                <!-- Content for Coal Requirement Calculator -->
                                <!-- Generation Capacity -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Generation Capacity</span>
                                        <span class="input-group-text2">MW</span>
                                    </div>
                                    <input type="number" step="1" min="0" class="form-control" id="capacity-gen" placeholder="" required>
                                </div>

                                <!-- Plant Load Factor -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Plant Load Factor</span>
                                        <span class="input-group-text2">%</span>
                                    </div>
                                    <input type="number" step="0.01" min="0" max="100" class="form-control" id="plf-gen" placeholder="" required>
                                </div>

                                <!-- Number of Days -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Number of Days</span>
                                        <span class="input-group-text2">Days</span>
                                    </div>
                                    <input type="number" step="1" min="0" class="form-control" id="days-gen" placeholder="" required>
                                </div>

                                <!-- Station Heat Rate -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Station Heat Rate</span>
                                        <span class="input-group-text2">kcal / kWh</span>
                                    </div>
                                    <input type="number" step="0.01" min="0" class="form-control" id="shr-gen" placeholder="" required>
                                </div>

                                <!-- GCV -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">GCV</span>
                                        <span class="input-group-text2">kcal / kg</span>
                                    </div>
                                    <input type="number" step="0.01" min="0" class="form-control" id="gcv-gen" placeholder="" required>
                                </div>

                                <!-- Coal Requirement -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Coal Requirement</span>
                                        <span class="input-group-text2">Lakh MT</span>
                                    </div>
                                    <input type="number" step="0.00001" min="0" class="form-control" id="coal-req-gen" placeholder="" required>
                                </div>


                                   <!-- Option Button to show/hide the action buttons -->
                                    <button class="btn btn-secondary btn-sm mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#coalRequirementOptions" aria-expanded="false" aria-controls="coalRequirementOptions">
                                        <i class="bi bi-three-dots"></i>
                                    </button>

                                    <!-- Collapsible button group -->
                                    <div class="collapse small" id="coalRequirementOptions">
                                        <div class="d-flex flex-wrap gap-2 mt-1">
                                            <button class="btn btn-outline-dark btn-sm" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#CalReqFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                            <button class="btn btn-outline-danger" onclick="generatePDFWithStoredValuesGen()">Print PDF</button>
                                            <button type="button" class="btn btn-primary btn-sm" onclick="storeCoalRequirementParameters()">Store Data</button>
                                            <button type="button" class="btn btn-sm btn-outline-success position-relative" onclick="clearCoalRequirementValues()">
                                                Clear Data
                                                <span class="position-absolute top-0 start-100 translate-middle badge bg-danger" id="rowCountBadgeGen">0</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="collapse" id="CalReqFormula">
                                        <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                                            <ol>
                                                <li><em style="font-size: smaller;"> <b>Generation Capacity :</b>[Coal Requirement x {GCV x 100000000}] / [Days x 24 x PLF x 10 x SHR]</em></li>
                                                <li><em style="font-size: smaller;"> <b>PLF : </b>[Coal Requirement x { GCV x 100000000}] / [Days x 24 x Generation Capacity x 10 x SHR]</em></li> 
                                                <li><em style="font-size: smaller;"> <b>Days : </b>[Coal Requirement x {GCV x 100000000}] / [PLF x 24 x Generation Capacity x 10 x SHR]</em></li>
                                                <li><em style="font-size: smaller;"> <b>SHR : </b>[Coal Requirement x {GCV x 100000000}] / [Days x 24 x Generation Capacity x 10 x PLF]</em></li>
                                                <li><em style="font-size: smaller;"> <b>GCV : </b>[PLF x {Days x 24 x Generation Capacity x 10 x SHR}] / [Coal Requirement x 100000000]</em></li>
                                                <li><em style="font-size: smaller;"> <b>Coal Requirement : </b>[Generation Capacity x Days x 24 x PLF x 10 x SHR] / [GCV x 100000000]</em></li>
                                                <li><em style="font-size: smaller;"> <b>Specific Coal Consumption : </b>[SHR / GCV]</em></li>
                                                <li><em style="font-size: smaller;"> <b>Units Generated : </b>[Generation Capacity x PLF x Days x 24 x 10 / 100000 ]</em></li>
                                            </ol>     
                                        </div>
                                    </div>

              
                    </div>
                </div>
            </div></div>
            
    
<!-- Tab 3: Calculates GCV, Ash & Moisture -->
                     <div class="card-body">

            <div class="card" id="gcv-ash-moistureHeader">
                <div class="card-header" id="gcv-ash-moistureHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#gcv-ash-moistureTab"
                                aria-expanded="false" aria-controls="gcv-ash-moistureTab" onclick="delayedScrollToAccordionTab('gcv-ash-moistureHeader')">
                                <span class="tab-text">GCV Ash Moisture</span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Calculate Gross Calorific Value, Ash Content and Moisture Content</H6>
                </div>
    
                <div id="gcv-ash-moistureTab" class="collapse" aria-labelledby="gcv-ash-moistureHeader"
                     data-parent="#coalTabs">
                    <div class="card-body">    
                                                <!-- Result section for GCV, Ash, and Moisture Calculator - Modern Minimal Style -->
                                    <!-- Flex Info Chip Output Style for Calculated Parameter (minimal style) -->
<div class="mt-0 mb-1" id="resultshow3" style="display: none;">
  <div class="d-flex flex-wrap gap-1">
    <span class="badge rounded-pill bg-secondary">
      <span id="calculated-parameter-result"></span>
    </span>
  </div>
</div>

                                    <!-- Content for GCV, Ash, and Moisture Calculator -->
                                <!-- GCV -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">GCV</span>
                                        <span class="input-group-text2">kcal / kg</span>
                                    </div>
                                    <input type="number" step="0.01" min="0" class="form-control" id="gcv-gam" placeholder="" required>
                                </div>

                                <!-- Ash Content -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Ash Content</span>
                                        <span class="input-group-text2">%</span>
                                    </div>
                                    <input type="number" step="0.01" min="0" class="form-control" id="ash-gam" placeholder="" required>
                                </div>

                                <!-- Moisture Content -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Moisture Content</span>
                                        <span class="input-group-text2">%</span>
                                    </div>
                                    <input type="number" step="0.01" min="0" class="form-control" id="moisture-gam" placeholder="" required>
                                </div>
                                    
                                    
                                    <!-- Option Button to show/hide the action buttons -->
                                    <button class="btn btn-secondary mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#gamOptions" aria-expanded="false" aria-controls="gamOptions">
                                        <i class="bi bi-three-dots"></i>
                                    </button>

                                    <!-- Collapsible button group -->
                                    <div class="collapse small" id="gamOptions">
                                        <div class="d-flex flex-wrap gap-2 mt-1">
                                            <button class="btn btn-outline-dark btn-sm" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#GamFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                            <button class="btn btn-outline-danger btn-sm" onclick="generatePDFWithStoredValuesGam()">Print PDF</button>                                            <button type="button" class="btn btn-primary" onclick="storeGCVAshMoistureParameters()">Store Data</button>
                                            <button type="button" class="btn btn-outline-success position-relative btn-sm" onclick="clearGamParameterValues()">
                                                Clear Data
                                                <span class="position-absolute top-0 start-100 translate-middle badge bg-danger" id="rowCountBadgeGam">0</span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Collapse for formula -->
                                    <div class="collapse" id="GamFormula">
                                        <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                                            <ol>
                                                <li><em style="font-size: smaller;"> <b>GCV :</b> [{154 x (100 - (Moisture + (1.1 x Ash)))} - {108 x Moisture}] / 1.8</em></li>
                                                <li><em style="font-size: smaller;"> <b>Ash : </b> [{100 - (((GCV x 1.8) + (108 x Moisture)) / 154)} - Moisture] / 1.1</em></li>
                                                <li><em style="font-size: smaller;"> <b>Moisture :</b> [15400 - {169.4 x Ash} - {1.8 x GCV}] / 262 </em></li>
                                        </ol>
                                        </div>
                                    </div>
                                    
            

                            
                    </div>
                </div>
            </div></div>

<!-- Tab 4: ARB to from EQ Parameter Converter -->
                                <div class="card-body">

            <div class="card" id="parameter-calculatorHeader">
                <div class="card-header" id="parameter-calculatorHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#parameter-calculatorTab"
                                aria-expanded="false" aria-controls="parameter-calculatorTab" onclick="delayedScrollToAccordionTab('parameter-calculatorHeader')" >
                                <span class="tab-text"> GCV Equilibrated <b style="font-stretch: ultra-expanded;">&#8703</b> GCV ARB  </span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Convert ARB values into Eq and Vise Versa</H6>
                </div>
    
                <div id="parameter-calculatorTab" class="collapse" aria-labelledby="parameter-calculatorHeader"
                     data-parent="#coalTabs">
                    <div class="card-body">
                       <!-- Result section for Parameter Calculator - Modern Minimal Style -->
                                    <!-- Flex Info Chip Output Style for ARB Equivalent (minimal style) -->
<div class="mt-0 mb-1" id="resultshow4" style="display: none;">
  <div class="d-flex flex-wrap gap-1">
    <span class="badge rounded-pill bg-info">
      <span id="calculated-parameter-ARB-Eq-result"></span>
    </span>
  </div>
</div>
                                <!-- ARB to from EQ Parameter Converter HTML code here -->

                                    <!-- GCV Equilibrated -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">GCV Equilibrated</span>
                                            <span class="input-group-text2">kcal / kg</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="gcv-eq" placeholder="" required>
                                    </div>

                                    <!-- Total Moisture -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Total Moisture</span>
                                            <span class="input-group-text2">%</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="total-moisture" placeholder="" required>
                                    </div>

                                    <!-- Equilibrated Moisture -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Equilibrated Moisture</span>
                                            <span class="input-group-text2">%</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="eq-moisture" placeholder="" required>
                                    </div>

                                    <!-- GCV ARB -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">GCV ARB</span>
                                            <span class="input-group-text2">kcal / kg</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="gcv-arb" placeholder="" required>
                                    </div>
                                  
                                    <!-- Option Button to show/hide the action buttons -->
                                    <button class="btn btn-secondary mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#arbeqOptions" aria-expanded="false" aria-controls="arbeqOptions">
                                        <i class="bi bi-three-dots"></i>
                                    </button>

                                    <!-- Collapsible button group -->
                                    <div class="collapse" id="arbeqOptions">
                                        <div class="d-flex flex-wrap gap-2 mt-1">
                                            <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#ARBEQFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                            <button class="btn btn-outline-danger" onclick="generatePDFWithStoredValues()">Print PDF</button>
                                            <button type="button" class="btn btn-primary" onclick="storeParameterValues()">Store Data</button>
                                            <button type="button" class="btn btn-outline-success position-relative" onclick="clearParameterValues()">
                                                Clear Data
                                                <span class="position-absolute top-0 start-100 translate-middle badge bg-danger" id="rowCountBadge">0</span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Collapse for formula -->
                                    <div class="collapse" id="ARBEQFormula">
                                        <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                                            <ol>
                                                <li><em style="font-size: smaller;"> <b>GCV ARB :</b> [GCV Eq x {100 - TM}] / [100 - Eq Moisture]</em></li> 
                                                <li><em style="font-size: smaller;"> <b>GCV Eq : </b> [GCV ARB x {100 - Eq Moisture}] / [100 - TM]</em></li> 
                                                <li><em style="font-size: smaller;"> <b>TM : </b> 100 - [{GCV ARB / GCV Eq} x {100 - Eq Moisture}] </em></li> 
                                                <li><em style="font-size: smaller;"> <b>Eq Moisture :</b> 100 - [{GCV Eq / GCV ARB} x {100 - TM}] </em> </li>                                               
                                            </ol>     
                                        </div>
                                    </div>
                                   
                                    

                    </div>
                </div>
            </div></div>
    
<!-- Tab 5: Coal Comparison Calculator -->
                                    <div class="card-body">

            <div class="card" id="coal-comparisonHeader">
                <div class="card-header" id="coal-comparisonHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#coal-comparisonTab"
                                aria-expanded="false" aria-controls="coal-comparisonTab"onclick="delayedScrollToAccordionTab('coal-comparisonHeader')">
                                <span class="tab-text"> Coal Analysis of Two Types of Coal</span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Compare two types of coal and calculate savings</H6>
                </div>
    
                <div id="coal-comparisonTab" class="collapse" aria-labelledby="coal-comparisonHeader"
                     data-parent="#coalTabs">
                    <div class="card-body">

                        <!-- Coal Comparison Calculator HTML code here -->                                                                  
                                <div class="table-responsivemt-2" id="resultshow5" style="display: none;"></div>

                                    <!-- Coal Source Name -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Coal Source</span>
                                            <span class="input-group-text2"></span>

                                        </div>
                                        <input type="text" class="form-control" id="coalA-Name" data-allow-text="true" placeholder="" required>
                                        <input type="text" class="form-control" id="coalB-Name" data-allow-text="true" placeholder="" required>

                                    </div>

                                    <!-- Coal Cost -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Coal Cost</span>
                                            <span class="input-group-text2">Rs / MT</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="coal-cost-a" placeholder="" required>
                                        <input type="number" step="0.01" min="0" class="form-control" id="coal-cost-b" placeholder="" required>

                                    </div>

                                    <!-- Railway Freight -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Railway Freight</span>
                                            <span class="input-group-text2">Rs / MT</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="railway-freight-a" placeholder="" required>
                                        <input type="number" step="0.01" min="0" class="form-control" id="railway-freight-b" placeholder="" required>
                                    </div>

                                    <!-- GCV -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">GCV</span>
                                            <span class="input-group-text2">kcal / kg</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="gcv-a" placeholder="" required>
                                        <input type="number" step="0.01" min="0" class="form-control" id="gcv-b" placeholder="" required>

                                    </div>
                                    
                                <!-- Other Inputs 1-->
                               
                                <span class="badge badge-info mb-1">Plant Parameters</span>

                                    <!-- Generation Capacity -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Generation Capacity</span>
                                            <span class="input-group-text2">MW</span>
                                        </div>
                                        <input type="number" step="1" min="0" class="form-control" id="gen-capacity" placeholder="" required>
                                    </div>

                                    <!-- PLF -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">PLF</span>
                                            <span class="input-group-text2">%</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="plf-coal-comp" placeholder="" required>
                                    </div>

                                    <!-- Number of Days -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Number of Days</span>
                                            <span class="input-group-text2">Days</span>
                                        </div>
                                        <input type="number" step="1" min="0" class="form-control" id="num-days" placeholder="" required>
                                    </div>

                                    <!-- Station Heat Rate -->
                                    <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Station Heat Rate</span>
                                            <span class="input-group-text2">kcal / kWh</span>
                                        </div>
                                        <input type="number" step="0.01" min="0" class="form-control" id="shr-coal-comp" placeholder="" required>
                                    </div>

                                <!-- Other Inputs 2-->
                                

                                <!-- Coal Quantity for Savings -->
                                <div class="input-group input-group-sm mb-1">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text1">Coal Quantity</span>
                                        <span class="input-group-text2">Metric Tonnes</span>
                                    </div>
                                    <input type="number" step="1" min="0" class="form-control" id="savings-perMT" placeholder="" required>
                                </div>
                               


                               <!-- Option Button to show/hide the action buttons -->
                                    <button class="btn btn-secondary btn-sm mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#coalComparisonOptions" aria-expanded="false" aria-controls="coalComparisonOptions">
                                        <i class="bi bi-three-dots"></i>
                                    </button>

                                    <!-- Collapsible button group -->
                                    <div class="collapse" id="coalComparisonOptions">
                                        <div class="d-flex flex-wrap gap-2 mt-1">                                            
                                            <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#CoalACoalBFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                            <button class="btn btn-outline-danger" onclick="generatePDFForCoalComparison()">Print PDF</button>
                                        </div>
                                    </div>
                                
                                <div class="collapse" id="CoalACoalBFormula">
                                    <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                                        <ol>
                                            <li><em style="font-size: smaller;"> <b>Units Generated :</b> Generation Capacity x (PLF / 10000) x 24 x No. of Days</em></li> 
                                            <li><em style="font-size: smaller;"> <b>Coal Quantity Required - Coal A : </b>(Units Generated x SHR) / (GCV Coal A x 1000) </em></li> 
                                            <li><em style="font-size: smaller;"> <b>Coal Quantity Required - Coal B : </b>(Units Generated x SHR) / (GCV Coal B x 1000) </em></li> 
                                            <li><em style="font-size: smaller;"> <b>Specific Coal Consumption with Coal A : </b>SHR / GCV of Coal A </em></li> 
                                            <li><em style="font-size: smaller;"> <b>Specific Coal Consumption with Coal B : </b>SHR / GCV of Coal B </em></li> 
                                            <li><em style="font-size: smaller;"> <b>Per Unit Cost - Coal A :</b>(Landed Cost Coal A x SHR) / (GCV Coal A x 1000)</em> </li>
                                            <li><em style="font-size: smaller;"> <b>Per Unit Cost - Coal B :</b>(Landed Cost Coal B x SHR) / (GCV Coal B x 1000)</em> </li>
                                            <li><em style="font-size: smaller;"> <b>Total Fuel Cost Paid - Coal A :</b>(Coal Quantity Required Coal A x Landed Cost Coal A) / (1000)</em> </li>
                                            <li><em style="font-size: smaller;"> <b>Total Fuel Cost Paid - Coal B :</b>(Coal Quantity Required Coal B x Landed Cost Coal B) / (1000)</em> </li>    
                                            <li><em style="font-size: smaller;"> <b>Savings of using Coal B w.r.t. Coal A :</b>Total Fuel Cost Paid Coal A - Total Fuel Cost Paid Coal B </em></li>
                                            <li><em style="font-size: smaller;"> <b>Savings per Metric Tonnes of using Coal B w.r.t. Coal A :</b>Landed Cost of Coal A x (GCV Coal B / GCV Coal A) x Coal Quantity</em></li>
                                        </ol>     
                                    </div>
                                </div>
                            
                                <div class="table-responsivemt-2" id="resultshow51" style="display: none;"></div>

                            </div>
            </div></div></div>


<!-- Tab 6: Coal Linkage Calculator -->
                                          <div class="card-body">                        
          
            <div class="card mb-2" id="coal-availabilityHeader">
                <div class="card-header" id="coal-availabilityHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#coal-availabilityTab"
                                aria-expanded="false" aria-controls="coal-availabilityTab" onclick="delayedScrollToAccordionTab('coal-availabilityHeader')">
                                <span class="tab-text">Coal Linkage Calculator</span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Calculates Coal Linkage during the selected period as per the ACQ</H6>
                </div>
    
                <div id="coal-availabilityTab" class="collapse" aria-labelledby="coal-availabilityHeader"
                     data-parent="#coalTabs">
                     <div class="card-body">   
                                                   <!-- Result section for Coal Availability Calculator - Modern Minimal Style -->
                                <!-- Flex Info Chips Output Style for Coal Availability -->
                            <div class="mt-2" id="resultshow6" style="display: none;">
                            <div class="d-flex flex-wrap gap-2">
                                <span class="badge rounded-pill bg-success text-dark">
                                <span id="coal-availability-result"></span>
                                </span>
                                <span class="badge rounded-pill bg-dark text-white">
                                <span id="rakes-required-result"></span>
                                </span>
                            </div>
                            </div>                     
                          
                        <!-- Coal Linkage Calculator HTML code here -->

                            <!-- Annual Coal Quantity -->
                            <div class="input-group input-group-sm mb-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text1">Annual Coal Quantity</span>
                                    <span class="input-group-text2">Metric Tonne</span>
                                </div>
                                <input type="number" class="form-control" step="0.01" min="0" id="acq-coal" placeholder="" required>
                            </div>

                            <!-- Quantity in a Rake -->
                            <div class="input-group input-group-sm mb-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text1">Quantity in a Rake</span>
                                    <span class="input-group-text2">Metric Tonne</span>
                                </div>
                                <input type="number" class="form-control" step="0.01" min="0" id="quantity-in-rake-cal" placeholder="" required>
                            </div>

                            <!-- Start Date -->
                            <div class="input-group input-group-sm mb-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text1">Start Date</span>
                                </div>
                                <input type="date" class="form-control" id="start-date-coal" placeholder="" required>
                            </div>

                            <!-- End Date -->
                            <div class="input-group input-group-sm mb-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text1">End Date</span>
                                </div>
                                <input type="date" class="form-control" id="end-date-coal" placeholder="" required>
                            </div>
                                                       
                            <!-- Quarter Percentage Inputs <span class="badge badge-info-custom mb-1">Enter Quarterly Percentages</span>-->                             
                            


                             <!-- Input fields for quarterly percentages -->
                                    <div class="d-flex flex-row flex-wrap gap-1 mb-0" style="max-width: 100%;">
                                <!-- Q1 (Apr-Jun) -->
                                <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text3">Q1 (Apr-Jun)</span>
                                    <span class="input-group-text4">%</span>
                                    </div>
                                    <input type="number" class="form-control quarter-inputCal1" step="0.01" min="0" max="100" id="q1-percentage" value="25" placeholder="" required>
                                    </div>

                                <!-- Q2 (Jul-Sep) -->
                                <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text3">Q2 (Jul-Sep)</span>
                                        <span class="input-group-text4">%</span>
                                    </div>
                                    <input type="number" class="form-control quarter-inputCal1" step="0.01" min="0" max="100" id="q2-percentage" value="22" placeholder="" required>
                                </div>

                                <!-- Q3 (Oct-Dec) -->
                                <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text3">Q3 (Oct-Dec)</span>
                                        <span class="input-group-text4">%</span>
                                    </div>
                                    <input type="number" class="form-control quarter-inputCal1" step="0.01" min="0" max="100" id="q3-percentage" value="25" placeholder="" required>
                                </div>

                                <!-- Q4 (Jan-Mar) -->
                                <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text3">Q4 (Jan-Mar)</span>
                                        <span class="input-group-text4">%</span>
                                    </div>
                                    <input type="number" class="form-control quarter-inputCal1" step="0.01" min="0" max="100" id="q4-percentage" value="28" placeholder="" required>
                                </div>
                                </div>
                                
                            <p id="error-messageCal1" style="color: red; display: none; margin-bottom: 0;"></p>

                            <!-- Option Button to show/hide the action buttons -->
                            <button class="btn btn-secondary mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#coalAvailabilityOptions" aria-expanded="false" aria-controls="coalAvailabilityOptions">
                                <i class="bi bi-three-dots"></i>
                            </button>

                            <!-- Collapsible button group -->
                            <div class="collapse" id="coalAvailabilityOptions">
                                <div class="d-flex flex-wrap gap-2 mt-1">
                                    <button class="btn btn-outline-dark btn-sm" type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#AvaiablecoalFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="generatePDFForCoalAvailability()">Print PDF</button>
                                </div>
                            </div>
                            
                            <div class="collapse" id="AvaiablecoalFormula">
                                <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                                    <ol>
                                        <li><em style="font-size: smaller;"> <b>Quarterly Quantity :</b> <u>Q1 (April to June)</u> = ACQ x 25%, <u>Q2 (July to Sept)</u> = ACQ x 22%, <u>Q3 (Oct to Dec)</u> = ACQ x 25% and <u>Q4 (Jan to march)</u> = ACQ x 28%</em></li> 
                                        <li><em style="font-size: smaller;"> <b>Monthly Quantity : </b>Quarterly Quantity / 3</em></li> 
                                        <li><em style="font-size: smaller;"> <b>Day Quantity :</b>Quantity during the Selected Month of the Selected Quarter / days in that Month</em> </li> 
                                        <li><em style="font-size: smaller;"> <b>Selected Period Quantity :</b>Sum of Day Quantities during the selected Period</em></li>
                                    </ol>     
                                </div>
                            </div>
     

                       
                    </div>
                </div>                   
            </div></div>
                    

<!-- Tab 7: Coal Linkage Calculator Advanced-->
                                          <div class="card-body">                        

            <div class="card mb-2" id="coal-availabilityAdvancedHeader">
                <div class="card-header" id="coal-availabilityAdvancedHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#coal-availabilityAdvancedTab"
                                aria-expanded="false" aria-controls="coal-availabilityAdvancedTab" onclick="delayedScrollToAccordionTab('coal-availabilityAdvancedHeader')">
                                <span class="tab-text">Coal Linkage Advance Calculator</span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Calculates Coal Linkage during the a period as per the ACQ and Quantity already Supplied</H6>
                </div>
            
                <div id="coal-availabilityAdvancedTab" class="collapse" aria-labelledby="coal-availabilityAdvancedHeader"
                     data-parent="#coalTabs">
                     <div class="card-body">    

            
                    <!-- Coal Linkage Calculator HTML code here -->
<div id="input-error-badge" style="display:none"></div>
                   <!-- Allocated Annual Coal Quantity -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Annual Coal Quantity</span>
                            <span class="input-group-text2">Metric Tonne</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="acq-input" placeholder="" required>
                    </div>

                    <!-- Quantity in a Rake -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Quantity in a Rake</span>
                            <span class="input-group-text2">Metric Tonne</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="rake-quantity-input" placeholder="" required>
                    </div>
                                        

                    <div>
                        <!--quarterly-percentage-badge                        <span class="badge badge-info-custom mb-1">Enter Quarterly Percentages</span>
-->

                        <div class="d-flex flex-row flex-wrap gap-1 mb-1" style="max-width: 100%;">
                            <!-- Q1 (Apr-Jun) -->
                            <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                <div class="input-group-prepend">
                                    <span class="input-group-text3">Q1 (Apr-Jun)</span>
                                    <span class="input-group-text4">%</span>
                                </div>
                                <input type="number" class="form-control quarter-input" step="0.01" min="0" max="100" id="quarter-1" value="25" placeholder="" required>
                            </div>

                            <!-- Q2 (Jul-Sep) -->
                            <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                <div class="input-group-prepend">
                                    <span class="input-group-text3">Q2 (Jul-Sep)</span>
                                    <span class="input-group-text4">%</span>
                                </div>
                                <input type="number" class="form-control quarter-input" step="0.01" min="0" max="100" id="quarter-2" value="22" placeholder="" required>
                            </div>

                            <!-- Q3 (Oct-Dec) -->
                            <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                <div class="input-group-prepend">
                                    <span class="input-group-text3">Q3 (Oct-Dec)</span>
                                    <span class="input-group-text4">%</span>
                                </div>
                                <input type="number" class="form-control quarter-input" step="0.01" min="0" max="100" id="quarter-3" value="25" placeholder="" required>
                            </div>

                            <!-- Q4 (Jan-Mar) -->
                            <div class="input-group input-group-sm mb-1" style="max-width: 200px;">
                                <div class="input-group-prepend">
                                    <span class="input-group-text3">Q4 (Jan-Mar)</span>
                                    <span class="input-group-text4">%</span>
                                </div>
                                <input type="number" class="form-control quarter-input" step="0.01" min="0" max="100" id="quarter-4" value="28" placeholder="" required>
                            </div>
                        </div>

                        
                        <p id="error-message" style="color: red; display: none; margin-bottom: 0%;">The total percentage cannot exceed 100%.</p>
                      </div>
                      





                   <button id="copy-cells-btn" class="btn btn-primary btn-sm mb-1">Copy to Actual Quantity</button>
                   <!-- Option Button to show/hide the action buttons -->
                        <button class="btn btn-secondary btn-sm mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#coalLinkageAdvanceOptions" aria-expanded="false" aria-controls="coalLinkageAdvanceOptions">
                            <i class="bi bi-three-dots"></i>
                        </button>

                        <!-- Collapsible button group -->
                        <div class="collapse" id="coalLinkageAdvanceOptions">
                            <div class="d-flex flex-wrap gap-2 mt-1 mb-1">
                                <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#AdvanceAvaiablecoalFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                <button class="btn btn-outline-danger" onclick="generatePDFforCoalLinkageAdvance()">Print PDF</button>
                            </div>
                        </div>


                    <div class="collapse" id="AdvanceAvaiablecoalFormula">
                        <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                            <ol>
                                Say,
                                <em style="font-size: smaller;">ACQ = 70,00,000 MT</em><br> 
                                <em style="font-size: smaller;">Q1 (25%) = 17,50,000 MT</em><br> 
                                <em style="font-size: smaller;">Q2 (22%) = 15,40,000 MT</em><br> 
                                <em style="font-size: smaller;">Q3 (25%) = 17,50,000 MT</em><br> 
                                <em style="font-size: smaller;">Q4 (28%) = 19,60,000 MT</em><br><br>

                                <em style="font-size: smaller;">Let Q1 = 0 MT</em><br> 
                                <em style="font-size: smaller;">So the ACQ of 17,50,000 of Q1 will be redistributed proportionally amongst Q2, Q3 & Q4, based on the allocated quantity for each month as a percentage of the total ACQ for July to March.</em><br><br> 
                                <em style="font-size: smaller;">Remaining Total ACQ = 15,40,000 + 17,50,000 + 19,60,000 = 52,50,000</em><br><br> 

                                <em style="font-size: large;">Calculation of Proportional Distribution of ACQ</em><br><br>    

                                <em style="font-size: smaller;">For Q2 (July, August, September) with total ACQ of 15,40,000:</em><br>
                                <ul>
                                <li>Percentage of total ACQ = 15,40,000 / 52,50,000 ≈ 0.2924 (29.24%)</li>
                                <li>Remaining ACQ for Q2 = 17,50,000 * 0.2924 ≈ 5,10,667 </li>
                                <li>Each month (July, August, September) will get: 5,10,667 / 3 ≈ 1,70,222 each </li>
                                </ul><br> 

                                <em style="font-size: smaller;">For Q3 (October, November, December) with total ACQ of 17,50,000:</em>
                                <ul>
                                <li>Percentage of total ACQ = 17,50,000 / 52,50,000 ≈ 0.3333 (33.33%)</li>
                                <li>Remaining ACQ for Q3 = 17,50,000 * 0.3333 ≈ 5,83,333 </li>
                                <li>Each month (October, November, December) will get: 5,83,333 / 3 ≈ 1,94,444 each</li>
                                </ul><br>

                                <em style="font-size: smaller;">For Q4 (January, February, March) with total ACQ of 19,60,000:</em>
                                <ul>
                                <li>Percentage of total ACQ = 19,60,000 / 52,50,000 ≈ 0.3733 (37.33%)</li>
                                <li>Remaining ACQ for Q4 = 17,50,000 * 0.3733 ≈ 6,52,000 </li>
                                <li>Each month (January, February, March) will get: 6,52,000 / 3 ≈ 2,17,333 each</li>
                                </ul><br>

                                
                            </ol>     
                        </div>
                    </div>

                    <!-- Monthly Table -->
                    <div class="responsive-table-wrapper">
                    <caption><span class="centered-span">Monthly Values</span></caption>

                        <table id="coal-table" class="table table-bordered table-hover table-striped text-center align-middle table-sm CoalLinkageAdvance-table" style="table-layout: fixed;">
                            <thead class="table-dark">
                                <tr>
                                    <th>Month</th>
                                    <th>Allocated Quantity  </th>
                                    <th>Allocated Rakes</th>
                                    <th>Actual Quantity <i class="bi bi-pencil-square editable-icon"></i></th>
                                    <th>Actual Rakes</th>
                                    <th>%age (Actual / Allocated)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>April</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>May</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>June</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>July</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>August</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>September</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>October</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>November</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>December</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>January</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>February</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                                <tr><td>March</td><td></td><td></td><td contenteditable="true" class="actual-quantity"></td><td></td><td></td></tr>
                            </tbody>
                        </table>
                    </div>
                     
        <!-- Quarterly Table -->
        <div class="responsive-table-wrapper">
                        <caption><span class="centered-span">Quarterly Values</span></caption>

            <table id="quarterly-table" class="table table-bordered table-hover table-striped text-center align-middle table-sm CoalLinkageAdvance-table" style="table-layout: fixed;">
                <thead class="table-dark">
                    <tr>
                        <th>Quarter</th>
                        <th>Allocated Quantity</th>
                        <th>Allocated Rakes</th>
                        <th>Actual Quantity</th>
                        <th>Actual Rakes</th>
                        <th>%age (Actual / Allocated)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                      <td id="q1-label">Q1 (Apr-Jun) 25%</td>
                      <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                      <td id="q2-label">Q2 (Jul-Sep) 22%</td>
                      <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                      <td id="q3-label">Q3 (Oct-Dec) 25%</td>
                      <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                      <td id="q4-label">Q4 (Jan-Mar) 28%</td>
                      <td></td><td></td><td></td><td></td><td></td>
                    </tr>
                  </tbody>
                
            </table>


        <!-- Per Day Values Table -->
        <div class="responsive-table-wrapper">
        <caption><span class="centered-span">Per Day Values</span></caption>

            <table id="per-day-table" class="table table-bordered table-hover table-striped text-center align-middle table-sm CoalLinkageAdvance-table" style="table-layout: fixed;">
                <thead class="table-dark">
                    <tr>
                        <th>Month</th>
                        <th>Allocated Quantity</th>
                        <th>Allocated Rakes</th>
                        <th>Actual Quantity</th>
                        <th>Actual Rakes</th>
                        <th>%age (Actual / Allocated)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>April</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>May</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>June</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>July</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>August</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>September</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>October</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>November</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>December</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>January</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>February</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td>March</td><td></td><td></td><td></td><td></td><td></td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div> 
  </div>
</div></div>








<!-- Tab 7: Imported Coal Blending cost economics Calculator -->
                     <div class="card-body">

            <div class="card mb-2" id="blendedCoalHeader">
                <div class="card-header" id="blendedCoalHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#blendedCoalTab"
                                aria-expanded="false" aria-controls="blendedCoalTab" onclick="delayedScrollToAccordionTab('blendedCoalHeader')">
                                <span class="tab-text"> Blended Coal Analysis</span>
                        </button>
                    </h2>
                        <h6 class="calulatordiscription">Calculates cost economics of Blending of Two Types of Coal</H6>
                </div>

            <div id="blendedCoalTab" class="collapse" aria-labelledby="blendedCoalHeader"
            data-parent="#coalTabs">
             
                     <div class="card-body">    
<div class="mt-2" id="resultshow70" style="display: none;">
  <div class="d-flex flex-wrap gap-1">
    <span class="badge rounded-pill bg-danger text-white px-3 py-2">
      <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
      <span id="blending-error-result">Please enter all the inputs for result.</span>
    </span>
  </div>
</div>
                    <!-- Blended Coal Energy Charges Calculator HTML Form -->                    
                    <div class="mt-2" id="resultshowblending" style="display: none;">
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge rounded-pill bg-success text-dark">
                                <span id="blended-coal-perunitcost"></span>
                            </span>
                            <span class="badge rounded-pill bg-dark text-white">
                                <span id="blended-coal-addlfinancialliability"></span>
                            </span>
                        </div></div>
                        
                      <div class="input-group input-group-sm mb-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text1">Coal Source</span>
                                            <span class="input-group-text2"></span>

                                        </div>
                                        <input type="text" class="form-control" id="coalA-blending-name" data-allow-text="true" placeholder="" required>
                                        <input type="text" class="form-control" data-allow-text="true"   id="coalB-blending-name" placeholder="" required>

                                    </div>
                        <!-- Coal Cost -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">Coal Cost</span>
                                <span class="input-group-text2">Rs / MT</span>
                            </div>
                            <input type="number" class="form-control" step="0.01" min="0" id="coal-cost-indian" placeholder="" required>
                            <input type="number" class="form-control" step="0.01" min="0" id="coal-cost-imported" placeholder="" required>

                        </div>

                        <!-- Railway Freight -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">Railway Freight</span>
                                <span class="input-group-text2">Rs / MT</span>
                            </div>
                            <input type="number" class="form-control" step="0.01" min="0" id="railway-freight-indian" placeholder="" required>
                            <input type="number" class="form-control" step="0.01" min="0" id="railway-freight-imported" placeholder="" required>
                        </div>

                        <!-- GCV (ARB) -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">GCV (ARB)</span>
                                <span class="input-group-text2">kcal / kg</span>
                            </div>
                            <input type="number" class="form-control" step="0.01" min="0" id="gcv-arb-Indian" placeholder="" required>
                            <input type="number" class="form-control" step="0.01" min="0" id="gcv-arb-Imported" placeholder="" required>
                        </div>

                        
                    <!-- Plant related Input Field-->
                    <span class="badge badge-info mb-1">Plant Parameters</span>


                    <!-- Generation Capacity -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Generation Capacity</span>
                            <span class="input-group-text2">MW</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="generationcapacity-blended" placeholder="" required>
                    </div>

                    <!-- Plant Load Factor -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Plant Load Factor</span>
                            <span class="input-group-text2">%</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="plf-blended" placeholder="" required>
                    </div>

                    <!-- Days -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Days</span>
                            <span class="input-group-text2">Days</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="days-blended" placeholder="" required>
                    </div>

                    <!-- Station Heat Rate -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Station Heat Rate</span>
                            <span class="input-group-text2">kcal / kWh</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="shr-blended" placeholder="" required>
                    </div>

                    <!-- Blending Ratio -->
                    <div class="input-group input-group-sm mb-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">Blending Ratio</span>
                            <span class="input-group-text2">%</span>
                        </div>
                        <input type="number" class="form-control" step="0.01" min="0" id="blending-ratio" placeholder="" required>
                    </div>
                    
                    <!-- Option Button to show/hide the action buttons -->
                    <button class="btn btn-secondary btn-sm mt-1 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#blendedCoalOptions" aria-expanded="false" aria-controls="blendedCoalOptions">
                        <i class="bi bi-three-dots"></i>
                    </button>

                    <!-- Collapsible button group -->
                    <div class="collapse" id="blendedCoalOptions">
                        <div class="d-flex flex-wrap gap-2 mt-1">
                            <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#BlendedFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                            <button class="btn btn-outline-danger" type="button" onclick="generatePDFblendedcoal()">Print PDF</button>
                        </div>
                    </div>
                    
                    <div class="collapse" id="BlendedFormula">
                        <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                            <ol>
                                <li><em style="font-size: smaller;"> Landed Cost (Blended Coal), Rs./MT= [Landed Cost Indigenous Coal * {1 - (Blending Ratio / 100)}] + [Landed Cost Imported Coal * {Blending Ratio / 100}]</em></li> 
                                <li><em style="font-size: smaller;"> GCV (Blended Coal), kcal/kg = [GCV Indigenous Coal * {1 - (Blending Ratio / 100)}] + [GCV Imporetd Coal * {Blending Ratio / 100}]</em></li> 
                                <li><em style="font-size: smaller;"> Energy Charges (Blended Coal), kcal/kWh = (Landed Coal Blended Coal * SHR) / (GCV Blended Coal * 1000)</em></li> 
                                <li><em style="font-size: smaller;"> Increase in Energy Charges due to Blending, kWh/kg = Energy Charges Blended Coal - Energy Charges Indigenous Coal</em></li>
                            </ol>     
                        </div>
                    </div>
 
                   <!-- Blending Result Table -->


<div class="table-responsive mt-2" id="resultshow71" style="display: none;">
  <table class="table table-bordered table-sm text-center align-middle blended-analysis-table ">
    <thead class="table-dark">
      <tr>
        <th>Parameter</th>
        <th id="coalA-header"></th>
        <th id="coalB-header"></th>
        <th>Blended Coal</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Quantity Required (Lakh MT)</td>
        <td><span id="indian-coal-quantity"></span></td>
        <td>—</td>
        <td>—</td>
      </tr>
      <tr>
        <td>Blending Ratio (%)</td>
        <td><span id="indian-coal-quantity-ratio-after-blending"></span></td>
        <td><span id="imported-coal-quantity-ratio-after-blending"></span></td>
        <td>—</td>
      </tr>
      <tr>
        <td>Quantity Required for Blending (Lakh MT)</td>
        <td><span id="indian-coal-quantity-after-blending"></span></td>
        <td><span id="imported-coal-quantity-after-blending"></span></td>
        <td><span id="blendedcoal"></span></td>
      </tr>
      <tr>
        <td>GCV ARB (kcal/kg)</td>
        <td><span id="gcv-arb-Indian-table"></span></td>
        <td><span id="gcv-arb-Imported-tabel"></span></td>
        <td><span id="gcv-blended"></span></td>
      </tr>
      <tr>
        <td>Landed Cost (Rs/MT)</td>
        <td><span id="indian-coal-landed-charges-MT"></span></td>
        <td><span id="Imported-coal-landed-charges-MT"></span></td>
        <td><span id="landed-cost-blended-MT"></span></td>
      </tr>
      <tr>
        <td>Landed Cost (Rs/MCal)</td>
        <td><span id="indian-coal-landed-charges-MC"></span></td>
        <td><span id="Imported-coal-landed-charges-MC"></span></td>
        <td><span id="landed-cost-blended-MC"></span></td>
      </tr>
      <tr>
        <td>Per Unit Cost (Rs/kWh)</td>
        <td><span id="indian-coal-energy-charges"></span></td>
        <td><span id="Imported-coal-energy-charges"></span></td>
        <td><span id="blended-coal-energy-charges"></span></td>
      </tr>
      <tr>
        <td>Specific Coal Consumption (kg/kWh)</td>
        <td><span id="indian-coal-SCC"></span></td>
        <td><span id="Imported-coal-SCC"></span></td>
        <td><span id="blended-coal-SCC"></span></td>
      </tr>
      <tr>
        <td>Increase in Per Unit Cost (Rs/kWh)</td>
        <td>—</td>
        <td>—</td>
        <td><span id="comparison-result"></span></td>
      </tr>
      <tr>
        <td>Additional Financial Liability (Rs.)</td>
        <td>—</td>
        <td>—</td>
        <td><span id="additionalFinancialLiabilityImported-result"></span></td>
      </tr>
      <tr>
        <td>Units Generated (LUs)</td>
        <td>—</td>
        <td>—</td>
        <td><span id="unitsGeneratedBlended-result"></span></td>
      </tr>
    </tbody>
  </table>
</div>

                    </div>
                </div>                
            </div></div>
       
<!-- Tab 8: Additonal Financial Liability of using Alternate Fuel -->
    <div class="card-body">

<div class="card mb-2" id="additionalFinancialLiability">
    <div class="card-header" id="additionalFinancialLiability1">
        <h2 class="mb-0">
            <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#additionalFinancialLiabilityTab"
                    aria-expanded="false" aria-controls="additionalFinancialLiabilityTab"onclick="delayedScrollToAccordionTab('additionalFinancialLiability')">
                    <span class="tab-text"> Alternate Fuel Cost Economics</span>
            </button>
        </h2>
            <h6 class="calulatordiscription">Calculate Annual Additional Financial Liability for using Alternate Fuel</H6>
    </div>

    <div id="additionalFinancialLiabilityTab" class="collapse" aria-labelledby="additionalFinancialLiabilityHeader"
         data-parent="#coalTabs">
        
                <div class="card-body">
            <!-- HTML code here -->  
           <!-- Result section for Additional Financial Liability Calculator -->
                    
                    <!-- Flex Info Chip Output Style for Additional Financial Liability -->
                    <div class="mt-2" id="resultshow8" style="display: none;">
                    <div class="d-flex flex-wrap gap-2">
                        <span class="badge rounded-pill bg-danger text-white px-3 py-2">
                        <span id="additionalFinancialLiability-result"></span>
                        </span>
                    </div>
                    </div>
                  <!-- Linked Coal Inputs-->
                        <span class="badge badge-warning mb-1">Linked Coal</span>   

                        <!-- ACQ of Linked Coal -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">ACQ of Linked Coal</span>
                                <span class="input-group-text2">Metric Tonne</span>
                            </div>
                            <input type="number" step="0.01" min="0" class="form-control" id="afl-ACR" placeholder="" required>
                        </div>

                        <!-- Landed Coal Cost -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">Landed Coal Cost</span>
                                <span class="input-group-text2">Rs / Million Calorie</span>
                            </div>
                            <input type="number" step="0.01" min="0" class="form-control" id="afl-Landedcostlinked" placeholder="" required>
                        </div>

                        <!-- GCV -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">GCV</span>
                                <span class="input-group-text2">kcal / kg</span>
                            </div>
                            <input type="number" step="0.01" min="0" class="form-control" id="afl-GCVlinked" placeholder="" required>
                        </div>

                    <!-- Alternate Fuel Inputs-->
                        <span class="badge badge-success mb-1">Alternate Fuel</span>   

                        <!-- Alternate Fuel to be used (%) -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">Alternate Fuel</span>
                                <span class="input-group-text2">%</span>
                            </div>
                            <input type="number" step="0.01" min="0" class="form-control" id="afl-AFpercentage" placeholder="" required>
                        </div>

                        <!-- Landed Fuel Cost -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">Landed Fuel Cost</span>
                                <span class="input-group-text2">Rs / Million Calorie</span>
                            </div>
                            <input type="number" step="0.01" min="0" class="form-control" id="afl-LandedcostAlternate" placeholder="" required>
                        </div>

                        <!-- GCV (Alternate Fuel) -->
                        <div class="input-group input-group-sm mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">GCV</span>
                                <span class="input-group-text2">kcal / kg</span>
                            </div>
                            <input type="number" step="0.01" min="0" class="form-control" id="afl-GCVAlternate" placeholder="" required>
                        </div>
                   
                    <button type="button" class="btn btn-primary btn-sm mt-1" onclick="calculateAdditionalFinancialLiability()">Calculate</button>

                    <!-- Option Button to show/hide the action buttons -->
                        <button class="btn btn-secondary btn-sm mt-1" type="button" data-bs-toggle="collapse" data-bs-target="#aflOptions" aria-expanded="false" aria-controls="aflOptions">
                            <i class="bi bi-three-dots"></i>
                        </button>

                        <!-- Collapsible button group -->
                        <div class="collapse" id="aflOptions">
                            <div class="d-flex flex-wrap gap-2 mt-1">
                                <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#aflFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                <button class="btn btn-outline-danger" type="button" onclick="generatePDFForAdditionalFinancialLiability()">Print PDF</button>
                                <button type="button" class="btn btn-outline-success position-relative" onclick="clearAFLParameterValues()">
                                    Clear Data
                                    <span class="position-absolute top-0 start-100 translate-middle badge bg-danger" id="alfrowCountBadge">0</span>
                                </button>
                            </div>
                        </div>
                    
                    <div class="collapse" id="aflFormula">
                        <div class="card card-body mt-2 mb-1" style="width: fit-content;">
                            <em style="font-size: smaller;"> <b>Additional Financial Liability :</b> (Annual Coal Requriement x Percentage of Alternate Fuel) x [(Landed Cost of Alternate Fuel x GCV of Alternate Fuel) - (Landed cost of Linked Coal x GCV of Linked Coal)] / 10^9</em>
                        </div>
                    </div>
                    
         
<div class="table-responsive mt-2" id="aflTableContainer" style="display:none;">
  <table class="table table-bordered table-sm text-center align-middle CoalLinkageAdvance-table" id="aflTable">
    <thead class="table-dark">
      <tr id="aflTableHeaderRow">
        <th>Parameter</th>
        <!-- Plant columns will be added by JS -->
      </tr>
    </thead>
    <tbody id="aflTableBody">
      <!-- Parameter rows will be added by JS -->
    </tbody>
    <tfoot id="aflTableFooter">
      <!-- Totals will be added by JS -->
    </tfoot>
  </table>
</div>




                </div>
            </div>
       
    </div>
</div>

<!-- Tab 9: Coal Scenario Calculator -->
            <div class="card-body">
            
            <div class="card mb-2" id="coalscenarioHeader">
                <div class="card-header" id="coalscenarioHeader1">
                    <h2 class="mb-0">
                        <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#coalscenarioTab"
                                aria-expanded="false" aria-controls="coalscenarioTab" onclick="delayedScrollToAccordionTab('coalscenarioHeader')">
                                <span class="tab-text"> Coal Scenario Calculator</span>
                        </button>
                    </h2>
                    
                    <div class="container mt-1">
                        <h6 class="calulatordiscription">Calculate Closing Coal Stock based upon Generation, PLF, Coal Availability and Opening Coal Stock </H6>
                    </div>
                </div>

                <div id="coalscenarioTab" class="collapse" aria-labelledby="coalscenarioHeader"
                    data-parent="#coalTabs">                
                                            
                        <!-- Coal Linkage Calculator HTML code here -->   
                                            
                        <div class="card-body">
                            
                            <div class="card border-dark border-2 shadow mb-0 bg-white rounded" style="padding: 8px;"> 
                                <div class="card-header bg-dark text-white mb-1" style="font-size: larger; font-weight: bolder; border-radius: 5px;"><h1 class="animate-charcter" style="font-size: larger;">Coal Scenario</h1></div>


                                <div class="d-flex flex-row flex-wrap gap-1 mb-0">
                                <!-- Power Plant Name -->
                                    <div class="input-group input-group-sm mb-1" >
                                        <div class="input-group-prepend">
                                            <span class="input-group-text5">Thermal Power Plant Name</span>
                                        </div>
                                        <input type="text" class="form-control3" style="width: 300px;" id="powerplantName" data-allow-text="true" placeholder="" required>
                                    </div>

                                    <!-- Inventory to be maintained (Days) -->
                                    <div class="input-group input-group-sm mb-1"> 
                                        <div class="input-group-prepend">
                                            <span class="input-group-text5">Inventory to be maintained</span>
                                            <span class="input-group-text2">Days</span>
                                        </div>
                                        <input type="number" class="form-control4" style="width: 70px;" id="daysToMaintainStock" value="10" min="1" step="1" placeholder="" required>
                                    </div>
                            </div>                          
                               <div> <button id="addRowBtn" class="btn btn-primary btn-sm mb-1">Add Month</button>
                                <button id="clearValuesBtn" class="btn btn-danger btn-sm mb-1">Clear Values</button>
                             
                               <!-- Add a checkbox below the "Coal Scenario" table -->
                               <div class="form-check form-check-inline form-switch mb-1">
                                <input class="form-check-input mt-1 mb-1" type="checkbox" id="copyValuesCheckbox">
                                <label class="form-check-label" for="copyValuesCheckbox">Autofill</label></div>

                                    <!-- Option Button to show/hide the action buttons -->
                                <button class="btn btn-secondary mb-1 btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#coalScenarioOptions" aria-expanded="false" aria-controls="coalScenarioOptions">
                                    <i class="bi bi-three-dots"></i>
                                </button>

                                <!-- Collapsible button group -->
                                <div class="collapse" id="coalScenarioOptions">
                                    <div class="d-flex flex-wrap gap-2 mt-1 mb-1">
                                        <button class="btn btn-outline-dark btn-sm" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#AvaiablecoalFormula" aria-expanded="false" aria-controls="collapseExample">Formula</button>
                                        <button class="btn btn-outline-danger btn-sm" type="button" onclick="generatePDFForCoalScenario()">Print PDF</button>
                                    </div>
                                </div>



                           </div>
                                <div class="table-responsive">
                                <table id="Table1" class="table table-bordered table-fixed border-dark table-hover table-sm align-top text-wrap custom-table" style="width: 100%; border-width: 3px;">
                                    <thead >
                                        <tr>
                                            <th>Month</th>
                                            <th>Generation Capacity (MW)</th>
                                            <th>PLF (%)</th>
                                            <th>Units Generated (Mus)</th>
                                            <th>Specific Coal Consumption (kg/kWh)</th>
                                            <th>Coal Requirement (MT)</th>
                                            <th>Coal Available (MT)</th>
                                            <th>Opening Coal Stock (MT)</th>
                                            <th>Closing Coal Stock (MT)</th>
                                            <th>Closing Coal Stock (Days)</th>
                                            <th>Remove Row</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody">
                                        <!-- Rows and cells will be added dynamically using JavaScript -->
                                    </tbody>
                                    <!-- Total Row -->
                                    <tfoot >
                                        <tr>
                                            <td>Total</td>
                                            <td></td>
                                            <td></td>
                                            <td id="total-units-generated">0</td>
                                            <td></td>
                                            <td id="total-coal-consumption">0</td>
                                            <td id="total-coal-available">0</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table></div>                              

                                <div id="closingStockWarning" class="alert alert-danger mt-1" style="display: none;"></div>
                            </div></div>


<!-- TABLE NO. 2-->
                            <div class="card-body">
                                <div class="card border-dark border-2 shadow mb-0 bg-white rounded" style="padding: 8px;"> 
                                    <div class="card-header bg-dark text-white mb-1" style="font-size: larger; font-weight: bolder; border-radius: 5px;"><h1 class="animate-charcter" style="font-size: larger;">Coal Availability</h1></div>       

                                      <div>
                                    <button id="copyTotalsButton" class="btn btn-success btn-sm mb-1" type="button" data-bs-toggle="collapse" aria-expanded="false" aria-controls="collapseExample">Use Quantity in First Table</button>
                                    <button id="clearSourceValuesBtn" class="btn btn-danger mb-1 btn-sm mr-1">Clear Values</button>
                                    
                                    <div class="form-check form-check-inline form-switch mb-1">
                                        <input class="form-check-input mt-1 mb-1" type="checkbox" role="switch" id="copyQuantityCheckbox">
                                    <label class="form-check-label mb-1" for="copyQuantityCheckbox">Autofill</label></div>

                                      </div>

                               




                                
                                <div class="table-responsive">
                                <table id="Table2" class="table table-bordered table-fixed border-dark table-sm align-top text-wrap custom-table table-hover" style="width: 100%; border-width: 3px;">
                                    <thead >
                                        <tr>
                                            <th>Month</th>
                                            <th contentEditable="true">Source1 <i class="bi bi-pencil-square editable-icon"></i></th>
                                            <th contentEditable="true">Source2 <i class="bi bi-pencil-square editable-icon"></i></th>
                                            <th contentEditable="true">Source3 <i class="bi bi-pencil-square editable-icon"></i></th>
                                            <th contentEditable="true">Source4 <i class="bi bi-pencil-square editable-icon"></i></th>
                                            <th contentEditable="true">Source5 <i class="bi bi-pencil-square editable-icon"></i></th>
                                            <th>Total</th>
                                            
                                        </tr>
                                    </thead>
                                    <tbody id="coalSourcesTableBody">
                                        <!-- Rows will be added dynamically using JavaScript -->
                                        <tr>
                                            <td>January</td>
                                            <td contenteditable="true" oninput="updateTotal()"></td>
                                            <td contenteditable="true" oninput="updateTotal()"></td>
                                            <td contenteditable="true" oninput="updateTotal()"></td>
                                            <td contenteditable="true" oninput="updateTotal()"></td>
                                            <td contenteditable="true" oninput="updateTotal()"></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                    <tfoot >
                                <tr id="totalRow">
                                    <td>Total</td>
                                    <td contentEditable="false"></td>
                                    <td contentEditable="false"></td>
                                    <td contentEditable="false"></td>
                                    <td contentEditable="false"></td>
                                    <td contentEditable="false"></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                                </table>
                            </div>   
                                                   
                            <div class="collapse" id="AvaiablecoalFormula">
                                <div class="card card-body mb-1" style="width: fit-content;">
                                    <ol>
                                        <li><em style="font-size: smaller;"> <b>Units Generated (MUs) :</b> (Generation Capacity x 24 x PLF x Days in the month) / 1000</em></li> 
                                        <li><em style="font-size: smaller;"> <b>Coal Consumption (MT) : </b> Units Generated x Specific Coal Consumption x 10</em></li> 
                                        <li><em style="font-size: smaller;"> <b>Closing Coal Stock (MT) :</b>Coal Available + Opening Coal Stock - Coal Consumption;</em> </li> 
                                    </ol>     
                                </div>
                            </div>   
                            <div class="input-group input-group-sm mt-1" id="coalScenarioComments">
                                <div class="input-group-prepend" >
                                  <span class="input-group-text">Comments</span>
                                </div>
                                <textarea class="form-control" aria-label="With textarea"></textarea>
                              </div>    
                        </div>       </div> </div>    </div></div>                    
                    </div></div>
             


<!--- HTML for inputs ends here-->        

 
<!-- Include Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

<!-- JavaScript for calculations -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const accordionTabs = document.querySelectorAll('.accordion .card-header');

  accordionTabs.forEach(function (tab) {
    tab.addEventListener('click', function () {
      // Remove active class from all tabs
      accordionTabs.forEach(function (otherTab) {
        otherTab.classList.remove('active');
      });

      // Add active class to the clicked tab
      tab.classList.add('active');
    });
  });
});

// Add an event listener to the accordion button to toggle the 'active' class
document.addEventListener('DOMContentLoaded', function () {
  const accordionButton = document.querySelector('.accordion-button');

  accordionButton.addEventListener('click', function () {
    accordionButton.classList.toggle('active');
  });
});



document.addEventListener('DOMContentLoaded', function () {
        var accordions = document.querySelectorAll('.accordion');

        accordions.forEach(function (accordion) {
            accordion.addEventListener('shown.bs.collapse', function (event) {
                // Remove 'active' class from previously active items
                var activeItems = accordion.querySelectorAll('.accordion-button:not(.collapsed)');
                activeItems.forEach(function (item) {
                    item.classList.remove('active');
                });

                // Add 'active' class to the currently active item
                var currentItem = event.target.parentNode.querySelector('.accordion-button');
                currentItem.classList.add('active');
            });
        });
    });

// JavaScript to scroll to top when an accordion tab is opened
function delayedScrollToAccordionTab(tabId) {
    setTimeout(function() {
        scrollToAccordionTab(tabId);
    }, 300); // Adjust the delay time (in milliseconds) as needed
}
   function scrollToAccordionTab(tabId) {
    const tabElement = document.getElementById(tabId);
    if (tabElement) {
        tabElement.scrollIntoView({
            behavior: 'auto', // You can change this to 'auto' for instant scrolling
            block: 'start', // Scrolls to the top of the screen
        });
    }
}



document.addEventListener('DOMContentLoaded', function () {
  function restrictNumericInput(input) {
    // Prevent non-numeric and negative input on keydown
    input.addEventListener('keydown', function (event) {
      const allowedKeys = [
        "Backspace", "Delete", "ArrowLeft", "ArrowRight", "Tab", "Home", "End"
      ];
      if (allowedKeys.includes(event.key)) return;

      // Allow only one dot
      if (event.key === "." && this.value.includes(".")) {
        event.preventDefault();
        return;
      }
      // Prevent minus, plus, 'e', and any non-digit except dot
      if (
        event.key === '-' || event.key === '+' || event.key === 'e' ||
        (!/^\d$/.test(event.key) && event.key !== ".")
      ) {
        event.preventDefault();
      }
    });

    // Prevent pasting non-numeric or negative values
    input.addEventListener('paste', function (event) {
      const paste = (event.clipboardData || window.clipboardData).getData('text');
      if (!/^\d*\.?\d*$/.test(paste)) {
        event.preventDefault();
      }
    });

    // On blur, clear if not a valid non-negative number
    input.addEventListener('blur', function () {
      const value = parseFloat(this.value.trim());
      if (isNaN(value) || value < 0) {
        this.value = "";
      }
    });
  }

  // Apply to all inputs except those with data-allow-text="true"
  function applyUniversalNumericRestriction() {
    document.querySelectorAll('input:not([data-allow-text="true"])').forEach(input => {
      restrictNumericInput(input);
    });
  }

  // Initial application
  applyUniversalNumericRestriction();

  // If you dynamically add inputs, call applyUniversalNumericRestriction() again after adding them.
});












document.addEventListener('DOMContentLoaded', function () {
    // Prevent Enter key from submitting any form
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
            }
        });
    });
});



document.addEventListener('DOMContentLoaded', function () {
    const energyInputs = [
    document.getElementById("ec-coal-cost"),
    document.getElementById("ec-railway-freight"),
    document.getElementById("ec-shr-energy"),
    document.getElementById("ec-gcv-energy"),
    document.getElementById("ec-energy-charges")
];

    energyInputs.forEach(input => {
        input.addEventListener('input', calculateEnergyCharges);
    });
});

// Initialize an array to store parameter values for Energy Charges calculations
const energyChargesValues = [];

// Function to calculate Energy Charges
function calculateEnergyCharges() {
    let ecCoalCost = parseFloat($("#ec-coal-cost").val());
    let ecRailwayFreight = parseFloat($("#ec-railway-freight").val());
    let ecSHR = parseFloat($("#ec-shr-energy").val());
    let ecGCV = parseFloat($("#ec-gcv-energy").val());
    let ecEnergyCharges = parseFloat($("#ec-energy-charges").val());

    const resultshow1 = document.getElementById('resultshow1');

    // Show error for negative input
    if (
        ecCoalCost < 0 || ecRailwayFreight < 0 ||
        ecSHR < 0 || ecGCV < 0 || ecEnergyCharges < 0
    ) {
        resultshow1.style.display = 'block';
        resultshow1.innerHTML = `
          <div class="d-flex flex-wrap gap-1">
            <span class="badge rounded-pill bg-danger text-white">
              <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
              Please enter valid non-negative inputs.
            </span>
          </div>
        `;
        return;
    }

    // Show error if not exactly 4 inputs are filled
    const values = [ecCoalCost, ecRailwayFreight, ecSHR, ecGCV, ecEnergyCharges];
    const filledCount = values.filter(v => !isNaN(v)).length;
    if (filledCount !== 4) {
        resultshow1.style.display = 'block';
        resultshow1.innerHTML = `
          <div class="d-flex flex-wrap gap-1">
            <span class="badge rounded-pill" style="color:#222;background:#ffe066;">
              <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
              Enter any 4 inputs.
            </span>
          </div>
        `;
        return;
    }

    // Prepare result badge HTML
    resultshow1.style.display = 'block';
    resultshow1.innerHTML = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-primary">
            <span id="ec-energy-charges-result"></span>
        </span>
        <span class="badge rounded-pill bg-success">
          <span id="ec-SCC-result"></span>
        </span>
        <span class="badge rounded-pill bg-warning text-dark px-3 py-2">
            <span id="ec-LandedCostMC-result"></span>
        </span>
      </div>
    `;

    // Calculate and display results based on which input is missing
    if (isNaN(ecEnergyCharges)) {
        // Calculate Energy Charges
        const landedCost = ecCoalCost + ecRailwayFreight;
        const energyCharges = (landedCost * ecSHR) / (ecGCV * 1000);
        const scc = ecSHR / ecGCV;
        const landedCostMC = landedCost / ecGCV;
        $("#ec-energy-charges-result").text("Energy Charges: Rs. " + energyCharges.toFixed(4) + " per kWh");
        $("#ec-SCC-result").text("Specific Coal Consumption: " + scc.toFixed(4) + " kg per kWh");
        $("#ec-LandedCostMC-result").text("Landed Cost: Rs. " + landedCostMC.toFixed(4) + " per Million Calorie");
    } else if (isNaN(ecGCV)) {
        // Calculate GCV
        const landedCost = ecCoalCost + ecRailwayFreight;
        const gcv = (landedCost * ecSHR) / (ecEnergyCharges * 1000);
        const scc = ecSHR / gcv;
        const landedCostMC = landedCost / gcv;
        $("#ec-energy-charges-result").text("GCV: " + gcv.toFixed(2) + " kcal/kg");
        $("#ec-SCC-result").text("Specific Coal Consumption: " + scc.toFixed(4) + " kg per kWh");
        $("#ec-LandedCostMC-result").text("Landed Cost: Rs. " + landedCostMC.toFixed(4) + " per Million Calorie");
    } else if (isNaN(ecSHR)) {
        // Calculate SHR
        const landedCost = ecCoalCost + ecRailwayFreight;
        const shr = (ecEnergyCharges * ecGCV * 1000) / landedCost;
        const scc = shr / ecGCV;
        const landedCostMC = landedCost / ecGCV;
        $("#ec-energy-charges-result").text("SHR: " + shr.toFixed(2) + " kcal/kWh");
        $("#ec-SCC-result").text("Specific Coal Consumption: " + scc.toFixed(4) + " kg per kWh");
        $("#ec-LandedCostMC-result").text("Landed Cost: Rs. " + landedCostMC.toFixed(4) + " per Million Calorie");
    } else if (isNaN(ecRailwayFreight)) {
        // Calculate Railway Freight
        const railwayFreight = ((ecEnergyCharges * ecGCV * 1000) / ecSHR) - ecCoalCost;
        const landedCost = ecCoalCost + railwayFreight;
        const scc = ecSHR / ecGCV;
        const landedCostMC = landedCost / ecGCV;
        $("#ec-energy-charges-result").text("Railway Freight: Rs. " + railwayFreight.toFixed(2) + " per Metric Tonne");
        $("#ec-SCC-result").text("Specific Coal Consumption: " + scc.toFixed(4) + " kg per kWh");
        $("#ec-LandedCostMC-result").text("Landed Cost: Rs. " + landedCostMC.toFixed(4) + " per Million Calorie");
    } else if (isNaN(ecCoalCost)) {
        // Calculate Coal Cost
        const coalCost = ((ecEnergyCharges * ecGCV * 1000) / ecSHR) - ecRailwayFreight;
        const landedCost = coalCost + ecRailwayFreight;
        const scc = ecSHR / ecGCV;
        const landedCostMC = landedCost / ecGCV;
        $("#ec-energy-charges-result").text("Coal Cost: Rs. " + coalCost.toFixed(2) + " per Metric Tonne");
        $("#ec-SCC-result").text("Specific Coal Consumption: " + scc.toFixed(4) + " kg per kWh");
        $("#ec-LandedCostMC-result").text("Landed Cost: Rs. " + landedCostMC.toFixed(4) + " per Million Calorie");
    }
}

// Function to store the parameter values for Energy Charges calculations
// This function should be called after the calculation is done
function storeEnergyChargesValues() {
    let ecCoalCost = parseFloat(document.getElementById("ec-coal-cost").value);
    let ecRailwayFreight = parseFloat(document.getElementById("ec-railway-freight").value);
    let ecSHR = parseFloat(document.getElementById("ec-shr-energy").value);
    let ecGCV = parseFloat(document.getElementById("ec-gcv-energy").value);
    let ecEnergyCharges = parseFloat(document.getElementById("ec-energy-charges").value);

    // Calculate Landed Cost
    let landedCost = (!isNaN(ecCoalCost) && !isNaN(ecRailwayFreight)) ? (ecCoalCost + ecRailwayFreight) : NaN;

    // Calculate missing parameter if only one is missing
    let missingCount = [isNaN(ecCoalCost), isNaN(ecRailwayFreight), isNaN(ecSHR), isNaN(ecGCV), isNaN(ecEnergyCharges)].filter(Boolean).length;

    if (missingCount > 1) {
        alert("Please enter any 4 inputs.");
        return;
    }

    // Calculate the missing parameter
    if (isNaN(ecCoalCost)) {
        // Coal Cost = ((Energy Charges * GCV * 1000) / SHR) - Railway Freight
        if (!isNaN(ecEnergyCharges) && !isNaN(ecGCV) && !isNaN(ecSHR) && !isNaN(ecRailwayFreight)) {
            ecCoalCost = ((ecEnergyCharges * ecGCV * 1000) / ecSHR) - ecRailwayFreight;
        }
    } else if (isNaN(ecRailwayFreight)) {
        // Railway Freight = ((Energy Charges * GCV * 1000) / SHR) - Coal Cost
        if (!isNaN(ecEnergyCharges) && !isNaN(ecGCV) && !isNaN(ecSHR) && !isNaN(ecCoalCost)) {
            ecRailwayFreight = ((ecEnergyCharges * ecGCV * 1000) / ecSHR) - ecCoalCost;
        }
    } else if (isNaN(ecSHR)) {
        // SHR = (Energy Charges * GCV * 1000) / Landed Cost
        if (!isNaN(ecEnergyCharges) && !isNaN(ecGCV) && !isNaN(landedCost)) {
            ecSHR = (ecEnergyCharges * ecGCV * 1000) / landedCost;
        }
    } else if (isNaN(ecGCV)) {
        // GCV = (Landed Cost * SHR) / (Energy Charges * 1000)
        if (!isNaN(landedCost) && !isNaN(ecSHR) && !isNaN(ecEnergyCharges)) {
            ecGCV = (landedCost * ecSHR) / (ecEnergyCharges * 1000);
        }
    } else if (isNaN(ecEnergyCharges)) {
        // Energy Charges = (Landed Cost * SHR) / (GCV * 1000)
        if (!isNaN(landedCost) && !isNaN(ecSHR) && !isNaN(ecGCV)) {
            ecEnergyCharges = (landedCost * ecSHR) / (ecGCV * 1000);
        }
    }

    // Recalculate Landed Cost and derived values
    landedCost = (!isNaN(ecCoalCost) && !isNaN(ecRailwayFreight)) ? (ecCoalCost + ecRailwayFreight) : NaN;
    const ecSCC = (!isNaN(ecSHR) && !isNaN(ecGCV)) ? (ecSHR / ecGCV) : NaN;
    const landedCostMC = (!isNaN(landedCost) && !isNaN(ecGCV)) ? (landedCost / ecGCV) : NaN;

    // Store as strings (toFixed returns string, "" if NaN)
    const parameterValueObj = {
        "Coal Cost (Rs/MT)": isNaN(ecCoalCost) ? "" : ecCoalCost.toFixed(2),
        "Railway Freight (Rs/MT)": isNaN(ecRailwayFreight) ? "" : ecRailwayFreight.toFixed(2),
        "Landed Cost (Rs/MT)": isNaN(landedCost) ? "" : landedCost.toFixed(2),
        "GCV (kcal/kg)": isNaN(ecGCV) ? "" : ecGCV.toFixed(2),
        "Landed Cost (Rs/MCal)": isNaN(landedCostMC) ? "" : landedCostMC.toFixed(3),
        "Station Heat Rate (kcal/kWh)": isNaN(ecSHR) ? "" : ecSHR.toFixed(2),
        "Specific Coal Consumption (kg/kWh)": isNaN(ecSCC) ? "" : ecSCC.toFixed(3),
        "Energy Charges (Rs/kWh)": isNaN(ecEnergyCharges) ? "" : ecEnergyCharges.toFixed(2)
    };

    energyChargesValues.push(parameterValueObj);
    updateRowCountBadgeEnergyCharges();
}

// Update the row count badge for Energy Charges calculations
function updateRowCountBadgeEnergyCharges() {
    $("#rowCountBadgeEnergyCharges").text(energyChargesValues.length);
}

// Function to clear the array for Energy Charges calculations
function clearEnergyChargesValues() {
    // Ask for confirmation before clearing
    const confirmation = confirm("Do you really want to clear the calculations?");
    if (confirmation) {
        energyChargesValues.splice(0, energyChargesValues.length); // Clear the array
        updateRowCountBadgeEnergyCharges(); // Update the row count badge
        $("#ec-energy-charges-result").text(""); // Clear the result
    }
}

// Function to generate a PDF with all stored parameter values for Energy Charges calculations
function generatePDFWithStoredValuesEnergyCharges() {
    if (energyChargesValues.length === 0) {
        alert("No parameter values are stored.");
        return;
    }

    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("Energy Charges", 25, 25);

    // Create content for the PDF with a table containing all stored parameter values
    const tableData = [];
    const parameterNames = Object.keys(energyChargesValues[0]);

    // Add the parameter names as the first row
    tableData.push(["Sr. No.", ...parameterNames]);

    // Add the parameter values as rows
    energyChargesValues.forEach((valueObj, index) => {
        const rowData = [`(${index + 1})`];
        parameterNames.forEach(parameter => {
            rowData.push(valueObj[parameter]);
        });
        tableData.push(rowData);
    });

    // Add the table to the PDF
    doc.autoTable({
        startY: 30,
        head: tableData.slice(0, 1),
        body: tableData.slice(1),
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 15 },
        columnStyles: {
            0: { halign: "left" },
            1: { halign: "center" },
            2: { halign: "center" },
            3: { halign: "center" },
            4: { halign: "center" },
            5: { halign: "center" },
            6: { halign: "center" },
            7: { halign: "center" },
            8: { halign: "center" },
        },
      //  styles: {
      //  fontSize: 12, // Set the default font size for the entire table
      //  head: { fontSize: 12, textColor: [0, 0, 0] }, // Set font size and text color for the header
      //  body: { fontSize: 10, textColor: [0, 0, 0] }, // Set font size and text color for the body
   // },
   
    });

    // Save the PDF
    doc.save("EnergyCharges.pdf");
}

// Event listener for button click
$("#calculate-button").click(function () {
    calculateEnergyCharges();
});

// Event listener for clear button
$("#clear-button").click(function () {
    clearEnergyChargesValues();
});

// Event listener for print PDF button
$("#print-pdf-button").click(function () {
    generatePDFWithStoredValuesEnergyCharges();
});

// Initialize an array to store parameter values for Coal Requirement calculations
const coalRequirementValues = [];

// Function to calculate Coal Requirement Generation

document.addEventListener('DOMContentLoaded', function () {
    // Automatically restrict the value of PLF to 100
    const plfInput = document.getElementById('plf-gen');
    plfInput.addEventListener('input', function (event) {
        const input = event.target;
        if (parseFloat(input.value) > 100) {
            input.value = 100; // Reset the value to 100 if it exceeds the limit
        }
    });

    // Automatically calculate Coal Requirement Generation when inputs change
    const inputs = [
        document.getElementById("capacity-gen"),
        document.getElementById("plf-gen"),
        document.getElementById("shr-gen"),
        document.getElementById("gcv-gen"),
        document.getElementById("coal-req-gen"),
        document.getElementById("days-gen")
    ];

    inputs.forEach(input => {
       input.addEventListener('input', calculateCoalRequirementGen);
    });
});

function calculateCoalRequirementGen() {
    let capacityGen = parseFloat(document.getElementById("capacity-gen").value);
    let plfGen = parseFloat(document.getElementById("plf-gen").value);
    let shrGen = parseFloat(document.getElementById("shr-gen").value);
    let gcvGen = parseFloat(document.getElementById("gcv-gen").value);
    let coalReqGen = parseFloat(document.getElementById("coal-req-gen").value);
    let daysgen = parseInt(document.getElementById("days-gen").value);

    const resultshow2 = document.getElementById('resultshow2');

    // Show error for negative input
    if (
        capacityGen < 0 ||
        plfGen < 0 ||
        daysgen < 0 ||
        shrGen < 0 ||
        gcvGen < 0 ||
        coalReqGen < 0
    ) {
        resultshow2.style.display = 'block';
        resultshow2.innerHTML = `
          <div class="d-flex flex-wrap gap-1">
            <span class="badge rounded-pill bg-danger text-white">
              <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
              Please enter valid non-negative inputs.
            </span>
          </div>
        `;
        return;
    }

    // Show error if not exactly 5 inputs are filled
    const values = [capacityGen, plfGen, daysgen, shrGen, gcvGen, coalReqGen];
    const filledCount = values.filter(v => !isNaN(v)).length;
    if (filledCount !== 5) {
        resultshow2.style.display = 'block';
        resultshow2.innerHTML = `
          <div class="d-flex flex-wrap gap-1">
            <span class="badge rounded-pill" style="color:#222;background:#ffe066;">
              <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
              Enter any 5 inputs.
            </span>
          </div>
        `;
        return;
    }

    // Prepare result badge HTML
    resultshow2.style.display = 'block';
    resultshow2.innerHTML = `
      <div class="d-flex flex-wrap gap-2">
        <span class="badge rounded-pill bg-primary">
          <span id="result-gen"></span>
        </span>
        <span class="badge rounded-pill bg-success">
          <span id="result-gen-scc"></span>
        </span>
        <span class="badge rounded-pill bg-warning">
          <span id="result-generatedunits"></span>
        </span>
      </div>
    `;

    // Calculate and display results based on which input is missing
    if (isNaN(capacityGen)) {
        // Calculate Generation Capacity
        capacityGen = (coalReqGen * (gcvGen * 100000000)) / (daysgen * 24 * plfGen * 10 * shrGen);
        $("#result-gen").text(`Generation Capacity: ${capacityGen.toFixed(2)} MW`);
    } else if (isNaN(plfGen)) {
        // Calculate PLF
        plfGen = (coalReqGen * (gcvGen * 100000000)) / (daysgen * 24 * capacityGen * 10 * shrGen);
        $("#result-gen").text(`PLF: ${plfGen.toFixed(2)} %`);
    } else if (isNaN(daysgen)) {
        // Calculate Days
        daysgen = (coalReqGen * (gcvGen * 100000000)) / (plfGen * 24 * capacityGen * 10 * shrGen);
        $("#result-gen").text(`Days for which Units will run: ${daysgen.toFixed(1)} days`);
    } else if (isNaN(shrGen)) {
        // Calculate SHR
        shrGen = (coalReqGen * (gcvGen * 100000000)) / (daysgen * 24 * capacityGen * 10 * plfGen);
        $("#result-gen").text(`SHR: ${shrGen.toFixed(2)} kcal/kWh`);
    } else if (isNaN(gcvGen)) {
        // Calculate GCV
        gcvGen = (plfGen * (daysgen * 24 * capacityGen * 10 * shrGen)) / (coalReqGen * 100000000);
        $("#result-gen").text(`GCV: ${gcvGen.toFixed(2)} kcal/kg`);
    } else if (isNaN(coalReqGen)) {
        // Calculate Coal Requirement
        coalReqGen = (capacityGen * daysgen * 24 * plfGen * 10 * shrGen) / (gcvGen * 100000000);
        $("#result-gen").text(`Coal Requirement: ${coalReqGen.toFixed(5)} Lakh MT in ${daysgen.toFixed(1)} days`);
    }

    // Always calculate and show SCC and Units Generated if possible
    const sccGen = shrGen / gcvGen;
    $("#result-gen-scc").text(`Specific Coal Consumption: ${sccGen.toFixed(3)} kg/kWh`);

    const unitsgenerated = capacityGen * plfGen * daysgen * 24 * 10 / 100000;
    const unitsgeneratedPerDay = unitsgenerated / daysgen;
    const unitsgeneratedformatted = formatIndianStyleNumber(unitsgenerated);
    const unitsgeneratedPerDayformatted = formatIndianStyleNumber(unitsgeneratedPerDay);
    $("#result-generatedunits").text(`Units Generated: ${unitsgeneratedPerDayformatted} LUs per day and ${unitsgeneratedformatted} LUs in ${daysgen.toFixed(1)} days`);
}

function storeCoalRequirementParameters() {
    let capacityGen = parseFloat(document.getElementById("capacity-gen").value);
    let plfGen = parseFloat(document.getElementById("plf-gen").value);
    let daysgen = parseFloat(document.getElementById("days-gen").value);
    let shrGen = parseFloat(document.getElementById("shr-gen").value);
    let gcvGen = parseFloat(document.getElementById("gcv-gen").value);
    let coalReqGen = parseFloat(document.getElementById("coal-req-gen").value);

    // Count how many are missing
    let missingCount = [
        isNaN(capacityGen),
        isNaN(plfGen),
        isNaN(daysgen),
        isNaN(shrGen),
        isNaN(gcvGen),
        isNaN(coalReqGen)
    ].filter(Boolean).length;

    if (missingCount > 1) {
        alert("Please enter any 5 inputs.");
        return;
    }

    // Calculate the missing parameter
    if (isNaN(capacityGen)) {
        capacityGen = (coalReqGen * (gcvGen * 100000000)) / (daysgen * 24 * plfGen * 10 * shrGen);
    } else if (isNaN(plfGen)) {
        plfGen = (coalReqGen * (gcvGen * 100000000)) / (daysgen * 24 * capacityGen * 10 * shrGen);
    } else if (isNaN(daysgen)) {
        daysgen = (coalReqGen * (gcvGen * 100000000)) / (plfGen * 24 * capacityGen * 10 * shrGen);
    } else if (isNaN(shrGen)) {
        shrGen = (coalReqGen * (gcvGen * 100000000)) / (daysgen * 24 * capacityGen * 10 * plfGen);
    } else if (isNaN(gcvGen)) {
        gcvGen = (plfGen * (daysgen * 24 * capacityGen * 10 * shrGen)) / (coalReqGen * 100000000);
    } else if (isNaN(coalReqGen)) {
        coalReqGen = (capacityGen * daysgen * 24 * plfGen * 10 * shrGen) / (gcvGen * 100000000);
    }

    // Calculate derived values
    let sccGen = shrGen / gcvGen;
    let unitsgenerated = capacityGen * plfGen * daysgen * 24 * 10 / 100000;

    const parameterValueObj = {
        "Capacity (MW)": isNaN(capacityGen) ? "" : capacityGen.toFixed(2),
        "PLF (%)": isNaN(plfGen) ? "" : plfGen.toFixed(2),
        "Days": isNaN(daysgen) ? "" : daysgen.toFixed(0),
        "SHR (kcal/kWh)": isNaN(shrGen) ? "" : shrGen.toFixed(2),
        "GCV (kcal/kg)": isNaN(gcvGen) ? "" : gcvGen.toFixed(2),
        "Coal Requirement (Lakh MT)": isNaN(coalReqGen) ? "" : coalReqGen.toFixed(2),
        "Specific Coal Consumption (kg/kWh)": isNaN(sccGen) ? "" : sccGen.toFixed(3),
        "Units Generated (LUs)": isNaN(unitsgenerated) ? "" : unitsgenerated.toFixed(0)
    };
    coalRequirementValues.push(parameterValueObj);
    updateRowCountBadgeGen();
}
// Function to update the row count badge for Coal Requirement calculations
function updateRowCountBadgeGen() {
    document.getElementById("rowCountBadgeGen").innerText = coalRequirementValues.length;
}

// Function to clear the array for Coal Requirement calculations
function clearCoalRequirementValues() {
    // Ask for confirmation before clearing
    const confirmation = confirm("Do you really want to clear the calculations?");
            if (confirmation) {
    coalRequirementValues.splice(0, coalRequirementValues.length); // Clear the array
    updateRowCountBadgeGen(); // Update the row count badge
}}

// Function to generate a PDF with all stored parameter values for Coal Requirement calculations
function generatePDFWithStoredValuesGen() {
    // Prevent the default behavior of the button
    event.preventDefault();

    if (coalRequirementValues.length === 0) {
        alert("No parameter values are stored.");
        return;
    }

    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("Coal Requirement Calculation", 15, 25);

    // Create content for the PDF with a table containing all stored parameter values
    const tableData = [];
    const parameterNames = Object.keys(coalRequirementValues[0]);

    // Add the parameter names as the first row
    tableData.push(["Sr. No.", ...parameterNames]);

    // Add the parameter values as rows
    coalRequirementValues.forEach((valueObj, index) => {
        const rowData = [`(${index + 1})`];
        parameterNames.forEach(parameter => {
            rowData.push(valueObj[parameter]);
        });
        tableData.push(rowData);
    });

    // Add the table to the PDF
    doc.autoTable({
        startY: 30,
        head: tableData.slice(0, 1),
        body: tableData.slice(1),
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 15 },
        columnStyles: {
            0: { halign: "left" },
            1: { halign: "center" },
            2: { halign: "center" },
            3: { halign: "center" },
            4: { halign: "center" },
            5: { halign: "center" },
            6: { halign: "center" },
            7: { halign: "center" }
        }
    });

    // Save the PDF
    doc.save("CoalRequirement.pdf");
}

// Function to format numbers in Indian style
function formatIndianStyleNumber(number) {
    const formattedNumber = number.toLocaleString('en-IN', {
    style: 'decimal',
    maximumFractionDigits: 2,
    minimumFractionDigits: 2
});
return formattedNumber;
console.log(formattedNumber);
}

  







// JavaScript to calculate GCV, Ash, Moisture
document.addEventListener('DOMContentLoaded', function () {
    const gamInputs = [
        document.getElementById("gcv-gam"),
        document.getElementById("ash-gam"),
        document.getElementById("moisture-gam")
    ];
    gamInputs.forEach(input => {
        input.addEventListener('input', calculateGCVAshMoisture);
    });
});
// Initialize an array to store parameter values for GCV, Ash, Moisture calculations
const gamParameterValues = [];

// Function to calculate GCV, Ash, or Moisture
function calculateGCVAshMoisture() {
    const gcv = parseFloat($("#gcv-gam").val());
    const ash = parseFloat($("#ash-gam").val());
    const moisture = parseFloat($("#moisture-gam").val());
    const resultshow3 = document.getElementById('resultshow3');
    const badgeError = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter valid non-negative inputs.
        </span>
      </div>
    `;
    const badgeTwoInputs = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill" style="color:#222;background:#ffe066;">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Enter any 2 inputs.
        </span>
      </div>
    `;
    // Error for negative input
    if (gcv < 0 || ash < 0 || moisture < 0) {
        resultshow3.style.display = 'block';
        resultshow3.innerHTML = badgeError;
        return;
    }
    // Error if not exactly 2 inputs are filled
    const values = [gcv, ash, moisture];
    const filledCount = values.filter(v => !isNaN(v)).length;
    if (filledCount !== 2) {
        resultshow3.style.display = 'block';
        resultshow3.innerHTML = badgeTwoInputs;
        return;
    }
    // Prepare result badge HTML
    resultshow3.style.display = 'block';
    resultshow3.innerHTML = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-secondary">
          <span id="calculated-parameter-result"></span>
        </span>
      </div>
    `;
    // Calculate and display results
    if (isNaN(gcv) && !isNaN(ash) && !isNaN(moisture)) {
        const calculatedGCV = ((154 * (100 - (moisture + (1.1 * ash)))) - (108 * moisture)) / 1.8;
        $("#calculated-parameter-result").text("GCV: " + calculatedGCV.toFixed(2) + " kcal/kg");
    } else if (!isNaN(gcv) && isNaN(ash) && !isNaN(moisture)) {
        const calculatedAsh = ((100 - (((gcv * 1.8) + (108 * moisture)) / 154)) - moisture) / 1.1;
        if (calculatedAsh < 0) {
            $("#calculated-parameter-result").html(
                `Ash: ${calculatedAsh.toFixed(2)} % <i class="bi bi-exclamation-triangle-fill text-danger"></i> <span class="text-danger">Ash cannot be negative!</span>`
            );
        } else {
            $("#calculated-parameter-result").text("Ash: " + calculatedAsh.toFixed(2) + " %");
        }
    } else if (!isNaN(gcv) && !isNaN(ash) && isNaN(moisture)) {
        const calculatedMoisture = (15400 - (169.4 * ash) - (1.8 * gcv)) / 262;
        if (calculatedMoisture < 0) {
            $("#calculated-parameter-result").html(
                `Moisture: ${calculatedMoisture.toFixed(2)} % <i class="bi bi-exclamation-triangle-fill text-danger"></i> <span class="text-danger">Moisture cannot be negative!</span>`
            );
        } else {
            $("#calculated-parameter-result").text("Moisture: " + calculatedMoisture.toFixed(2) + " %");
        }
    }
}


function storeGCVAshMoistureParameters() {
    let gcv = parseFloat(document.getElementById("gcv-gam").value);
    let ash = parseFloat(document.getElementById("ash-gam").value);
    let moisture = parseFloat(document.getElementById("moisture-gam").value);

    // Count how many are missing
    let missingCount = [
        isNaN(gcv),
        isNaN(ash),
        isNaN(moisture)
    ].filter(Boolean).length;

    if (missingCount > 1) {
        alert("Please enter any 2 inputs.");
        return;
    }

    // Calculate the missing parameter
    if (isNaN(gcv) && !isNaN(ash) && !isNaN(moisture)) {
        // GCV = [{154 x (100 - (Moisture + (1.1 x Ash)))} - {108 x Moisture}] / 1.8
        gcv = ((154 * (100 - (moisture + (1.1 * ash)))) - (108 * moisture)) / 1.8;
    } else if (!isNaN(gcv) && isNaN(ash) && !isNaN(moisture)) {
        // Ash = [{100 - (((GCV x 1.8) + (108 x Moisture)) / 154)} - Moisture] / 1.1
        ash = ((100 - (((gcv * 1.8) + (108 * moisture)) / 154)) - moisture) / 1.1;
    } else if (!isNaN(gcv) && !isNaN(ash) && isNaN(moisture)) {
        // Moisture = [15400 - {169.4 x Ash} - {1.8 x GCV}] / 262
        moisture = (15400 - (169.4 * ash) - (1.8 * gcv)) / 262;
    }

    const parameterValueObj = {
        "GCV (kcal/kg)": isNaN(gcv) ? "" : gcv.toFixed(2),
        "Ash (%)": isNaN(ash) ? "" : ash.toFixed(2),
        "Moisture (%)": isNaN(moisture) ? "" : moisture.toFixed(2)
    };
    gamParameterValues.push(parameterValueObj);
    updateRowCountBadgeGam();
}


// Function to update the row count badge for GCV, Ash, Moisture calculations
function updateRowCountBadgeGam() {
    $("#rowCountBadgeGam").text(gamParameterValues.length);
}

// Function to clear the array for GCV, Ash, Moisture calculations
function clearGamParameterValues() {
    // Ask for confirmation before clearing
    const confirmation = confirm("Do you really want to clear the calculations?");
            if (confirmation) {gamParameterValues.splice(0, gamParameterValues.length); // Clear the array
    updateRowCountBadgeGam(); // Update the row count badge
}}

// Function to generate a PDF with all stored parameter values for GCV, Ash, Moisture calculations
function generatePDFWithStoredValuesGam() {
    // Prevent the default behavior of the button
    event.preventDefault();

    if (gamParameterValues.length === 0) {
        alert("No parameter values are stored.");
        return;
    }

    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("GCV, Ash, Moisture", 15, 25);

    // Create content for the PDF with a table containing all stored parameter values
    const tableData = [];
    const parameterNames = Object.keys(gamParameterValues[0]);

    // Add the parameter names as the first row
    tableData.push(["Sr. No.", ...parameterNames]);

    // Add the parameter values as rows
    gamParameterValues.forEach((valueObj, index) => {
        const rowData = [`(${index + 1})`];
        parameterNames.forEach(parameter => {
            rowData.push(valueObj[parameter]);
        });
        tableData.push(rowData);
    });

    // Add the table to the PDF
    doc.autoTable({
        startY: 30,
        head: tableData.slice(0, 1),
        body: tableData.slice(1),
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 15 },
        columnStyles: {
            0: { halign: "left" },
            1: { halign: "center" },
            2: { halign: "center" },
            3: { halign: "center" }
        }        
    });

    // Save the PDF
    doc.save("GAM.pdf");
}

document.addEventListener('DOMContentLoaded', function () {
    const parameterInputs = [
        document.getElementById("gcv-arb"),
        document.getElementById("gcv-eq"),
        document.getElementById("total-moisture"),
        document.getElementById("eq-moisture")
    ];
    parameterInputs.forEach(input => {
        input.addEventListener('input', calculateParameter);
    });
});
      
// Initialize an array to store parameter values
const parameterValues = [];

// Function to calculate a parameter based on the given values
function calculateParameter() {
    const gcvArb = parseFloat($("#gcv-arb").val());
    const gcvEq = parseFloat($("#gcv-eq").val());
    const totalMoisture = parseFloat($("#total-moisture").val());
    const eqMoisture = parseFloat($("#eq-moisture").val());
    const resultshow4 = document.getElementById('resultshow4');

    // Error badge templates
    const badgeError = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill  bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter valid non-negative inputs.
        </span>
      </div>
    `;
    const badgeMoisture = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Total Moisture cannot be less than Eq Moisture!
        </span>
      </div>
    `;
    const badgeGcv = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          GCV Eq cannot be less than GCV ARB!
        </span>
      </div>
    `;
    const badgeThreeInputs = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill" style="color:#222;background:#ffe066;">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Enter any 3 inputs.
        </span>
      </div>
    `;

    // Error for negative input
    if (
        gcvArb < 0 ||
        gcvEq < 0 ||
        totalMoisture < 0 ||
        eqMoisture < 0
    ) {
        resultshow4.style.display = 'block';
        resultshow4.innerHTML = badgeError;
        return;
    }

    // TM cannot be less than Eq. Moisture
    if (!isNaN(totalMoisture) && !isNaN(eqMoisture) && totalMoisture < eqMoisture) {
        resultshow4.style.display = 'block';
        resultshow4.innerHTML = badgeMoisture;
        return;
    }
    // GCV Eq cannot be less than GCV ARB
    if (!isNaN(gcvEq) && !isNaN(gcvArb) && gcvEq < gcvArb) {
        resultshow4.style.display = 'block';
        resultshow4.innerHTML = badgeGcv;
        return;
    }

    // Count filled inputs
    const values = [gcvArb, gcvEq, totalMoisture, eqMoisture];
    const filledCount = values.filter(v => !isNaN(v)).length;
    if (filledCount !== 3) {
        resultshow4.style.display = 'block';
        resultshow4.innerHTML = badgeThreeInputs;
        return;
    }

    // Prepare result badge HTML
    resultshow4.style.display = 'block';
    resultshow4.innerHTML = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-info">
          <span id="calculated-parameter-ARB-Eq-result"></span>
        </span>
      </div>
    `;

    // Calculate and display results
    if (isNaN(gcvArb) && !isNaN(gcvEq) && !isNaN(totalMoisture) && !isNaN(eqMoisture)) {
        // Calculate GCV ARB
        const calculatedGcvArb = (gcvEq * (100 - totalMoisture)) / (100 - eqMoisture);
        $("#calculated-parameter-ARB-Eq-result").text(`GCV ARB: ${calculatedGcvArb.toFixed(2)} kcal/kg`);
    } else if (!isNaN(gcvArb) && isNaN(gcvEq) && !isNaN(totalMoisture) && !isNaN(eqMoisture)) {
        // Calculate GCV EQ
        const calculatedGcvEq = (gcvArb * (100 - eqMoisture)) / (100 - totalMoisture);
        $("#calculated-parameter-ARB-Eq-result").text(`GCV EQ: ${calculatedGcvEq.toFixed(2)} kcal/kg`);
    } else if (!isNaN(gcvArb) && !isNaN(gcvEq) && isNaN(totalMoisture) && !isNaN(eqMoisture)) {
        // Calculate Total Moisture
        const calculatedTotalMoisture = 100 - ((gcvArb / gcvEq) * (100 - eqMoisture));
        $("#calculated-parameter-ARB-Eq-result").text(`Total Moisture: ${calculatedTotalMoisture.toFixed(2)} %`);
    } else if (!isNaN(gcvArb) && !isNaN(gcvEq) && !isNaN(totalMoisture) && isNaN(eqMoisture)) {
        // Calculate EQ Moisture
        const calculatedEqMoisture = 100 - ((gcvEq / gcvArb) * (100 - totalMoisture));
        $("#calculated-parameter-ARB-Eq-result").text(`EQ Moisture: ${calculatedEqMoisture.toFixed(2)} %`);
    }
}
// Function to store parameter values in an array
function storeParameterValues() {
    const gcvArb = parseFloat(document.getElementById("gcv-arb").value);
    const gcvEq = parseFloat(document.getElementById("gcv-eq").value);
    const totalMoisture = parseFloat(document.getElementById("total-moisture").value);
    const eqMoisture = parseFloat(document.getElementById("eq-moisture").value);

    // Count how many are missing
    let missingCount = [
        isNaN(gcvArb),
        isNaN(gcvEq),
        isNaN(totalMoisture),
        isNaN(eqMoisture)
    ].filter(Boolean).length;

    if (missingCount > 1) {
        alert("Please enter any 3 inputs.");
        return;
    }

    let calculatedGcvArb = gcvArb;
    let calculatedGcvEq = gcvEq;
    let calculatedTotalMoisture = totalMoisture;
    let calculatedEqMoisture = eqMoisture;

    // Calculate the missing parameter
    if (isNaN(gcvArb) && !isNaN(gcvEq) && !isNaN(totalMoisture) && !isNaN(eqMoisture)) {
        calculatedGcvArb = (gcvEq * (100 - totalMoisture)) / (100 - eqMoisture);
    } else if (!isNaN(gcvArb) && isNaN(gcvEq) && !isNaN(totalMoisture) && !isNaN(eqMoisture)) {
        calculatedGcvEq = (gcvArb * (100 - eqMoisture)) / (100 - totalMoisture);
    } else if (!isNaN(gcvArb) && !isNaN(gcvEq) && isNaN(totalMoisture) && !isNaN(eqMoisture)) {
        calculatedTotalMoisture = 100 - ((gcvArb / gcvEq) * (100 - eqMoisture));
    } else if (!isNaN(gcvArb) && !isNaN(gcvEq) && !isNaN(totalMoisture) && isNaN(eqMoisture)) {
        calculatedEqMoisture = 100 - ((gcvEq / gcvArb) * (100 - totalMoisture));
    }

    const parameterValueObj = {
        "GCV ARB (kcal/kg)": isNaN(calculatedGcvArb) ? "" : calculatedGcvArb.toFixed(2),
        "GCV EQ (kcal/kg)": isNaN(calculatedGcvEq) ? "" : calculatedGcvEq.toFixed(2),
        "Total Moisture (%)": isNaN(calculatedTotalMoisture) ? "" : calculatedTotalMoisture.toFixed(2),
        "EQ Moisture (%)": isNaN(calculatedEqMoisture) ? "" : calculatedEqMoisture.toFixed(2)
    };

    parameterValues.push(parameterValueObj);
    updateRowCountBadge();
}

// Function to update the row count badge
function updateRowCountBadge() {
    $("#rowCountBadge").text(parameterValues.length);
}
// Function to clear the array
function clearParameterValues() {
    // Ask for confirmation before clearing
    const confirmation = confirm("Do you really want to clear the calculations?");
            if (confirmation) {parameterValues.splice(0, parameterValues.length); // Clear the array
    updateRowCountBadge(); // Update the row count badge
}}

// Function to generate a PDF with all stored parameter values
function generatePDFWithStoredValues() {
   // Prevent the default behavior of the button
   event.preventDefault();

    if (parameterValues.length === 0) {
        alert("No parameter values are stored.");
        return;
    }
  

    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("Conversion : Equiliberated <> ARB", 15, 25);

   // Create content for the PDF with a table containing all stored parameter values
const tableData = [];
const parameterNames = Object.keys(parameterValues[0]);

// Add the parameter names as the first row
tableData.push(["Sr. No.", ...parameterNames]);

// Add the parameter values as rows
parameterValues.forEach((valueObj, index) => {
    const rowData = [`(${index + 1})`];
    parameterNames.forEach(parameter => {
        rowData.push(valueObj[parameter]);
    });
    tableData.push(rowData);
});

// Add the table to the PDF
doc.autoTable({
    startY: 30,
    head: tableData.slice(0, 1),
    body: tableData.slice(1),
    theme: "grid",
    tableWidth: "auto",
    margin: { top: 15 },
    columnStyles: {
        0: { halign: "left" },
        1: { halign: "center" },
        2: { halign: "center" },
        3: { halign: "center" },
        4: { halign: "center" }
    }
});
    // Save the PDF
    doc.save("EqARB.pdf");
}


// Function to calculate savings between Coal A and Coal B
document.addEventListener('DOMContentLoaded', function () {
    const coalComparisonInputs = [
        document.getElementById("gen-capacity"),
        document.getElementById("plf-coal-comp"),
        document.getElementById("num-days"),
        document.getElementById("shr-coal-comp"),
        document.getElementById("savings-perMT"),
        document.getElementById("gcv-a"),
        document.getElementById("coal-cost-a"),
        document.getElementById("railway-freight-a"),
        document.getElementById("gcv-b"),
        document.getElementById("coal-cost-b"),
        document.getElementById("railway-freight-b"),
        document.getElementById("coalA-Name"),
        document.getElementById("coalB-Name")
    ];
    coalComparisonInputs.forEach(input => {
        input.addEventListener('input', calculateCoalComparison);
    });
});

function calculateCoalComparison() {
    const genCapacity = parseFloat($("#gen-capacity").val());
    let plfcoalcomp = parseFloat($("#plf-coal-comp").val());
    const numDays = parseInt($("#num-days").val());
    const shrcoalcomp = parseFloat($("#shr-coal-comp").val());
    const savingsPerMT = parseFloat($("#savings-perMT").val());
    const gcvA = parseFloat($("#gcv-a").val());
    const coalCostA = parseFloat($("#coal-cost-a").val());
    const railwayFreightA = parseFloat($("#railway-freight-a").val());
    const gcvB = parseFloat($("#gcv-b").val());
    const coalCostB = parseFloat($("#coal-cost-b").val());
    const railwayFreightB = parseFloat($("#railway-freight-b").val());
    const coalAname = document.getElementById('coalA-Name').value;
    const coalBname = document.getElementById('coalB-Name').value;

       // Ensure PLF does not exceed 100
    if (plfcoalcomp > 100) {
        plfcoalcomp = 100;
        document.getElementById("plf-coal-comp").value = 100;
    }

    // Badge warning HTML
    const badgeWarning = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter all the inputs for result.
        </span>
      </div>
    `;

    // Check for missing or negative inputs
    const values = [
        genCapacity, plfcoalcomp, numDays, shrcoalcomp, savingsPerMT,
        gcvA, coalCostA, railwayFreightA, gcvB, coalCostB, railwayFreightB
    ];
    const anyMissing = values.some(v => isNaN(v));
    const anyNegative = values.some(v => v < 0);
    const anyNameMissing = !coalAname || !coalBname;

    const resultshow5 = document.getElementById('resultshow5');
    if (anyMissing || anyNegative || anyNameMissing) {
        resultshow5.style.display = 'block';
        resultshow5.innerHTML = badgeWarning;
        return;
    }
    // Display the result
        resultshow51.style.display = 'block';
        resultshow5.style.display = 'none';

        resultshow51.innerHTML = `
        <table class="table table-bordered table-sm text-center align-middle two-coal-analysis-table">
            <caption><span id="twoCoalCompHeader"></span></caption>
            <thead class="table-dark">
                <tr>
                    <th>Parameter</th>
                    <th id="coalAHeader">Coal A</th>
                    <th id="coalBHeader">Coal B</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Quantity Required (Lakh MT)</td>
                    <td><span id="quantityCoalA-result"></span></td>
                    <td><span id="quantityCoalB-result"></span></td>
                </tr>
                <tr>
                    <td>Landed Cost (Rs/MT)</td>
                    <td><span id="landedcostMTCoalA-result"></span></td>
                    <td><span id="landedcostMTCoalB-result"></span></td>
                </tr>
                <tr>
                    <td>Landed Cost (Rs/MCal)</td>
                    <td><span id="landedcostMCCoalA-result"></span></td>
                    <td><span id="landedcostMCCoalB-result"></span></td>
                </tr>
                <tr>
                    <td>Energy Charges (Rs/kWh)</td>
                    <td><span id="perunitCoalA-result"></span></td>
                    <td><span id="perunitCoalB-result"></span></td>
                </tr>
                <tr>
                    <td>SCC (kg/kWh)</td>
                    <td><span id="sccCoalA-result"></span></td>
                    <td><span id="sccCoalB-result"></span></td>
                </tr>
                <tr>
                    <td>Coal Expenditure (Rs. Crore)</td>
                    <td><span id="TotalexpenditureCoalA-result"></span></td>
                    <td><span id="TotalexpenditureCoalB-result"></span></td>
                </tr>
            </tbody>
            <tfoot class="two-coal-analysis-footer">
                <tr><td colspan="3"><span id="coalAvscoalB-result"></span></td></tr>
                <tr><td colspan="3"><span id="savings-result"></span></td></tr>
                <tr><td colspan="3"><span id="savings-perMT-result"></span></td></tr>
                <tr><td colspan="3"><span id="savings-perUnit-result"></span></td></tr>
                <tr><td colspan="3"><span id="generation-result"></span></td></tr>
            </tfoot>
        </table>
    `;
        
    // Calculate Generation
    const generation = genCapacity * (plfcoalcomp / 10000) * 24 * numDays;

    // Calculate Coal Required for Coal A and Coal B
    const coalRequiredA = (generation * shrcoalcomp) / (gcvA * 1000);
    const coalRequiredB = (generation * shrcoalcomp) / (gcvB * 1000);
     
    // Calculate Landed Cost for Coal A and Coal B (Rs/MT)
    const landedCostA = coalCostA + railwayFreightA;
    const landedCostB = coalCostB + railwayFreightB;
    
    // Calculate Landed Cost for Coal A and Coal B (Rs/Million Calorie)
    const landedCostAmc = landedCostA/gcvA;
    const landedCostBmc = landedCostB/gcvB;
    
     // Calculate per Unit Cost of Coal A and Coal B
     const perunitCoalA = (landedCostA*shrcoalcomp)/(gcvA*1000);
     const perunitCoalB = (landedCostB*shrcoalcomp)/(gcvB*1000);

     // Calculate Specific Coal Consumption with Coal A and Coal B
     const sccCoalA = shrcoalcomp/gcvA;
     const sccCoalB = shrcoalcomp/gcvB;


    // Calculate Fuel Cost for Coal A and Coal B
    const fuelCostA = (coalRequiredA * landedCostA)/100;
    const fuelCostB = (coalRequiredB * landedCostB)/100;

    // Calculate Savings
    const savingscoalcompA = fuelCostA - fuelCostB;
    const savingscoalcompB = fuelCostB - fuelCostA;

   const savingsperMTcoalcompA = ((landedCostB * (gcvA/gcvB))-landedCostA) * savingsPerMT/10000000;
   const savingsperMTcoalcompB = ((landedCostA * (gcvB/gcvA))-landedCostB) * savingsPerMT/10000000;


    document.getElementById("twoCoalCompHeader").innerText = `Cost Economics: ${coalAname} V/s ${coalBname}`;
    document.getElementById("coalAHeader").innerText = `${coalAname}`;
    document.getElementById("coalBHeader").innerText = `${coalBname}`;



    
    $("#generation-result").text(`Units Generated: ${generation.toFixed(2)} Lakh Units`);
    $("#landedcostMTCoalA-result").text(`${landedCostA.toFixed(2)}`);
    $("#landedcostMTCoalB-result").text(`${landedCostB.toFixed(2)}`);
    $("#landedcostMCCoalA-result").text(`${landedCostAmc.toFixed(3)}`);
    $("#landedcostMCCoalB-result").text(`${landedCostBmc.toFixed(3)}`);


    $("#perunitCoalA-result").text(`${perunitCoalA.toFixed(2)}`);
    $("#perunitCoalB-result").text(`${perunitCoalB.toFixed(2)}`);

    $("#sccCoalA-result").text(`${sccCoalA.toFixed(3)}`);
    $("#sccCoalB-result").text(`${sccCoalB.toFixed(3)}`);

    $("#quantityCoalA-result").text(`${coalRequiredA.toFixed(2)}`);
    $("#quantityCoalB-result").text(`${coalRequiredB.toFixed(2)}`);
    $("#TotalexpenditureCoalA-result").text(`${fuelCostA.toFixed(2)}`);
    $("#TotalexpenditureCoalB-result").text(`${fuelCostB.toFixed(2)}`);

    // Determine which coal is more economical and display savings

    if(fuelCostA<fuelCostB) {
        document.getElementById("coalAvscoalB-result").innerText = `${coalAname} coal is economical w.r.t. ${coalBname}`;

        $("#savings-result").text(`Total Saving for using ${coalAname} coal: Rs. ${savingscoalcompB.toFixed(2)} Crore`); $("#savings-perMT-result").text(`Rs. ${savingsperMTcoalcompA.toFixed(2)} Crore  per ${savingsPerMT.toFixed(2)/100000} Lakh MT`);$("#savings-perUnit-result").text(`Per Unit coal reduction: ${(perunitCoalB-perunitCoalA).toFixed(2)} per kWh`);}
       
        else {
        document.getElementById("coalAvscoalB-result").innerText = `${coalBname} coal is economical w.r.t. ${coalAname}`;
        
        $("#savings-result").text(`Total Saving for using ${coalBname} coal: Rs. ${savingscoalcompA.toFixed(2)} Crore`); $("#savings-perMT-result").text(`Rs. ${savingsperMTcoalcompB.toFixed(2)} Crore per ${savingsPerMT.toFixed(2)/100000} Lakh MT`); $("#savings-perUnit-result").text(`Per Unit cost reduction: ${(perunitCoalA-perunitCoalB).toFixed(2)} per kWh`);}
   
}

// Generate PDF for Coal Comparison Coal A vs Coal B
function generatePDFForCoalComparison() {
     // Prevent the default behavior of the button
     event.preventDefault();
    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("Cost Economics of Two Types of Coal", 15, 25);

    // Gather input values
    const genCapacity = parseFloat($("#gen-capacity").val());
    const plfcoalcomp = parseFloat($("#plf-coal-comp").val());
    const numDays = parseInt($("#num-days").val());
    const shrcoalcomp = parseFloat($("#shr-coal-comp").val());
    const gcvA = parseFloat($("#gcv-a").val());
    const coalCostA = parseFloat($("#coal-cost-a").val());
    const railwayFreightA = parseFloat($("#railway-freight-a").val());
    const gcvB = parseFloat($("#gcv-b").val());
    const coalCostB = parseFloat($("#coal-cost-b").val());
    const railwayFreightB = parseFloat($("#railway-freight-b").val());
    const coalAname = document.getElementById('coalA-Name').value;
    const coalBname = document.getElementById('coalB-Name').value;


    // Validate inputs
    if (isNaN(genCapacity) || isNaN(plfcoalcomp) || isNaN(numDays) || isNaN(shrcoalcomp) ||
        isNaN(gcvA) || isNaN(coalCostA) || isNaN(railwayFreightA) ||
        isNaN(gcvB) || isNaN(coalCostB) || isNaN(railwayFreightB)) {
        doc.setFontSize(12);
        doc.text("Please enter valid numbers for all fields.", 25, 40);
        doc.save("CoalComparisonAnalysis.pdf");
        return;
    }


    // Calculate Generation
    const generation = genCapacity * (plfcoalcomp / 10000) * 24 * numDays;
    const generationformatted = formatIndianStyleNumber(generation);

    // Calculate Coal Required for Coal A and Coal B
    const coalRequiredA = (generation * shrcoalcomp * 100000) / (gcvA * 1000);
    const coalRequiredB = (generation * shrcoalcomp * 100000) / (gcvB * 1000);
    const coalRequiredAformatted = formatIndianStyleNumber(coalRequiredA);
    const coalRequiredBformatted = formatIndianStyleNumber(coalRequiredB);

    // Calculate Landed Cost for Coal A and Coal B (Rs/MT)
    const landedCostA = coalCostA + railwayFreightA;
    const landedCostB = coalCostB + railwayFreightB;
    
    // Calculate Landed Cost for Coal A and Coal B (Rs/Million Calorie)
    const landedCostAmc = landedCostA/gcvA;
    const landedCostBmc = landedCostB/gcvB;   

    // Calculate per Unit Coat of Coal A and Coal B
    const perunitCoalA = (landedCostA * shrcoalcomp) / (gcvA * 1000);
    const perunitCoalB = (landedCostB * shrcoalcomp) / (gcvB * 1000);

    // Calculate Fuel Cost for Coal A and Coal B
    const fuelCostA = (coalRequiredA * landedCostA) / 10000000;
    const fuelCostB = (coalRequiredB * landedCostB) / 10000000;
    const savingCoalACoalB = fuelCostA-fuelCostB;
    const savingCoalBCoalA = fuelCostB-fuelCostA;


    // Create content for the PDF in a table format
    const mainTableData = [
        ["Parameter", coalAname, coalBname],
        ["Quantity Required (Metric Tonnes)", coalRequiredAformatted, coalRequiredBformatted],
        ["Coal Cost (Rs./MT)", coalCostA.toFixed(2), coalCostB.toFixed(2)],
        ["Railway Freight (Rs./MT)", railwayFreightA.toFixed(2), railwayFreightB.toFixed(2)],
        ["Landed Cost (Rs./MT)", landedCostA.toFixed(2), landedCostB.toFixed(2)],
        ["GCV (kcal/kg)", gcvA.toFixed(2), gcvB.toFixed(2)],
        ["Landed Cost (Rs./Million Calorie)", landedCostAmc.toFixed(3), landedCostBmc.toFixed(3)],
        ["Per Unit Cost (Rs./kWh)", perunitCoalA.toFixed(2), perunitCoalB.toFixed(2)],
        ["Expenditure on Coal (Rs. Crore)", fuelCostA.toFixed(2), fuelCostB.toFixed(2)],                 
    ];

    
// Create a table for input parameters
const inputTableData = [
        ["Parameter", "Value"],
        ["Generation Capacity (MW)", genCapacity.toFixed(2)],
        ["PLF (Coal Component %)", plfcoalcomp.toFixed(2)],
        ["Number of Days", numDays.toFixed(0)],
        ["Station Heat Rate (kcal/kWh)", shrcoalcomp.toFixed(2)],
        ["Units Generated (Lakh Units)", generationformatted]
    ];

    // Add the input parameters table to the PDF
    doc.autoTable({
        startY: 30,
        head: [inputTableData[0]],
        body: inputTableData.slice(1),
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 15 },
        columnStyles: {
            0: { halign: "left" },
            1: { halign: "center" },
        }
    });


    // Define the head styles
const headStyles = {
    fillColor: [192, 192, 192], // Background color for the header row
    textColor: [0, 0, 0],       // Text color for the header row
    fontStyle: 'bold',          // Font style for the header row (e.g., 'normal', 'bold', 'italic')
    fontSize: 12,               // Font size for the header row
    cellPadding: 2,             // Padding for header cells
    halign: 'center'            // Horizontal alignment for header cells ('left', 'center', 'right')
};
// Define the row styles
const rowStyles = {
        1: { fillColor: [192, 192, 192] }, // Customize the 2nd row
        2: { fillColor: [192, 192, 192] }, // Customize the 3rd row
        4: { fillColor: [192, 192, 192] }  // Customize the 5th row
    };
    // Add the table to the PDF
    doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: mainTableData.slice(0, 1),
        body: mainTableData.slice(1),
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 10 },
        columnStyles: {
            0: { halign: "left" },
            1: { halign: "center" },
            2: { halign: "center" }
        },
        headStyles: headStyles, // Apply the customized head styles
        rowStyles: rowStyles, // Customize the 2nd, 3rd, and 5th rows
        });

        if (fuelCostA>fuelCostB){
        // Add headers and rows for the outputs table
        doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Savings by using "+ coalBname + " coal w.r.t. " + coalAname + " coal shall be Rs. " + savingCoalACoalB.toFixed(2) + " Crores"]],
                theme: "grid",
        tableWidth: "auto",
        margin: { top: 10 }    });
        }

        else{ doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Savings by using "+ coalAname + " coal w.r.t. " + coalBname + " coal shall be Rs. " + savingCoalBCoalA.toFixed(2) + " Crores"]],
                theme: "grid",
        tableWidth: "auto",
        margin: { top: 10 }    });
    }

    // Save the PDF
    doc.save("CoalComparisonAnalysis.pdf");
}



// Function for Tab 6: Coal Availability
function formatDate(date) {
const options = { year: 'numeric', month: 'long', day: '2-digit' };
return date.toLocaleDateString('en-In', options);
}

// Define the constant array
const quarterPercentagesCal1 = [0.25, 0.22, 0.25, 0.28]; // Initialize with default values

// Select all quarter input boxes, error message, and table labels
const quarterInputsCal1 = document.querySelectorAll('.quarter-inputCal1');
const errorMessageCal1 = document.getElementById('error-messageCal1');


// Function to validate and update percentages
function validateAndUpdatePercentagesCal1() {
  let totalPercentageCal1 = 0;

  // Loop through each input and update the constant array
  quarterInputsCal1.forEach((input, index) => {
    const value = parseFloat(input.value);
    if (!isNaN(value)) {
      totalPercentageCal1 += value; // Accumulate the total
      quarterPercentagesCal1[index] = value / 100; // Store in array as a decimal

          }
  });

const badgePercentageExceed = `
    <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
            <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
            The total percentage cannot exceed 100%.
        </span>
    </div>
`;

const badgePercentageLess = `
    <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
            <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
            The total percentage cannot be less than 100%.
        </span>
    </div>
`;



  // Check if the total percentage is valid
  if (totalPercentageCal1 > 100) {
    errorMessageCal1.style.display = 'block';
    errorMessageCal1.innerHTML = badgePercentageExceed;
  } else if (totalPercentageCal1 < 100) {
    errorMessageCal1.style.display = 'block';
    errorMessageCal1.innerHTML = badgePercentageLess;
  } else {
    errorMessageCal1.style.display = 'none';calculateCoalAvailability(); // Hide error message when valid
  }

}

// Attach event listeners to all quarter input boxes
quarterInputsCal1.forEach(input => {
  input.addEventListener('input', validateAndUpdatePercentagesCal1);
});

// Initialize validation and update on page load
validateAndUpdatePercentagesCal1();

document.addEventListener('DOMContentLoaded', function () {
    const coalAvailabilityInputs = [
        document.getElementById("acq-coal"),
        document.getElementById("quantity-in-rake-cal"),
        document.getElementById("start-date-coal"),
        document.getElementById("end-date-coal"),
        document.getElementById("q1-percentage"),
        document.getElementById("q2-percentage"),
        document.getElementById("q3-percentage"),
        document.getElementById("q4-percentage")
    ];
    coalAvailabilityInputs.forEach(input => {
        if (input) {
            input.addEventListener('input', calculateCoalAvailability);
            input.addEventListener('change', calculateCoalAvailability); // for date pickers
        }
    });
});

document.addEventListener('DOMContentLoaded', function () {
    const acqCoalInput = document.getElementById('acq-coal');
    const quantityInRakeCalInput = document.getElementById('quantity-in-rake-cal');

    // Prevent minus sign for Annual Coal Quantity
    acqCoalInput.addEventListener('keydown', function(event) {
        if (event.key === '-' || event.key === 'Minus' || event.key === '+' || event.key === 'Plus') {
            event.preventDefault();
        }
        
    });

    // Prevent minus sign for Quantity in a Rake
    quantityInRakeCalInput.addEventListener('keydown', function(event) {
        if (event.key === '-' || event.key === 'Minus'|| event.key === '+' || event.key === 'Plus') {
            event.preventDefault();
        }
    });
});
function calculateCoalAvailability() {
    const acqCal1 = parseFloat(document.getElementById("acq-coal").value);
    const quantityInRakecal = parseFloat(document.getElementById("quantity-in-rake-cal").value);
    const startCoalDateStr = document.getElementById("start-date-coal").value;
    const endCoalDateStr = document.getElementById("end-date-coal").value;
    const resultshow6 = document.getElementById('resultshow6');

    
    // Only show errors if the user has started entering any value
    const anyInputStarted =
        document.getElementById("acq-coal").value ||
        document.getElementById("quantity-in-rake-cal").value ||
        startCoalDateStr ||
        endCoalDateStr;

    // Badge warning HTMLs
    const badgeMissing = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter values in all the fields.
        </span>
      </div>
    `;
    const badgeNegative = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter valid non-negative values.
        </span>
      </div>
    `;
    const badgeDate = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter valid date range.
        </span>
      </div>
    `;

    // Check for missing or negative inputs
    const values = [acqCal1, quantityInRakecal];
    const anyMissing = values.some(v => isNaN(v)) || !startCoalDateStr || !endCoalDateStr;
    const anyNegative = values.some(v => v < 0);
    const invalidDateRange = startCoalDateStr && endCoalDateStr && (new Date(startCoalDateStr) > new Date(endCoalDateStr));

    // Only show errors if user started entering any value
    if (anyInputStarted) {
        if (anyMissing) {
            resultshow6.style.display = 'block';
            resultshow6.innerHTML = badgeMissing;
            return;
        }
        if (anyNegative) {
            resultshow6.style.display = 'block';
            resultshow6.innerHTML = badgeNegative;
            return;
        }
        if (invalidDateRange) {
            resultshow6.style.display = 'block';
            resultshow6.innerHTML = badgeDate;
            return;
        }
    } else {
        // Hide result if nothing is entered
        resultshow6.style.display = 'none';
        return;
    }

    // Prepare result badge HTML (reset to badge style)
    resultshow6.style.display = 'block';
    resultshow6.innerHTML = `
      <div class="d-flex flex-wrap gap-2">
        <span class="badge rounded-pill bg-success text-dark px-3 py-2">
          <span id="coal-availability-result"></span>
        </span>
        <span class="badge rounded-pill bg-dark text-white px-3 py-2">
          <span id="rakes-required-result"></span>
        </span>
      </div>
    `;
// Now get the new elements and update them
const coalAvailabilityResult = document.getElementById("coal-availability-result");
const rakesRequiredResult = document.getElementById("rakes-required-result");
// --- FIX: Convert date strings to Date objects ---
    const startCoalDate = new Date(startCoalDateStr);
    const endCoalDate = new Date(endCoalDateStr);
    // Perform coal availability calculation
    const quantities = [
        (acqCal1 * quarterPercentagesCal1[3]) / 3, // January
        (acqCal1 * quarterPercentagesCal1[3]) / 3, // February
        (acqCal1 * quarterPercentagesCal1[3]) / 3, // March
        (acqCal1 * quarterPercentagesCal1[0]) / 3, // April
        (acqCal1 * quarterPercentagesCal1[0]) / 3, // May
        (acqCal1 * quarterPercentagesCal1[0]) / 3, // June
        (acqCal1 * quarterPercentagesCal1[1]) / 3, // July
        (acqCal1 * quarterPercentagesCal1[1]) / 3, // August
        (acqCal1 * quarterPercentagesCal1[1]) / 3, // September
        (acqCal1 * quarterPercentagesCal1[2]) / 3, // October
        (acqCal1 * quarterPercentagesCal1[2]) / 3, // November
        (acqCal1 * quarterPercentagesCal1[2]) / 3  // December
    ];

let coalAvailability = new Array(12).fill(0);

let currentDate = new Date(startCoalDate);

while (currentDate <= endCoalDate) {
    const currentMonth = currentDate.getMonth();
    const daysInMonth = new Date(currentDate.getFullYear(), currentMonth + 1, 0).getDate();
    const daysLeftInMonth = daysInMonth - currentDate.getDate() + 1;

    const daysInPeriod = Math.min(daysLeftInMonth, (endCoalDate - currentDate) / (1000 * 60 * 60 * 24) + 1);
    const quantityInMonth = (quantities[currentMonth] / daysInMonth) * daysInPeriod;
    coalAvailability[currentMonth] += quantityInMonth;

    currentDate.setDate(currentDate.getDate() + daysInPeriod);
}

const totalQuantity = coalAvailability.reduce((sum, quantity) => sum + quantity, 0);
const totalQuantityformatted = formatIndianStyleNumber(totalQuantity);
const rakesRequired = totalQuantity / quantityInRakecal;

const formattedStartDate = formatDate(startCoalDate);
const formattedEndDate = formatDate(endCoalDate);

// After calculation, update the result spans as before:

//coalAvailabilityResult.innerText = `Coal Quantity: From ${formattedStartDate} to ${formattedEndDate}: ${formatIndianStyleNumber(totalQuantity)} MT`;
coalAvailabilityResult.innerText = `Coal Quantity: ${formatIndianStyleNumber(totalQuantity)} MT`;
rakesRequiredResult.innerText = `Rakes: ${formatIndianStyleNumber(rakesRequired)}`;

}


function generatePDFForCoalAvailability() {
    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("Distribution of Annual Contracted Quantity (ACQ)", 15, 25);
    
    // Gather input values
    const startCoalDate = new Date(document.getElementById("start-date-coal").value);
    const endCoalDate = new Date(document.getElementById("end-date-coal").value);
    const acqCal1 = parseFloat(document.getElementById("acq-coal").value);
    const quantityInRakecal = parseFloat(document.getElementById("quantity-in-rake-cal").value);

    // Validate inputs
    if (isNaN(acqCal1) || isNaN(quantityInRakecal) || startCoalDate > endCoalDate) {
        doc.setFontSize(12);
        doc.text("Invalid input.", 15, 40);
        doc.save("error.pdf");
        return;
    }

    // Perform coal availability calculation
    const quantities = [
        (acqCal1 * quarterPercentagesCal1[3]) / 3, // January
        (acqCal1 * quarterPercentagesCal1[3]) / 3, // February
        (acqCal1 * quarterPercentagesCal1[3]) / 3, // March
        (acqCal1 * quarterPercentagesCal1[0]) / 3, // April
        (acqCal1 * quarterPercentagesCal1[0]) / 3, // May
        (acqCal1 * quarterPercentagesCal1[0]) / 3, // June
        (acqCal1 * quarterPercentagesCal1[1]) / 3, // July
        (acqCal1 * quarterPercentagesCal1[1]) / 3, // August
        (acqCal1 * quarterPercentagesCal1[1]) / 3, // September
        (acqCal1 * quarterPercentagesCal1[2]) / 3, // October
        (acqCal1 * quarterPercentagesCal1[2]) / 3, // November
        (acqCal1 * quarterPercentagesCal1[2]) / 3  // December
    ];

    let coalAvailability = new Array(12).fill(0);

    let currentDate = new Date(startCoalDate);

    while (currentDate <= endCoalDate) {
        const currentMonth = currentDate.getMonth();
        const daysInMonth = new Date(currentDate.getFullYear(), currentMonth + 1, 0).getDate();
        const daysLeftInMonth = daysInMonth - currentDate.getDate() + 1;

        const daysInPeriod = Math.min(daysLeftInMonth, (endCoalDate - currentDate) / (1000 * 60 * 60 * 24) + 1);
        const quantityInMonth = (quantities[currentMonth] / daysInMonth) * daysInPeriod;
        coalAvailability[currentMonth] += quantityInMonth;

        currentDate.setDate(currentDate.getDate() + daysInPeriod);
    }

    const totalQuantity = coalAvailability.reduce((sum, quantity) => sum + quantity, 0);
    const totalQuantityformatted = formatIndianStyleNumber(totalQuantity);
    const rakesRequired = totalQuantity / quantityInRakecal;

    const formattedStartDate = formatDate(startCoalDate);
    const formattedEndDate = formatDate(endCoalDate);
    const tableData = [];
// Gather input values and add them to the table data array
tableData.push(
        ["Period", "Quantity (Metric Tonne)", "Rakes"],
        ["ACQ", formatIndianStyleNumber(acqCal1), (acqCal1/quantityInRakecal).toFixed(2)],
        ["April", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[0]/3),(acqCal1*quarterPercentagesCal1[0]/3/quantityInRakecal).toFixed(2)],
        ["May", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[0]/3),(acqCal1*quarterPercentagesCal1[0]/3/quantityInRakecal).toFixed(2)],
        ["June", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[0]/3),(acqCal1*quarterPercentagesCal1[0]/3/quantityInRakecal).toFixed(2)],
        ["Per Day", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[0]/3/30),(acqCal1*quarterPercentagesCal1[0]/3/30/quantityInRakecal).toFixed(2)],
        ["Quarter-1 (April - June) "+ quarterPercentagesCal1[0]*100+"%", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[0]),(acqCal1*quarterPercentagesCal1[0]/quantityInRakecal).toFixed(2)],
        ["July", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[1]/3),(acqCal1*quarterPercentagesCal1[1]/3/quantityInRakecal).toFixed(2)],
        ["August", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[1]/3),(acqCal1*quarterPercentagesCal1[1]/3/quantityInRakecal).toFixed(2)],
        ["September", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[1]/3),(acqCal1*quarterPercentagesCal1[1]/3/quantityInRakecal).toFixed(2)],
        ["Per Day", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[1]/3/30),(acqCal1*quarterPercentagesCal1[1]/3/30/quantityInRakecal).toFixed(2)],
        ["Quarter-2 (July - September) " + quarterPercentagesCal1[1]*100+"%", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[1]),(acqCal1*quarterPercentagesCal1[1]/quantityInRakecal).toFixed(2)],
        ["October", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[2]/3),(acqCal1*quarterPercentagesCal1[2]/3/quantityInRakecal).toFixed(2)],
        ["November", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[2]/3),(acqCal1*quarterPercentagesCal1[2]/3/quantityInRakecal).toFixed(2)],
        ["December", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[2]/3),(acqCal1*quarterPercentagesCal1[2]/3/quantityInRakecal).toFixed(2)],
        ["Per Day", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[2]/3/30),(acqCal1*quarterPercentagesCal1[2]/3/30/quantityInRakecal).toFixed(2)],
        ["Quarter-3 (Oct - Dec) "+ quarterPercentagesCal1[2]*100+"%", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[2]),(acqCal1*quarterPercentagesCal1[2]/quantityInRakecal).toFixed(2)],
        ["January", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[3]/3),(acqCal1*quarterPercentagesCal1[3]/3/quantityInRakecal).toFixed(2)],
        ["February", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[3]/3),(acqCal1*quarterPercentagesCal1[3]/3/quantityInRakecal).toFixed(2)],
        ["March", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[3]/3),(acqCal1*quarterPercentagesCal1[3]/3/quantityInRakecal).toFixed(2)],
        ["Per Day", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[3]/3/30),(acqCal1*quarterPercentagesCal1[3]/3/30/quantityInRakecal).toFixed(2)],
        ["Quarter-4 (Jan - March) "+ (quarterPercentagesCal1[3]*100).toFixed(0)+"%", formatIndianStyleNumber(acqCal1*quarterPercentagesCal1[3]),(acqCal1*quarterPercentagesCal1[3]/quantityInRakecal).toFixed(2)],

        );

// Define the row numbers that you want to change the background color for
const coloredRows = [2,7, 12, 17, 22];

        doc.autoTable({
        startY: 30,
        head: [tableData[0]], // Headers
        body: tableData.slice(1), // Exclude the first row (headers)
        //foot: [["Increase in Energy Charges due to Blending (Rs./kWh)", comparisonResult.toFixed(2)],],
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 25 },
        columnStyles: {
        0: { halign: "left" }, // Parameter column aligns left
        1: { halign: "center" }, // Indian Coal column aligns right
        2: { halign: "center" }, // Imported Coal column aligns right
                    },
                    didParseCell: (tableData) => {
            if (tableData.row.raw[0].includes("Quarter-1") ||
            tableData.row.raw[0].includes("Quarter-2") ||
            tableData.row.raw[0].includes("Quarter-3") ||
            tableData.row.raw[0].includes("Quarter-4")) {
                // Highlight quarter rows
                tableData.cell.styles.fillColor = [180, 180, 180]; // Light gray
                tableData.cell.styles.fontStyle = "bold"; //  bold

            }
        
            if (tableData.row.raw[0].includes("Per Day") ) {
                // Highlight quarter rows
                tableData.cell.styles.fillColor = [220, 220, 220]; // Light gray
                tableData.cell.styles.fontStyle = "bold"; //  bold

            }
            if (tableData.row.raw[0].includes("ACQ") ) {
                // Highlight quarter rows
                tableData.cell.styles.fillColor = [182,215,168]; // Light green
                tableData.cell.styles.fontStyle = "bold"; //  bold

            }
        },       
       
                    });

    // Add headers and rows for the outputs table
    doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Coal Linkage from " + formattedStartDate + " to " + formattedEndDate + " shall be " + totalQuantityformatted + " MT i.e. " + rakesRequired.toFixed(2) + " Rakes"]],
                theme: "grid",
        tableWidth: "auto",
        margin: { top: 10 }    });

        // Save the PDF
    doc.save("CoalLinkage.pdf");
}




// Function for Tab 7: Cost Linkage Advance
document.addEventListener("DOMContentLoaded", function () {
            const acqInput = document.getElementById("acq-input");
            const rakeInput = document.getElementById("rake-quantity-input");
            const table = document.getElementById("coal-table");
            const quarterlyTable = document.getElementById("quarterly-table");
            const perDayTable = document.getElementById("per-day-table");
            const copyButton = document.getElementById("copy-cells-btn");




            document.addEventListener("keydown", function(event) {
    if (event.key === "Tab") {
        const activeElement = document.activeElement;

        // Check if the current element is contenteditable
        if (activeElement && activeElement.getAttribute("contenteditable") === "true") {
            event.preventDefault(); // Prevent the default tab behavior

            // Get all contenteditable cells
            const editableCells = Array.from(
                document.querySelectorAll("[contenteditable='true']")
            );

            // Find the index of the currently active cell
            const currentIndex = editableCells.indexOf(activeElement);

            // Calculate the next index, wrapping around if needed
            const nextIndex = (currentIndex + 1) % editableCells.length;

            // Focus the next cell
            editableCells[nextIndex].focus();
        }
    }
});

// Prevent minus sign from being entered
acqInput.addEventListener('keydown', function(event) {
    if (event.key === '-' || event.key === 'Minus'|| event.key === '+' || event.key === 'Plus') {
        event.preventDefault();
    }
});
rakeInput.addEventListener('keydown', function(event) {
    if (event.key === '-' || event.key === 'Minus'|| event.key === '+' || event.key === 'Plus') {
        event.preventDefault();
    }
});

// Set default values for ACQ and Rake inputs
if (acqInput.value.trim() === "") {
        acqInput.value = ""; // Default value for ACQ
    }
    if (rakeInput.value.trim() === "") {
        rakeInput.value = ""; // Default value for Rake
    }

    let acq = acqInput.value.trim() === "" ? NaN : parseFloat(acqInput.value);
    let rakeQuantity = rakeInput.value.trim() === "" ? NaN : parseFloat(rakeInput.value);




// Add listeners for dynamic changes
    acqInput.addEventListener("blur", () => {
        acq = parseFloat(acqInput.value) || 0;
        calculateQuarterlyAllocations();
        calculatePerDayValues();updatePercentages();
    });

    rakeInput.addEventListener("blur", () => {
        rakeQuantity = parseFloat(rakeInput.value) || 0;
        calculateQuarterlyAllocations();
        calculatePerDayValues();updatePercentages();
    });

    // Function to ensure valid input and default to 0
    function validateInput(event) {
    const input = event.target;
    const value = input.value.trim();
    const resultContainer = document.getElementById('input-error-badge'); // Add this <div> near your input if not present

    // Badge warning HTMLs
    const badgeMissing = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter a value.
        </span>
      </div>
    `;
    const badgeNegative = `
      <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          Please enter a valid non-negative value.
        </span>
      </div>
    `;

    // Check for missing or negative input
    if (value === "") {
        resultContainer.style.display = 'block';
        resultContainer.innerHTML = badgeMissing;
        return;
    }
    if (!isNaN(value) && parseFloat(value) < 0) {
        resultContainer.style.display = 'block';
        resultContainer.innerHTML = badgeNegative;
        return;
    }

    // Hide badge if input is valid
    resultContainer.style.display = 'none';
    resultContainer.innerHTML = '';
}

    // Attach validation on blur events
    acqInput.addEventListener("blur", validateInput);
    rakeInput.addEventListener("blur", validateInput);







// enforce a maximum value in an editable <td> by comparing the user-entered value with the acq value
    document.querySelectorAll('.actual-quantity').forEach((cell, index, cells) => {
    cell.addEventListener('input', () => {
      const acq = parseInt(acqInput.value, 10); // Get the ACQ value
      let total = 0;

      // Calculate the sum of the current cell and all preceding cells
      for (let i = 0; i <= index; i++) {
        const value = parseInt(cells[i].innerText, 10);
        if (!isNaN(value)) {
          total += value;
        }
      }

      const currentValue = parseInt(cell.innerText, 10);

      // If the sum exceeds ACQ, reset the current cell
      if (total > acq) {
        alert(`Total of current and preceding cells cannot exceed ${acq}`);
        cell.innerText = 0; // Reset the current cell
      } else if (isNaN(currentValue)) {
        cell.innerText = ''; // Clear if not a number
      }
    });

    // Optional: Validate on blur to ensure correctness
    cell.addEventListener('blur', () => {
      const value = parseInt(cell.innerText, 10);
      if (isNaN(value)) {
        cell.innerText = ''; // Clear invalid entries
      }
    });
  });

  // Optional: Handle ACQ changes
  acqInput.addEventListener('input', () => {
    const acq = parseInt(acqInput.value, 10);

    if (isNaN(acq) || acq < 0) {
      acqInput.value = NaN; // Ensure ACQ remains valid
    }

    // Optionally clear cells when ACQ changes
    document.querySelectorAll('.actual-quantity').forEach(cell => {
      const value = parseInt(cell.innerText, 10);
      if (!isNaN(value)) {
        cell.innerText = ''; // Clear all cells
      }
    });
  });


// Define the number of days for each month (Leap year for February)
const daysInMonth = {
                "January": 31,
                "February": 28, // Leap year will be handled dynamically
                "March": 31,
                "April": 30,
                "May": 31,
                "June": 30,
                "July": 31,
                "August": 31,
                "September": 30,
                "October": 31,
                "November": 30,
                "December": 31
            };



 // Define the constant array
 const quarterPercentages = [0.25, 0.22, 0.25, 0.28]; // Initialize with default values

// Select all quarter input boxes, error message, and table labels
const quarterInputs = document.querySelectorAll('.quarter-input');
const errorMessage = document.getElementById('error-message');
const quarterLabels = [
  document.getElementById('q1-label'),
  document.getElementById('q2-label'),
  document.getElementById('q3-label'),
  document.getElementById('q4-label'),
];

// Function to validate and update percentages
function validateAndUpdatePercentages() {
  let totalPercentage = 0;

  // Loop through each input and update the constant array
  quarterInputs.forEach((input, index) => {
    const value = parseFloat(input.value);
    if (!isNaN(value)) {
      totalPercentage += value; // Accumulate the total
      quarterPercentages[index] = value / 100; // Store in array as a decimal

      // Update the table dynamically
      quarterLabels[index].textContent = `Q${index + 1} (${["Apr-Jun", "Jul-Sep", "Oct-Dec", "Jan-Mar"][index]}) ${value}%`;
    }
  });

  const badgePercentageExceed = `
    <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
            <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
            The total percentage cannot exceed 100%.
        </span>
    </div>
`;

const badgePercentageLess = `
    <div class="d-flex flex-wrap gap-1">
        <span class="badge rounded-pill bg-danger text-white">
            <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
            The total percentage cannot be less than 100%.
        </span>
    </div>
`;
  // Check if the total percentage is valid
  if (totalPercentage > 100) {
    errorMessage.style.display = 'block';
    errorMessage.innerHTML = badgePercentageExceed;

  } else if (totalPercentage < 100) {
    errorMessage.style.display = 'block';
    errorMessage.innerHTML = badgePercentageLess;
  } else {
    errorMessage.style.display = 'none'; // Hide error message when valid
  }

  console.log('Updated Quarter Percentages:', quarterPercentages);
  calculateQuarterlyAllocations();updateQuarterlyTable();updatePercentages(); calculatePerDayValues();
}

// Attach event listeners to all quarter input boxes
quarterInputs.forEach(input => {
  input.addEventListener('input', validateAndUpdatePercentages);
});

// Initialize validation and update on page load
validateAndUpdatePercentages();









            // Function to calculate the allocated quantities for each month in a quarter
            function calculateQuarterlyAllocations() {
                const rows = Array.from(table.rows).slice(1);
                const allocatedCells = rows.map(row => row.cells[1]);
                const allocatedRakeCells = rows.map(row => row.cells[2]);

                let totalAllocated = acq;
                let quarterIndex = 0;
                let monthIndex = 0;

                // Distribute ACQ across the months according to quarter percentages
                for (let i = 0; i < 12; i++) {
                    const quarterlyAllocated = totalAllocated * quarterPercentages[quarterIndex];
                    const monthlyAllocated = quarterlyAllocated / 3; // Each quarter has 3 months
                    allocatedCells[i].textContent = monthlyAllocated.toFixed(2); // Allocated Quantity
                    allocatedRakeCells[i].textContent = rakeQuantity
                        ? (monthlyAllocated / rakeQuantity).toFixed(2)
                        : "0"; // Allocated Rakes

                    // Move to the next quarter after 3 months
                    if (++monthIndex === 3) {
                        monthIndex = 0;
                        quarterIndex++;
                    }
                }

                // Update the quarterly table
                updateQuarterlyTable();updatePercentages();
            }

            // Function to redistribute remaining ACQ after a change in the actual quantity of a month
            function redistributeRemainingACQ(changedRowIndex) {
                const rows = Array.from(table.rows).slice(1);
                const actualQuantityCells = rows.map(row => row.cells[3]);
                const actualRakeCells = rows.map(row => row.cells[4]);

                // Calculate the sum of actual quantities up to the changed month
                let sumActuals = 0;
                for (let i = 0; i <= changedRowIndex; i++) {
                    sumActuals += parseFloat(actualQuantityCells[i].textContent) || 0;
                }

                // Remaining ACQ to be distributed
                const remainingACQ = acq - sumActuals;

                // Total allocated quantity for the remaining months
                let totalAllocatedForRemaining = 0;
                for (let i = changedRowIndex + 1; i < rows.length; i++) {
                    totalAllocatedForRemaining += parseFloat(rows[i].cells[1].textContent) || 0;
                }

                // Redistribute remaining ACQ proportionally
                for (let i = changedRowIndex + 1; i < rows.length; i++) {
                    const allocatedQuantity = parseFloat(rows[i].cells[1].textContent) || 0;
                    const proportion = allocatedQuantity / totalAllocatedForRemaining;
                    const newActualQuantity = remainingACQ * proportion;

                    actualQuantityCells[i].textContent = newActualQuantity.toFixed(2);
                    actualRakeCells[i].textContent = rakeQuantity
                        ? (newActualQuantity / rakeQuantity).toFixed(2)
                        : "0";
                }

                // Update the quarterly table
                updateQuarterlyTable();updatePercentages();
            }

            // Function to update the rake for each month when the actual quantity changes
            function updateRakeForMonth(rowIndex) {
                const row = table.rows[rowIndex + 1];
                const actualQuantityCell = row.cells[3];
                const actualRakeCell = row.cells[4];

                const actualQuantity = parseFloat(actualQuantityCell.textContent) || 0;
                if (rakeQuantity && actualQuantity > 0) {
                    const rakeCount = (actualQuantity / rakeQuantity).toFixed(2);
                    actualRakeCell.textContent = rakeCount;
                } else {
                    actualRakeCell.textContent = "0";
                }

                // Update the quarterly table
                updateQuarterlyTable();updatePercentages();
            }

            // Function to copy allocated values to actual values
            function copyAllocatedToActual() {
                const rows = Array.from(table.rows).slice(1);
                rows.forEach(row => {
                    const allocatedQuantity = row.cells[1].textContent;
                    const allocatedRakes = row.cells[2].textContent;

                    row.cells[3].textContent = allocatedQuantity; // Copy Allocated Quantity to Actual Quantity
                    row.cells[4].textContent = allocatedRakes;    // Copy Allocated Rakes to Actual Rakes
                });

                // Update the quarterly table
                updateQuarterlyTable();updatePercentages();
            }

            // Function to update the quarterly table based on monthly data
            function updateQuarterlyTable() {
                const rows = Array.from(table.rows).slice(1);
                const quarterlyRows = Array.from(quarterlyTable.rows).slice(1);

                // Calculate Quarterly Allocated and Actual Quantities and Rakes
                for (let i = 0; i < 4; i++) {
                    let allocatedQty = 0;
                    let allocatedRakes = 0;
                    let actualQty = 0;
                    let actualRakes = 0;

                    for (let j = i * 3; j < (i + 1) * 3; j++) {
                        if (rows[j]) {
                            allocatedQty += parseFloat(rows[j].cells[1].textContent) || 0;
                            allocatedRakes += parseFloat(rows[j].cells[2].textContent) || 0;
                            actualQty += parseFloat(rows[j].cells[3].textContent) || 0;
                            actualRakes += parseFloat(rows[j].cells[4].textContent) || 0;
                        }
                    }

                    quarterlyRows[i].cells[1].textContent = allocatedQty.toFixed(2);  // Allocated Quantity
                    quarterlyRows[i].cells[2].textContent = allocatedRakes.toFixed(2);  // Allocated Rakes
                    quarterlyRows[i].cells[3].textContent = actualQty.toFixed(2);  // Actual Quantity
                    quarterlyRows[i].cells[4].textContent = actualRakes.toFixed(2);  // Actual Rakes
                }updatePercentages();
            }

            table.addEventListener("input", (event) => {
                const inputCell = event.target;
                if (inputCell.classList.contains("actual-quantity")) {
                    const rows = Array.from(table.rows).slice(1);
                    const changedRowIndex = rows.findIndex(row => row.cells[3] === inputCell);
                    redistributeRemainingACQ(changedRowIndex);
                    updateRakeForMonth(changedRowIndex); // Update rake for changed month
                }
            });

            copyButton.addEventListener("click", copyAllocatedToActual);

            acqInput.addEventListener("blur", () => {
                acq = parseFloat(acqInput.value);
                calculateQuarterlyAllocations();calculatePerDayValues();
            });

            rakeInput.addEventListener("blur", () => {
                rakeQuantity = parseFloat(rakeInput.value);
                calculateQuarterlyAllocations();calculatePerDayValues();
            });
            acqInput.addEventListener("input", () => {
    acq = parseFloat(acqInput.value);
    calculateQuarterlyAllocations();calculatePerDayValues();
});

rakeInput.addEventListener("input", () => {
    rakeQuantity = parseFloat(rakeInput.value);
    calculateQuarterlyAllocations();
    calculatePerDayValues();
});


            

            // Function to calculate per day values
            function calculatePerDayValues() {
                const rows = Array.from(table.rows).slice(1);
                const perDayRows = Array.from(perDayTable.rows).slice(1);

                for (let i = 0; i < 12; i++) {
                    const month = rows[i].cells[0].textContent;
                    const allocatedQuantity = parseFloat(rows[i].cells[1].textContent) || 0;
                    const allocatedRakes = parseFloat(rows[i].cells[2].textContent) || 0;
                    const actualQuantity = parseFloat(rows[i].cells[3].textContent) || 0;
                    const actualRakes = parseFloat(rows[i].cells[4].textContent) || 0;

                    const days = (month === "February" && isLeapYear()) ? 29 : daysInMonth[month];

                    perDayRows[i].cells[1].textContent = (allocatedQuantity / days).toFixed(2);
                    perDayRows[i].cells[2].textContent = (allocatedRakes / days).toFixed(2);
                    perDayRows[i].cells[3].textContent = (actualQuantity / days).toFixed(2);
                    perDayRows[i].cells[4].textContent = (actualRakes / days).toFixed(2);
                }
            }

            // Function to check if it's a leap year
            function isLeapYear() {
                const year = new Date().getFullYear();
                return (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0));
            }

            // Call this function to update per day values
            function updatePerDayValues() {
                calculatePerDayValues();updatePercentages();
            }

            // Add event listener to recalculate per day values when actual quantities change
            table.addEventListener("input", (event) => {
                const inputCell = event.target;
                if (inputCell.classList.contains("actual-quantity")) {
                    updatePerDayValues();
                }
            });

            copyButton.addEventListener("click", function() {
                const rows = Array.from(table.rows).slice(1);
                rows.forEach(row => {
                    const allocatedQuantity = row.cells[1].textContent;
                    const allocatedRakes = row.cells[2].textContent;
                    row.cells[3].textContent = allocatedQuantity; // Copy Allocated Quantity to Actual Quantity
                    row.cells[4].textContent = allocatedRakes;    // Copy Allocated Rakes to Actual Rakes
                });

                updatePerDayValues(); // Recalculate per day values after copying
            });

            acqInput.addEventListener("blur", () => {
                acq = parseFloat(acqInput.value);
                updatePerDayValues();
            });

            rakeInput.addEventListener("blur", () => {
                rakeQuantity = parseFloat(rakeInput.value);
                updatePerDayValues();
            });

            // Initial calculation when the page loads
            updatePerDayValues();updatePercentages();
      
        });


        // Function to allow only positive numbers in contenteditable cells
document.querySelectorAll('.actual-quantity').forEach(cell => {
    // Handle the blur event to validate input
    cell.addEventListener('blur', function () {
        let value = parseFloat(this.textContent.trim());
        // If value is not a number or is negative, reset the cell to empty
        if (isNaN(value) || value < 0) {
            this.textContent = ""; // Clear invalid input
        }
    });

    // Restrict invalid characters while typing using the keydown event
    cell.addEventListener('keydown', function (event) {
        // Allow backspace, delete, and navigation keys
        const allowedKeys = [
            "Backspace",
            "Delete",
            "ArrowLeft",
            "ArrowRight",
            "Tab",
        ];
        if (allowedKeys.includes(event.key)) {
            return;
        }

        // Prevent entry of non-numeric characters or multiple dots
        if (!/^[\d.]$/.test(event.key) || (event.key === "." && this.textContent.includes("."))) {
            event.preventDefault();
        }
    });
});





    document.addEventListener("keydown", function (event) {
    if (event.key === "Tab") {
        const activeElement = document.activeElement;

        // Check if the current element is contenteditable
        if (activeElement && activeElement.getAttribute("contenteditable") === "true") {
            event.preventDefault(); // Prevent default tab behavior

            // Get all contenteditable cells
            const editableCells = Array.from(
                document.querySelectorAll("[contenteditable='true']")
            );

            // Find the index of the currently active cell
            const currentIndex = editableCells.indexOf(activeElement);

            // Determine the next index based on Shift key (for reverse navigation)
            const nextIndex = event.shiftKey
                ? (currentIndex - 1 + editableCells.length) % editableCells.length
                : (currentIndex + 1) % editableCells.length;

            // Focus the next cell and select its content
            const nextCell = editableCells[nextIndex];
            nextCell.focus();

            // Use setTimeout to ensure the content is selected after focus
            setTimeout(() => {
                const range = document.createRange();
                const selection = window.getSelection();

                range.selectNodeContents(nextCell);
                selection.removeAllRanges();
                selection.addRange(range);
            }, 0);
        }
    }
});




// Function to calculate and update percentages
function updatePercentages() {
    const acqInput = document.getElementById("acq-input");
            const rakeInput = document.getElementById("rake-quantity-input");
            const table = document.getElementById("coal-table");
            const quarterlyTable = document.getElementById("quarterly-table");
            const perDayTable = document.getElementById("per-day-table");
            const copyButton = document.getElementById("copy-cells-btn");





    // Update percentages for the monthly table
    const rows = Array.from(table.rows).slice(1); // Skip header row
    rows.forEach(row => {
        const allocatedQty = parseFloat(row.cells[1].textContent) || 0; // Allocated Quantity
        const actualQty = parseFloat(row.cells[3].textContent) || 0; // Actual Quantity
        const percentageCell = row.cells[5]; // Last column for percentage

        // Calculate percentage and update cell
        if (allocatedQty > 0) {
            const percentage = (actualQty / allocatedQty) * 100;
            percentageCell.textContent = `${percentage.toFixed(2)}%`;
        } else {
            percentageCell.textContent = "0%";
        }
    });

    // Update percentages for the quarterly table
    const quarterlyRows = Array.from(quarterlyTable.rows).slice(1); // Skip header row
    quarterlyRows.forEach(row => {
        const allocatedQty = parseFloat(row.cells[1].textContent) || 0; // Allocated Quantity
        const actualQty = parseFloat(row.cells[3].textContent) || 0; // Actual Quantity
        const percentageCell = row.cells[5]; // Last column for percentage

        // Calculate percentage and update cell
        if (allocatedQty > 0) {
            const percentage = (actualQty / allocatedQty) * 100;
            percentageCell.textContent = `${percentage.toFixed(2)}%`;
        } else {
            percentageCell.textContent = "0%";
        }
    });

    // Update percentages for the per-day table
    const perDayRows = Array.from(perDayTable.rows).slice(1); // Skip header row
    perDayRows.forEach(row => {
        const allocatedQty = parseFloat(row.cells[1].textContent) || 0; // Allocated Quantity
        const actualQty = parseFloat(row.cells[3].textContent) || 0; // Actual Quantity
        const percentageCell = row.cells[5]; // Last column for percentage

        // Calculate percentage and update cell
        if (allocatedQty > 0) {
            const percentage = (actualQty / allocatedQty) * 100;
            percentageCell.textContent = `${percentage.toFixed(2)}%`;
        } else {
            percentageCell.textContent = "0%";
        }
    });
}

















//pdf gen

function generatePDFforCoalLinkageAdvance() {
    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(14);
    doc.setFontStyle("bold"); // Sets the font to bold 

    // Add headers and rows for the outputs table
    doc.autoTable({
        startY: 20,
        head: [["Monthly Distribution of Annual Contracted Quantity (ACQ) considering the Quantity already supplied during a Financial Year"]],
        theme: "grid",
        styles: { fontSize: 14 },
        tableWidth: "auto",
        margin: { top: 10 }    });
    //doc.text("Distribution of Annual Coal Quantity (ACQ) - Month-wise, Quarter-wise and Per Day", 15, 20);

    doc.setFontSize(11);
    
    // Fetch ACQ and Rake quantity
    const acqInput = document.getElementById("acq-input").value;
    const rakeInput = document.getElementById("rake-quantity-input").value;

    // Add ACQ and Rake information above the table
    doc.text(`Annual Contracted Quantity (ACQ): ${formatIndianStyleNumber(Number(acqInput))} Metric Tonnes`, 15, 40);
    doc.text(`Quantity in a Rake: ${formatIndianStyleNumber(Number(rakeInput).toFixed(0))} Metric Tonnes`, 15, 50);


    doc.setFontSize(8);
    doc.setFont("helvetica", "bolditalic"); // Sets the font to Helvetica bold italic

    doc.text("[Figs. in Metric Tonnes (Rakes)]", 140, 60);
    const table = document.getElementById("coal-table");
    const quarterlyTable = document.getElementById("quarterly-table");
    const perDayTable = document.getElementById("per-day-table");

    if (!table || !quarterlyTable || !perDayTable) {
        console.error("One or more tables not found");
        return;
    }

    const data = [];
    const headers = [
        "Month / Quarter",
        "Monthly Allocated Quantity",
        "Per Day Allocated Quantity",
        "Monthly Actual Quantity",
        "Per Day Actual Quantity",
    ];

    const tableRows = Array.from(table.rows).slice(1); // Skip header
    const quarterlyRows = Array.from(quarterlyTable.rows).slice(1); // Skip header
    const perDayRows = Array.from(perDayTable.rows).slice(1); // Skip header

    let quarterIndex = 0;

    for (let i = 0; i < tableRows.length; i++) {
        const monthRow = tableRows[i];
        const quarterRow = quarterlyRows[quarterIndex];
        const perDayRow = perDayRows[i];

        const month = monthRow.cells[0].textContent.trim();
        const allocatedQty = formatIndianStyleNumber(Number(monthRow.cells[1].textContent.trim()));
        const allocatedRakes = monthRow.cells[2].textContent.trim();
        const actualQty = formatIndianStyleNumber(Number(monthRow.cells[3].textContent.trim()));
        const actualRakes = monthRow.cells[4].textContent.trim();
        const perDayAllocatedQty = formatIndianStyleNumber(Number(perDayRow.cells[1].textContent.trim()));
        const perDayAllocatedRakes = perDayRow.cells[2].textContent.trim();
        const perDayActualQty = formatIndianStyleNumber(Number(perDayRow.cells[3].textContent.trim()));
        const perDayActualRakes = perDayRow.cells[4].textContent.trim();

        data.push([
            month,
            `${allocatedQty}\n(${allocatedRakes})`,  
            `${perDayAllocatedQty}\n(${perDayAllocatedRakes})`,  
            `${actualQty}\n(${actualRakes})`,  
            `${perDayActualQty}\n(${perDayActualRakes})`,  
        ]);

        // Add quarter data after every three months
        if ((i + 1) % 3 === 0 && quarterRow) {
            const quarterName = quarterRow.cells[0].textContent.trim();
            const quarterAllocatedQty = formatIndianStyleNumber(Number(quarterRow.cells[1].textContent.trim()));
            const quarterAllocatedRakes = quarterRow.cells[2].textContent.trim();
            const quarterActualQty = formatIndianStyleNumber(Number(quarterRow.cells[3].textContent.trim()));
            const quarterActualRakes = quarterRow.cells[4].textContent.trim();

            data.push([
                quarterName,
                `${quarterAllocatedQty}\n(${quarterAllocatedRakes})`,
                "-", // No per day values for quarters
                `${quarterActualQty}\n(${quarterActualRakes})`,
                "-",
            ]);

            quarterIndex++;
        }
    }

    // Add the data to the PDF with quarter rows highlighted
    doc.autoTable({
        head: [headers],
        headStyles: {
        //fontSize: 12, // Header font size
        //fontStyle: "bold", // Header font style (e.g., "normal", "bold", "italic")
       // fillColor: [200, 200, 200], // Background color of the header (light gray)
       // textColor: [0, 0, 0], // Text color (black)
        halign: "center", // Horizontal alignment ("left", "center", "right")
        valign: "top", // Vertical alignment ("top", "middle", "bottom")
    },
        body: data,
        startY: 62,
        theme: "grid",
        overflow: "linebreak", // Wrap long text
        styles: { fontSize: 10 },
        columnStyles: {
            0: { cellWidth: 35 }, // Month/Quarter column
            1: { cellWidth: 35, halign: 'center', valign: 'middle' }, // Allocated Quantity / Rakes
            2: { cellWidth: 35, halign: 'center', valign: 'middle' }, // Actual Quantity / Rakes
            3: { cellWidth: 35, halign: 'center', valign: 'middle' }, // Per Day Allocated / Rakes
            4: { cellWidth: 35, halign: 'center', valign: 'middle' }, // Per Day Actual / Rakes
        },
        didParseCell: (data) => {
            if (data.row.raw[0].includes("Q1") ||
            data.row.raw[0].includes("Q2") ||
            data.row.raw[0].includes("Q3") ||
            data.row.raw[0].includes("Q4")) {
                // Highlight quarter rows
                data.cell.styles.fillColor = [180, 180, 180]; // Light gray
                data.cell.styles.fontStyle = "bold"; //  bold

            }
        },
    });

    // Save the PDF
    doc.save("CoalAllocationDistribution.pdf");
}








// Function for Tab 7: Cost Economics of blended coal

document.addEventListener('DOMContentLoaded', function () {
    const blendedInputs = [
        document.getElementById("gcv-arb-Indian"),
        document.getElementById("coal-cost-indian"),
        document.getElementById("railway-freight-indian"),
        document.getElementById("gcv-arb-Imported"),
        document.getElementById("coal-cost-imported"),
        document.getElementById("railway-freight-imported"),
        document.getElementById("generationcapacity-blended"),
        document.getElementById("plf-blended"),
        document.getElementById("days-blended"),
        document.getElementById("shr-blended"),
        document.getElementById("blending-ratio")
    ];
    blendedInputs.forEach(input => {
        input.addEventListener('input', calculateBlendedCoalEnergyCharges);
    });
});

document.addEventListener('DOMContentLoaded', function () {
    // Prevent negative and non-numeric input for all number fields in blending section
    [
        "coal-cost-indian", "coal-cost-imported",
        "railway-freight-indian", "railway-freight-imported",
        "gcv-arb-Indian", "gcv-arb-Imported",
        "generationcapacity-blended", "plf-blended",
        "days-blended", "shr-blended", "blending-ratio"
    ].forEach(function(id) {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('keydown', function(e) {
                // Allow: backspace, delete, tab, escape, enter, arrows, dot
                if (
                    [46, 8, 9, 27, 13, 110, 190].indexOf(e.keyCode) !== -1 ||
                    // Allow: Ctrl/cmd+A/C/V/X/Z
                    ((e.ctrlKey || e.metaKey) && [65, 67, 86, 88, 90].indexOf(e.keyCode) !== -1) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)
                ) {
                    return;
                }
                // Prevent: anything not a number
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) &&
                    (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
                // Prevent minus and plus
                if (e.key === '-' || e.key === '+' || e.key === 'e') {
                    e.preventDefault();
                }
            });
            input.addEventListener('input', function(e) {
                if (parseFloat(input.value) < 0) input.value = '';
            });
        }
    });

    // Listen for input changes to calculate and show badges
    [
        "coal-cost-indian", "coal-cost-imported",
        "railway-freight-indian", "railway-freight-imported",
        "gcv-arb-Indian", "gcv-arb-Imported",
        "generationcapacity-blended", "plf-blended",
        "days-blended", "shr-blended", "blending-ratio"
    ].forEach(function(id) {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('input', showBlendingBadges);
        }
    });
});
document.addEventListener('DOMContentLoaded', function () {
    const coalAInput = document.getElementById('coalA-blending-name');
    const coalAHeader = document.getElementById('coalA-header');
    if (coalAInput && coalAHeader) {
        coalAInput.addEventListener('input', function () {
            coalAHeader.textContent = coalAInput.value || 'Indigenous Coal';
        });
    }
});
document.addEventListener('DOMContentLoaded', function () {
    const coalBInput = document.getElementById('coalB-blending-name');
    const coalBHeader = document.getElementById('coalB-header');
    if (coalBInput && coalBHeader) {
        coalBInput.addEventListener('input', function () {
            coalBHeader.textContent = coalBInput.value || 'Imported Coal';
        });
    }
});

function calculateBlendedCoalEnergyCharges() {
        // Get input values
        const gcvArbindian = parseFloat(document.getElementById("gcv-arb-Indian").value);
        const coalCostIndian = parseFloat(document.getElementById("coal-cost-indian").value);
        const railwayFreightIndian = parseFloat(document.getElementById("railway-freight-indian").value);
        const gcvArbimported = parseFloat(document.getElementById("gcv-arb-Imported").value);
        const coalCostImported = parseFloat(document.getElementById("coal-cost-imported").value);
        const railwayFreightImported = parseFloat(document.getElementById("railway-freight-imported").value);
        const generationcapacityblended = parseFloat(document.getElementById("generationcapacity-blended").value);
        let plfblended = parseFloat(document.getElementById("plf-blended").value);
        const daysblended = parseFloat(document.getElementById("days-blended").value);
        const shrblended = parseFloat(document.getElementById("shr-blended").value);
        const blendingRatio = parseFloat(document.getElementById("blending-ratio").value);
        const IndianCoalQuantityRatioAfterBlending = 100 - blendingRatio; // Percentage of Indian coal after blending
        const ImportedCoalQuantityRatioAfterBlending = blendingRatio; // Percentage of imported coal after blending


        // Ensure PLF does not exceed 100
        if (plfblended > 100) {
            plfblended = 100;
            document.getElementById("plf-blended").value = 100;
        }


       

    
    if (
    isNaN(gcvArbindian) || isNaN(coalCostIndian) || isNaN(railwayFreightIndian) || isNaN(gcvArbimported) ||
    isNaN(coalCostImported) || isNaN(railwayFreightImported) || isNaN(generationcapacityblended) || isNaN(plfblended) || isNaN(daysblended) || isNaN(shrblended) ||
    isNaN(blendingRatio)
) {
    // Show error badge
    document.getElementById('resultshow70').style.display = 'block';
    document.getElementById('resultshowblending').style.display = 'none';
    document.getElementById('resultshow71').style.display = 'none';
    //document.getElementById('resultshow72').style.display = 'none';
   // document.getElementById('resultshow73').style.display = 'none';

    // var errorSpan = document.getElementById('blending-error-result');
    // if (errorSpan) {
    //     errorSpan.textContent = "Please enter required inputs.";
    // }
    return;
}

// If all inputs are valid, hide error badge and show results
// document.getElementById('resultshow70').style.display = 'none';
// document.getElementById('resultshowblending').style.display = 'block';
// document.getElementById('resultshow71').style.display = 'block';

        // Calculate Landed Cost of Indian Coal (Rs. / MT)
        const landedCostIndian = coalCostIndian + railwayFreightIndian;

        // Calculate Landed Cost of Indian Coal (Rs. / MC)
        const landedCostIndianMC = landedCostIndian/gcvArbindian;

        // Calculate Energy Charges of Indian Coal
        const energyChargesIndian = (landedCostIndian * shrblended) / (gcvArbindian * 1000);
        const sccIndian = shrblended/gcvArbindian;

        // Calculate Energy Charges of Imported Coal
        const landedCostImported = coalCostImported + railwayFreightImported;
        const landedCostImportedMC = landedCostImported/gcvArbimported;
        const energyChargesImported = (landedCostImported * shrblended) / (gcvArbimported * 1000);
        const sccImported = shrblended/gcvArbimported;

        // Calculate GCV Blended
        const gcvBlended = (gcvArbindian * (1-(blendingRatio/100))) + (gcvArbimported * (blendingRatio/100));
        // Calculate SCC Blended
        const sccBlended= shrblended/gcvBlended;

        // Calculate Landed Cost of Blended Coal
        const landedCostBlended = (landedCostIndian * (1-(blendingRatio/100))) + (landedCostImported * (blendingRatio/100));
        const landedCostBlendedMC = landedCostBlended/gcvBlended; 

        // Calculate Energy Charges of Blended Coal
        const energyChargesBlended = (energyChargesIndian * (1-(blendingRatio/100))) + (energyChargesImported * (blendingRatio/100));

        const quantityIndianCoal = (generationcapacityblended * daysblended * 24 * plfblended * 10 * shrblended) / (gcvArbindian * 100000000);
        const quantityImportedCoal = quantityIndianCoal * blendingRatio/100;
        const quantityIndianCoalAfterBlending = quantityIndianCoal - (quantityImportedCoal * gcvArbimported / gcvArbindian);
        const quantityblendedCoal = quantityIndianCoalAfterBlending + quantityImportedCoal;


        const expenditureIndianCoal = quantityImportedCoal * landedCostIndian * gcvArbimported / gcvArbindian;
        const expenditureImportedCoal = quantityImportedCoal * landedCostImported;
        const additionalFinancialLiability = (expenditureImportedCoal - expenditureIndianCoal) * 100000;
        const additionalFinancialLiabilityformatted = formatIndianStyleNumber(additionalFinancialLiability);
        //console.log(additionalFinancialLiability)

        const unitsgeneratedBlended = generationcapacityblended * plfblended * daysblended * 24 * 10/100000;
        const unitsgeneratedBlendedformatted = formatIndianStyleNumber(unitsgeneratedBlended);
        // console.log(unitsgeneratedBlendedformatted)

        // Compare Energy Charges
        const comparisonResult =(energyChargesBlended-energyChargesIndian) * (sccIndian/sccImported);
        const energyChargesAfterBlending = energyChargesIndian + comparisonResult;
        
        // Display Results
        document.getElementById("indian-coal-quantity").innerText = `${quantityIndianCoal.toFixed(5)}`;

        document.getElementById("indian-coal-quantity-ratio-after-blending").innerText = `${IndianCoalQuantityRatioAfterBlending.toFixed(2)}`;
        document.getElementById("imported-coal-quantity-ratio-after-blending").innerText = ` ${ImportedCoalQuantityRatioAfterBlending.toFixed(2)}`;

        document.getElementById("indian-coal-quantity-after-blending").innerText = ` ${quantityIndianCoalAfterBlending.toFixed(2)}`;
        document.getElementById("imported-coal-quantity-after-blending").innerText = ` ${quantityImportedCoal.toFixed(2)}`;
        document.getElementById("blendedcoal").innerText = ` ${quantityblendedCoal.toFixed(2)}`;


        document.getElementById("gcv-arb-Indian-table").innerText = `${gcvArbindian.toFixed(2)}`;
        document.getElementById("gcv-arb-Imported-tabel").innerText = `${gcvArbimported.toFixed(2)}`;
        document.getElementById("gcv-blended").innerText = `${gcvBlended.toFixed(2)}`;


        document.getElementById("indian-coal-landed-charges-MT").innerText = `${landedCostIndian.toFixed(2)}`;
        document.getElementById("Imported-coal-landed-charges-MT").innerText = `${landedCostImported.toFixed(2)}`;
        document.getElementById("landed-cost-blended-MT").innerText = `${landedCostBlended.toFixed(2)}`;
        
        document.getElementById("indian-coal-landed-charges-MC").innerText = ` ${landedCostIndianMC.toFixed(4)}`;
        document.getElementById("Imported-coal-landed-charges-MC").innerText = `${landedCostImportedMC.toFixed(4)}`;
        document.getElementById("landed-cost-blended-MC").innerText = `${landedCostBlendedMC.toFixed(4)}`;

        document.getElementById("indian-coal-energy-charges").innerText = `${energyChargesIndian.toFixed(4)}`;
        document.getElementById("Imported-coal-energy-charges").innerText = `${energyChargesImported.toFixed(4)}`;
        document.getElementById("blended-coal-energy-charges").innerText = `${energyChargesAfterBlending.toFixed(4)}`;

        document.getElementById("indian-coal-SCC").innerText = `${sccIndian.toFixed(4)}`;
        document.getElementById("Imported-coal-SCC").innerText = `${sccImported.toFixed(4)}`;
        document.getElementById("blended-coal-SCC").innerText = `${sccBlended.toFixed(4)}`;

       


        document.getElementById("comparison-result").innerText = `${comparisonResult.toFixed(4)}`;
        document.getElementById("additionalFinancialLiabilityImported-result").innerText = `${additionalFinancialLiabilityformatted}`;
        document.getElementById("unitsGeneratedBlended-result").innerText = `${unitsgeneratedBlendedformatted}`;



        // Display the result
        resultshow70.style.display = 'none';
        const resultshow71 = document.getElementById('resultshow71');
        resultshow71.style.display = 'block';
      //  const resultshow72 = document.getElementById('resultshow72');
       // resultshow72.style.display = 'block';
       // const resultshow73 = document.getElementById('resultshow73');
       // resultshow73.style.display = 'block';
       


        // Show badges
    document.getElementById('blended-coal-perunitcost').textContent = `Per Unit Cost: Rs. ${comparisonResult.toFixed(4)}`;
    document.getElementById('blended-coal-addlfinancialliability').textContent = `Addl. Financial Liability: Rs. ${additionalFinancialLiabilityformatted.toLocaleString('en-IN', {maximumFractionDigits: 0})}`;
    document.getElementById('resultshowblending').style.display = 'block';

    // Show badges at the top
// document.getElementById('blended-coal-perunitcost').textContent =
//     `Increase in Per Unit Cost due to Blending: Rs. ${comparisonResult.toFixed(4)}`;
// document.getElementById('blended-coal-addlfinancialliability').textContent =
//     `Addl. Financial Liability due to Blending: Rs. ${additionalFinancialLiabilityformatted}`;
// document.getElementById('additionalFinancialLiabilityformatted').style.display = 'block';
    }


    function generatePDFblendedcoal() {
    // Create a new jsPDF instance
    let doc = new jsPDF("p", "mm", [210, 297]);
    doc.setFontSize(16);
    doc.text("Indigenous Coal and Imported Coal Blending Analysis", 25, 25);

    // Create an empty array to hold the table data
    const tableData = [];

    // Gather input values
    const gcvArbindian = parseFloat(document.getElementById("gcv-arb-Indian").value);
    const coalCostIndian = parseFloat(document.getElementById("coal-cost-indian").value);
    const railwayFreightIndian = parseFloat(document.getElementById("railway-freight-indian").value);
    const gcvArbimported = parseFloat(document.getElementById("gcv-arb-Imported").value);
    const coalCostImported = parseFloat(document.getElementById("coal-cost-imported").value);
    const railwayFreightImported = parseFloat(document.getElementById("railway-freight-imported").value);
    const shrblended = parseFloat(document.getElementById("shr-blended").value);
    const blendingRatio = parseFloat(document.getElementById("blending-ratio").value);

    const coalAblendingname = document.getElementById('coalA-blending-name').value;
    const coalBblendingname = document.getElementById('coalB-blending-name').value;

    // Gather calculation results

    const landedCostIndian = coalCostIndian + railwayFreightIndian;
    const energyChargesIndian = (landedCostIndian * shrblended) / (gcvArbindian * 1000);

    const landedCostImported = coalCostImported + railwayFreightImported;
    const energyChargesImported = (landedCostImported * shrblended) / (gcvArbimported * 1000);

    const landedCostBlended = (landedCostIndian * (1 - (blendingRatio / 100))) + (landedCostImported * (blendingRatio / 100));
    const gcvBlended = (gcvArbindian * (1 - (blendingRatio / 100))) + (gcvArbimported * (blendingRatio / 100));
    const energyChargesBlended = (landedCostBlended * shrblended) / (gcvBlended * 1000);

    const comparisonResult = energyChargesBlended - energyChargesIndian;

    // Gather input values and add them to the table data array
    tableData.push(
        ["Parameter", coalAblendingname, coalBblendingname, "Blended Coal"],
        ["GCV (ARB) (kcal/kg)", gcvArbindian, gcvArbimported, gcvBlended],
        ["Coal Cost (Rs./MT)", coalCostIndian, coalCostImported, "--"],
        ["Railway Freight (Rs./MT)", railwayFreightIndian, railwayFreightImported, "--"],
        ["Landed Cost (Rs./MT)", landedCostIndian, landedCostImported, landedCostBlended],
        ["Station Heat Rate (kcal/kWh)", shrblended, "--","--"],
        ["Blending Ratio (%)", blendingRatio, "--", "--"],
        ["Energy Charges (Rs./kWh)", energyChargesIndian.toFixed(2), energyChargesImported.toFixed(2), energyChargesBlended.toFixed(2)]
        );

    // Add headers and rows for the inputs table
    doc.autoTable({
        startY: 40,
        head: [["Parameter", coalAblendingname, coalBblendingname, "Blended Coal"]],
        body: tableData.slice(1, 8), // Exclude the first row (headers) and Station Heat Rate row
        //foot: [["Increase in Energy Charges due to Blending (Rs./kWh)", comparisonResult.toFixed(2)],],
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 25 },
        columnStyles: {
        0: { halign: "left" }, // Parameter column aligns left
        1: { halign: "center" }, // Indian Coal column aligns right
        2: { halign: "center" }, // Imported Coal column aligns right
        3: { halign: "center" },  // Blended Coal column aligns right
    }
    });
    // Add headers and rows for the outputs table
    doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Increase in Energy Charges due to Blending (Rs./kWh)", comparisonResult.toFixed(2),]],
        //body: [                ["Increase in Energy Charges due to Blending (Rs./kWh)", comparisonResult.toFixed(2),]        ],
        theme: "grid",
        tableWidth: "auto",
        margin: { top: 10 }
    });

    // Save the PDF
    doc.save("BlendedCoalAnalysis.pdf");
}


const aflParameterValues = [];

function calculateAdditionalFinancialLiability() {
    const plantName = prompt("Enter the Plant Name:");
    const ACR = parseFloat(document.getElementById("afl-ACR").value/100000);
    const linkedCoalCost = parseFloat(document.getElementById("afl-Landedcostlinked").value);
    const linkedCoalGCV = parseFloat(document.getElementById("afl-GCVlinked").value);
    const afPercentage = parseFloat(document.getElementById("afl-AFpercentage").value);
    const afCost = parseFloat(document.getElementById("afl-LandedcostAlternate").value);
    const afGCV = parseFloat(document.getElementById("afl-GCVAlternate").value);

   
   // Validate input fields for negative values
    if (
        ACR < 0 ||
        linkedCoalCost < 0 ||  
        linkedCoalGCV < 0 ||
        afPercentage < 0 ||   
        afCost < 0 ||
        afGCV < 0    
        ) {// Display the result
    const resultshow8 = document.getElementById('resultshow8');
        resultshow8.style.display = 'block';
        document.getElementById("additionalFinancialLiability-result").innerText = "Please enter valid non negative inputs.";
        return;
    }

    if (
        isNaN(ACR) ||
        isNaN(linkedCoalCost) ||
        isNaN(linkedCoalGCV) ||
        isNaN(afPercentage) ||
        isNaN(afCost) ||
        isNaN(afGCV)
    ) {
        document.getElementById("additionalFinancialLiability-result").innerText = "Please enter valid numbers for all fields.";
        return;
    }
    const quantityAlternateFuel = ACR * afPercentage/100;
    const quantityLinkedCoal = ACR - quantityAlternateFuel;
    const additionalLiability =
        (ACR * (afPercentage / 100)) *
        ((afCost * afGCV) - (linkedCoalCost * linkedCoalGCV))/100;

    document.getElementById("additionalFinancialLiability-result").innerText =
        `Additional Financial Liability for using Alternate Fuel: Rs. ${additionalLiability.toFixed(2)} Crore`;

    const parameterValueObj = {
        "Plant Name": plantName,
        "Annual Coal Requirement": ACR.toFixed(2),
        "Percentage of Alternate Fuel": afPercentage.toFixed(2),
        "Quantity of Linked Coal": quantityLinkedCoal.toFixed(2),
        "Quantity of Alternate Fuel": quantityAlternateFuel.toFixed(2),
        "Landed Cost of Linked Coal": linkedCoalCost.toFixed(2),
        "GCV of Linked Coal": linkedCoalGCV.toFixed(2),       
        "Landed Cost of Alternate Fuel": afCost.toFixed(2),
        "GCV of Alternate Fuel": afGCV.toFixed(2),
        "Additional Financial Liability for using Alternate Fuel": additionalLiability.toFixed(2),
    };

    aflParameterValues.push(parameterValueObj);
    updateAflRowCountBadge();
// Display the result
    const resultshow8 = document.getElementById('resultshow8');
        resultshow8.style.display = 'block';
renderAFLTable();
}

function renderAFLTable() {
    const tableContainer = document.getElementById('aflTableContainer');
    const tableHeaderRow = document.getElementById('aflTableHeaderRow');
    const tableBody = document.getElementById('aflTableBody');
    const tableFooter = document.getElementById('aflTableFooter');
    tableBody.innerHTML = '';
    tableFooter.innerHTML = '';

    if (aflParameterValues.length === 0) {
        tableContainer.style.display = 'none';
        return;
    }
    tableContainer.style.display = 'block';

    // List of parameters in order
    const paramList = [
        "Annual Coal Requirement",
        "Percentage of Alternate Fuel",
        "Quantity of Linked Coal",
        "Quantity of Alternate Fuel",
        "Landed Cost of Linked Coal",
        "GCV of Linked Coal",
        "Landed Cost of Alternate Fuel",
        "GCV of Alternate Fuel",
        "Additional Financial Liability for using Alternate Fuel"
    ];
    const paramLabels = [
        "Annual Coal Requirement<br>(Lakh MT)",
        "Alternate Fuel (%)",
        "Quantity of Linked Coal<br>(Lakh MT)",
        "Quantity of Alternate Fuel<br>(Lakh MT)",
        "Landed Cost of Linked Coal<br>(Rs./M.Cal.)",
        "GCV of Linked Coal<br>(kcal/kg)",
        "Landed Cost of Alternate Fuel<br>(Rs./M.Cal.)",
        "GCV of Alternate Fuel<br>(kcal/kg)",
        "Additional Financial Liability<br>(Rs. Crore)"
    ];

    // Build header row
    tableHeaderRow.innerHTML = `<th>Parameter</th>`;
    aflParameterValues.forEach(row => {
        tableHeaderRow.innerHTML += `<th>${row["Plant Name"]}</th>`;
    });
    tableHeaderRow.innerHTML += `<th>Total / Avg</th>`;

    // Build body rows (one per parameter)
  paramList.forEach((param, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${paramLabels[idx]}</td>`;
    let total = 0;
    let count = 0;
    let weightedSum = 0;
    let weightedBase = 0;

    aflParameterValues.forEach(row => {
        const val = parseFloat(row[param]);
        tr.innerHTML += `<td>${row[param]}</td>`;
        if (!isNaN(val)) {
            total += val;
            count++;
        }
        // For weighted averages
        if (param === "Landed Cost of Linked Coal") {
            // Weighted by Annual Coal Requirement
            const acr = parseFloat(row["Annual Coal Requirement"]);
            if (!isNaN(val) && !isNaN(acr)) {
                weightedSum += val * acr;
                weightedBase += acr;
            }
        }
        if (param === "Landed Cost of Alternate Fuel") {
            // Weighted by Quantity of Alternate Fuel
            const qaf = parseFloat(row["Quantity of Alternate Fuel"]);
            if (!isNaN(val) && !isNaN(qaf)) {
                weightedSum += val * qaf;
                weightedBase += qaf;
            }
        }
        if (param === "GCV of Linked Coal") {
            // Weighted by Quantity of Linked Coal
            const qlc = parseFloat(row["Quantity of Linked Coal"]);
            if (!isNaN(val) && !isNaN(qlc)) {
                weightedSum += val * qlc;
                weightedBase += qlc;
            }
        }
        if (param === "GCV of Alternate Fuel") {
            // Weighted by Quantity of Alternate Fuel
            const qaf = parseFloat(row["Quantity of Alternate Fuel"]);
            if (!isNaN(val) && !isNaN(qaf)) {
                weightedSum += val * qaf;
                weightedBase += qaf;
            }
        }
    });

    // Show sum, average, or weighted average as appropriate
    let totalCell = "";
    if (param === "Percentage of Alternate Fuel") {
        totalCell = count ? (total / count).toFixed(2) : "";
    } else if (param === "Landed Cost of Linked Coal" ||
               param === "Landed Cost of Alternate Fuel" ||
               param === "GCV of Linked Coal" ||
               param === "GCV of Alternate Fuel") {
        totalCell = weightedBase ? (weightedSum / weightedBase).toFixed(2) : "";
    } else if (param.includes("GCV") || param.includes("Landed Cost")) {
        totalCell = count ? (total / count).toFixed(2) : "";
    } else {
        totalCell = total.toFixed(2);
    }
    tr.innerHTML += `<td style="font-weight:bold;background:#f8f9fa;">${totalCell}</td>`;
    tableBody.appendChild(tr);
});
}




function updateAflRowCountBadge() {
    document.getElementById("alfrowCountBadge").innerText = aflParameterValues.length;
}

function clearAFLParameterValues() {
    const confirmation = confirm("Do you really want to clear the calculations?");
    if (confirmation) {
        aflParameterValues.splice(0, aflParameterValues.length);
        updateAflRowCountBadge();
    }
}
function generatePDFForAdditionalFinancialLiability() {

    //prevent to close the accordion tab after pressing any button
    event.preventDefault();

    if (aflParameterValues.length === 0) {
        alert("No parameter values are stored.");
        return;
    }

    // Calculate the requested totals and weighted averages
    let totalACR = 0;
    let totalQuantityLinkedCoal = 0;
    let totalQuantityAlternateFuel = 0;
    let totalWeightedGCVLinkedCoal = 0;
    let totalWeightedCostLinkedCoal = 0;
    let totalWeightedGCVAlternateFuel = 0;
    let totalWeightedCostAlternateFuel = 0;
    let totalAdditionalFinancialLiability = 0;
    const afPercentage = parseFloat(document.getElementById("afl-AFpercentage").value);

    aflParameterValues.forEach(valueObj => {
        totalACR += parseFloat(valueObj["Annual Coal Requirement"]);
        totalQuantityLinkedCoal += parseFloat(valueObj["Quantity of Linked Coal"]);
        totalQuantityAlternateFuel += parseFloat(valueObj["Quantity of Alternate Fuel"]);
        totalWeightedGCVLinkedCoal += parseFloat(valueObj["GCV of Linked Coal"]) * parseFloat(valueObj["Quantity of Linked Coal"]);
        totalWeightedCostLinkedCoal += parseFloat(valueObj["Landed Cost of Linked Coal"]) * parseFloat(valueObj["Quantity of Linked Coal"]);
        totalWeightedGCVAlternateFuel += parseFloat(valueObj["GCV of Alternate Fuel"]) * parseFloat(valueObj["Quantity of Alternate Fuel"]);
        totalWeightedCostAlternateFuel += parseFloat(valueObj["Landed Cost of Alternate Fuel"]) * parseFloat(valueObj["Quantity of Alternate Fuel"]);
        totalAdditionalFinancialLiability += parseFloat(valueObj["Additional Financial Liability for using Alternate Fuel"]);
    });

    totalWeightedGCVLinkedCoal /= totalQuantityLinkedCoal;
    totalWeightedCostLinkedCoal /= totalQuantityLinkedCoal;
    totalWeightedGCVAlternateFuel /= totalQuantityAlternateFuel;
    totalWeightedCostAlternateFuel /= totalQuantityAlternateFuel;

    const units = ['', 'Lakh MT', '%', 'Lakh MT', 'Lakh MT', 'Rs./M.Cal.', 'kcal/kg', 'Rs./M.Cal.', 'kcal/kg', 'Rs. Crore'];

    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Additional Financial Liability of using Alternate Fuel", 25, 25);

    const tableData = [];
    const parameterNames = Object.keys(aflParameterValues[0]);
    const header = parameterNames.filter(name => name !== 'Plant Name');
    tableData.push(['Plant Name', ...header]);

     // Add units below the header
     tableData.push(units);

    aflParameterValues.forEach(valueObj => {
        const rowData = [valueObj['Plant Name']];
        header.forEach(parameter => {
            rowData.push(valueObj[parameter]);
        });
        tableData.push(rowData);
    });

    const totalRow = ['Total', totalACR.toFixed(2), afPercentage.toFixed(2), totalQuantityLinkedCoal.toFixed(2), totalQuantityAlternateFuel.toFixed(2), totalWeightedCostLinkedCoal.toFixed(2), totalWeightedGCVLinkedCoal.toFixed(2), totalWeightedCostAlternateFuel.toFixed(2), totalWeightedGCVAlternateFuel.toFixed(2), totalAdditionalFinancialLiability.toFixed(2)];
    tableData.push(totalRow);


    const transposedTable = tableData[0].map((_, colIndex) => tableData.map((row) => row[colIndex]));

    const boldTotalRow = transposedTable.length - 1;

    const columnStyles = {
        0: { cellwidth:30, halign: 'left' },
        1: { halign: 'center' },
        2: { halign: 'center' },
        3: { halign: 'center' },
        4: { halign: 'center' },
        5: { halign: 'center' },
        6: { halign: 'center' },
        7: { halign: 'center' },
        8: { halign: 'center' },
        9: { halign: 'center' },
        10: { halign: 'center' },
    };

    const boldFont = boldTotalRow === transposedTable.length - 1 ? { fontStyle: 'bold' } : { fontStyle: 'normal' };

    doc.autoTable({
        startY: 40,
        head: [transposedTable[0]], // Use the header
        body: transposedTable.slice(1), // Start from the 3rd row to exclude units in the table display
        theme: 'grid',
        tableWidth: 'auto',
        margin: { top: 15 },
        columnStyles: columnStyles, // Apply column styles to the table
        didDrawCell: (data) => {
            if (data.row.index === boldTotalRow) {
                data.cell.styles.fontStyle = 'bold';
            }
        },
    });

    doc.save('AdditionalFinancialLiabilityHistory.pdf', {
        returnPromise: true,
    }).then(() => {
        $('#additionalFinancialLiabilityTab').collapse('show');
    });
}




// Add an event listener to the checkbox
const copyValuesCheckbox = document.getElementById('copyValuesCheckbox');

// Add an event listener to the checkbox
copyValuesCheckbox.addEventListener('change', function () {
    // Check if the checkbox is checked
    if (this.checked) {
        // Copy values from the previous row
        copyValuesFromPreviousRow();
    }
});


// Function to copy values from the previous row
function copyValuesFromPreviousRow() {
    
    const rows = coalTableBody.querySelectorAll('tr');

    // Start from the second row, as there is no previous row for the first row
    for (let i = 1; i < rows.length; i++) {
        const currentRow = rows[i];
        const previousRow = rows[i - 1];

        // Iterate through input cells and copy values
        for (let j = 0; j < 4; j++) { // Assuming the first 5 input cells are the ones you want to copy
            const currentInput = currentRow.querySelectorAll('input')[j];
            const previousInput = previousRow.querySelectorAll('input')[j];

            currentInput.value = previousInput.value;
        }
    }
    calculateCoalUnitsGenerated();
                    calculateCoalConsumption();
                    calculateClosingStock();
                    updateTotals(); // Update the total row
                    updateAllMonths();getNextMonth();
                    checkForNegativeClosingStock();
}

//  'coalClearValuesBtn' is button to clear values
const coalClearValuesBtn = document.getElementById('clearValuesBtn');

// Add an event listener to the "Clear Values" button
coalClearValuesBtn.addEventListener('click', function () {
    // Ask for confirmation before clearing values
    const confirmation = confirm('Are you sure you want to clear all values?');
    
    if (confirmation) {
        // Call the function to clear values in the coalTableBody
        clearValuesInCoalTableBody();
    }
});

// Function to clear all values in the coalTableBody
function clearValuesInCoalTableBody() {
    // Get all input elements in the coalTableBody
    const inputElements = coalTableBody.querySelectorAll('input');

    // Iterate through input elements and clear values
    inputElements.forEach(input => {
        input.value = '';
    });

    // Add any additional logic or actions you want after clearing values
    // For example, you might want to recalculate totals or perform other updates
    calculateCoalUnitsGenerated();
    calculateCoalConsumption();
    calculateClosingStock();
    updateTotals();
    updateAllMonths();
    checkForNegativeClosingStock();
}




// Add an event listener to the button
const clearSourceValuesBtn = document.getElementById('clearSourceValuesBtn');

clearSourceValuesBtn.addEventListener('click', () => {
    // Ask for confirmation before clearing values
    const confirmation = confirm('Are you sure you want to clear all values in the source table?');

    if (confirmation) {
        // Call the function to clear values in the source table body
        clearValuesInTableBody(coalSourceTableBody);
    }
});

// Function to clear values in the table body
function clearValuesInTableBody(tableBody) {
    // Get all rows in the table body
    const rows = tableBody.querySelectorAll('tr');

    // Iterate through each row and clear values
    rows.forEach(row => {
        // Iterate through input cells and clear values
        const inputCells = row.querySelectorAll('td[contenteditable="true"]');
        inputCells.forEach(cell => {
            cell.textContent = '';
        });
    });

    // Add additional actions or calculations if needed
    // For example, you can call relevant functions or perform other actions here
    updateTotal();
    updateTotals();
    updateTotals2();
    //updateTotalsourcerow();
}




// Get the table body element and the "Add Month" button
    const coalTableBody = document.querySelector('#tbody');
        const coalAddRowBtn = document.getElementById('addRowBtn');
        let monthName='January';
        enforcePLFMax100();
        // Function to create a new row with input fields and add a "Remove" button
        function addCoalRow() {
            
            // Create a new table row
            const coalRow = document.createElement('tr');
          
            // Create month select cell
            const coalMonthCell = createSelectCell();

  coalRow.appendChild(coalMonthCell);

            // Enable the month select for the first row
            if (coalTableBody.rows.length === 0) {
    const firstMonthSelect = coalMonthCell.querySelector('select');
    // Set to current month (1-based: Jan=1, Feb=2, ..., Dec=12)
    const currentMonth = new Date().getMonth() + 1;
    firstMonthSelect.value = currentMonth;
    firstMonthSelect.disabled = false;
} else {
    const previousRow = coalTableBody.rows[coalTableBody.rows.length - 1];
    const previousMonthSelect = previousRow.querySelector('select');
    const nextMonthSelect = coalMonthCell.querySelector('select');
    nextMonthSelect.value = getNextMonth(parseInt(previousMonthSelect.value));
    nextMonthSelect.disabled = true; // Disable the new row's month select
}
    // Find the last month select input in the table
    const lastMonthSelect = coalTableBody.querySelector('tr:nth-child(1) select');

    // Calculate the next month based on the last selected month
    const nextMonth = lastMonthSelect ? getNextMonth(parseInt(lastMonthSelect.value)) : (new Date().getMonth() + 1);

    // Set the calculated next month as the selected month in the new row
    coalMonthCell.querySelector('select').value = nextMonth;

    

    const inputStyles = {
    width: '100px',
    fontSize: '12px',
    fontStyle: 'bold',
    backgroundColor: 'lightgreen',
    color: 'black',
    border: '1px solid #ccc', // Add a border
    borderRadius: '5px', // Add rounded corners
    padding: '8px', // Add padding
    margin: '4px', // Add margin
    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)', // Add a subtle box shadow
    min: 0,
    step: '0.01',
    // Add more styles as needed
};

            // Create input cells
            const coalCapacityCell = createInputCell('number',inputStyles);
            const coalPlfCell = createInputCell('number',inputStyles);
            const coalSccCell = createInputCell('number',inputStyles);
            const coalAvailableCell = createInputCell('number',inputStyles);
            const coalOpeningStockCell = createInputCell('number',inputStyles);

            // Set step="0.05" for PLF and Specific Coal Consumption inputs
            coalPlfCell.querySelector('input').setAttribute('step', '0.01');
            coalSccCell.querySelector('input').setAttribute('step', '0.01');

            // Prevent negative values for all relevant input fields
                [
                    coalCapacityCell,
                    coalPlfCell,
                    coalSccCell,
                    coalAvailableCell,
                    coalOpeningStockCell
                ].forEach(cell => {
                    const input = cell.querySelector('input');
                    input.addEventListener('input', function () {
                        if (parseFloat(this.value) < 0) {
                            this.value = 0;
                        }
                    });
            });

            // Create output cells
            const coalUnitsGeneratedCell = createSpanCell('number', '0');
            const coalCoalConsumptionCell = createSpanCell('number', '0');
            const coalClosingStockCell = createSpanCell('number', '0'); // Initialize with 0
            const coalStockInDaysCell = createSpanCell('number', '0'); // Initialize with 0

            
            // Create action cell with "Remove" button
            const coalActionCell = document.createElement('td');
            const coalRemoveBtn = document.createElement('button');
            coalRemoveBtn.innerHTML = '<i class="bi bi-trash"></i>';
            coalRemoveBtn.className = 'btn btn-danger btn-sm';
            coalRemoveBtn.dataset.month = monthName;
            
            // Disable the remove button for the first row
    if (coalTableBody.rows.length === 0) {
        coalRemoveBtn.disabled = true;
    }

            coalRemoveBtn.addEventListener('click', () => {

                // Get the month name from the data attribute
    const monthToRemove = coalRemoveBtn.dataset.month;
    // Call a function to remove the row from the new table
    
                // Ask for confirmation before removing the row
                const confirmation = confirm('Are you sure you want to remove this month?');
                if (confirmation) 
                {
                    // Remove the corresponding row when the user confirms
                    coalRow.remove();
                    removeMonthRowFromCoalSources(monthToRemove);
                    syncTableRows();
                    calculateCoalUnitsGenerated();
                    calculateCoalConsumption();
                    calculateClosingStock();
                    updateTotals(); // Update the total row
                    updateAllMonths();getNextMonth();
                    checkForNegativeClosingStock();updateTotals2(); 
                    // Recalculate Units Generated, Coal Consumption, and Closing Coal Stock for remaining scenarios
                    
                     // Ensure the first row's month select remains enabled
                    const firstMonthSelect = coalTableBody.querySelector('tr:first-child select');
                    if (firstMonthSelect) {
                    firstMonthSelect.disabled = false;                  
                    calculateCoalUnitsGenerated();
                    calculateCoalConsumption();
                    calculateClosingStock();
                    updateTotals(); // Update the total row
                    updateAllMonths();getNextMonth();syncTableRows();checkForNegativeClosingStock();updateTotals2();
                    };
                }                 
            });

            coalActionCell.appendChild(coalRemoveBtn);

            // Add a class to the opening coal stock input for easy access
            coalOpeningStockCell.querySelector('input').classList.add('opening-stock-input');

            // Append cells to the row
            coalRow.appendChild(coalCapacityCell);
            coalRow.appendChild(coalPlfCell);
            coalRow.appendChild(coalUnitsGeneratedCell);
            coalRow.appendChild(coalSccCell);
            coalRow.appendChild(coalCoalConsumptionCell);
            coalRow.appendChild(coalAvailableCell);
            coalRow.appendChild(coalOpeningStockCell);
            coalRow.appendChild(coalClosingStockCell);
            coalRow.appendChild(coalStockInDaysCell);
            coalRow.appendChild(coalActionCell);

            // Append the row to the table body
            coalTableBody.appendChild(coalRow);
            enforcePLFMax100();
             coalAddRowBtn.addEventListener('click', function () {
    // Check if the copyQuantityCheckbox is checked
    const copyQuantityCheckbox = document.getElementById('copyQuantityCheckbox');
    if (copyQuantityCheckbox.checked) {
        // Call the function to copy values from the previous row
        copyQuantityFromPreviousRow(coalSourceTableBody);
    }

});

            // Calculate and update Units Generated, Coal Consumption, and Closing Coal Stock whenever input values or month change
            coalMonthCell.querySelector('select').addEventListener('change', calculateCoalUnitsGenerated);
            coalCapacityCell.querySelector('input').addEventListener('input', calculateCoalUnitsGenerated);
            coalPlfCell.querySelector('input').addEventListener('input', calculateCoalUnitsGenerated);
            coalSccCell.querySelector('input').addEventListener('input', calculateCoalConsumption);
            coalAvailableCell.querySelector('input').addEventListener('input', calculateClosingStock);
            coalOpeningStockCell.querySelector('input').addEventListener('input', calculateClosingStock);

            // Calculate and update Totals when leaving the "Coal Available" cell
            coalAvailableCell.querySelector('input').addEventListener('blur', () => {
                calculateClosingStock();
                updateTotals();
            });

            // Copy the closing coal stock from the previous row to the opening coal stock of the new row
            const previousRow = coalRow.previousElementSibling;
            if (previousRow) {
                const previousClosingStock = previousRow.querySelector('td:nth-child(9) span');
                if (previousClosingStock) {
                    coalOpeningStockCell.querySelector('input').value = previousClosingStock.textContent;
                }
                const previousMonthSelect = previousRow.querySelector('select');
                if (previousMonthSelect) {
                    const currentMonthSelect = coalMonthCell.querySelector('select');
                    currentMonthSelect.value = getNextMonth(previousMonthSelect.value);
                    currentMonthSelect.disabled = true;
                }
            }

            // Initial calculation
            calculateCoalUnitsGenerated();
            calculateCoalConsumption();
            calculateClosingStock();
            updateTotals(); // Update the total row
        }


function enforcePLFMax100() {
    // Select all PLF input fields (3rd column in your table: td:nth-child(3) input)
    const plfInputs = coalTableBody.querySelectorAll('tr td:nth-child(3) input');
    plfInputs.forEach(input => {
        input.addEventListener('input', function () {
            if (parseFloat(this.value) > 100) {
                this.value = 100;
            }
        });
    });
}


// Add an event listener to the "Add Month" button
coalAddRowBtn.addEventListener('click', () => {
   
    // Check if the checkbox is checked and copy values from the previous row
    if (copyValuesCheckbox.checked) {
        copyValuesFromPreviousRow();
    }
    coalAddRowBtn.addEventListener('click', function () {
    // Check if the copyQuantityCheckbox is checked
    const copyQuantityCheckbox = document.getElementById('copyQuantityCheckbox');
    if (copyQuantityCheckbox.checked) {
        // Call the function to copy values from the previous row
        copyQuantityFromPreviousRow(coalSourceTableBody);
    }

});
   
});

        
// Function to remove a month row from the "Coal Availability" table
function removeMonthRowFromCoalSources(monthName) {
    const coalSourcesTableBody = document.getElementById('coalSourcesTableBody');
    const rows = coalSourcesTableBody.querySelectorAll('tr');
    rows.forEach((row) => {
        const monthCell = row.querySelector('td:first-child');
        if (monthCell.textContent === monthName) {
            row.remove();
        }
    });
    updateTotal();syncTableRows();
}

// Function to handle the removal of a month in the "Coal Scenario" table
function handleMonthRemoved(monthName) {
    // Remove the corresponding month row from the "Coal Availability" table
    removeMonthRowFromCoalSources(monthName);syncTableRows();
}

// Add an event listener to the "Remove" buttons in the "Coal Scenario" table
coalTableBody.addEventListener('click', (event) => {
    if (event.target.classList.contains('btn-danger')) {
        const monthCell = event.target.closest('tr').querySelector('td:first-child');
        const monthName = monthCell.textContent;
        handleMonthRemoved(monthName);syncTableRows();
    }
});

        function removeMonthRowFromCoalSources(monthName) {
    const coalSourcesTableBody = document.getElementById('coalSourcesTableBody');
    const rows = coalSourcesTableBody.querySelectorAll('tr');
    rows.forEach((row) => {
        const monthCell = row.querySelector('td:first-child');
       // console.log("2nd table month to remove", monthCell)
        if (monthCell.textContent === monthName) {
            row.remove();
        }
    });
    updateTotal();syncTableRows();
}
        // Function to create a select cell for month
        function createSelectCell() {
            const coalMonthCell = document.createElement('td');
            const coalMonthSelect = document.createElement('select');
            coalMonthSelect.innerHTML = `
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            `;
            coalMonthSelect.className = 'form-control coal-month-select';
            coalMonthCell.appendChild(coalMonthSelect);
            return coalMonthCell;
            calculateCoalUnitsGenerated();
                    calculateCoalConsumption();
                    calculateClosingStock();
                    updateTotals(); // Update the total row
                    updateAllMonths();syncTableRows();
        }

        // Function to create an input cell
        function createInputCell(type, styles) {
            const cell = document.createElement('td');
            const input = document.createElement('input');
            input.type = type;

// Apply inline styles to the input element
if (styles) {
        for (const style in styles) {
            input.style[style] = styles[style];
        }
    }

            cell.appendChild(input);
            return cell;
        }

        // Function to create a span cell
        function createSpanCell(type, initialValue) {
            const cell = document.createElement('td');
            const span = document.createElement('span');
            span.type = type;
            span.textContent = initialValue;
            cell.appendChild(span);
            return cell;
        }

        // Function to calculate Units Generated based on input values and selected month
        function calculateCoalUnitsGenerated() {
            const coalRows = coalTableBody.querySelectorAll('tr');
            coalRows.forEach(coalRow => {
                const coalMonthSelect = coalRow.querySelector('select');
                const coalInputs = coalRow.querySelectorAll('input');
                const coalUnitsGenerated = coalRow.querySelector('span');

                // Get input values and selected month
                const coalGenerationCapacity = parseFloat(coalInputs[0].value) || 0;
                const coalPlf = parseFloat(coalInputs[1].value) || 0;
                const coalSelectedMonth = parseInt(coalMonthSelect.value);

                // Get the number of days in the selected month
                const coalDaysInMonth = new Date(new Date().getFullYear(), coalSelectedMonth, 0).getDate();

                // Compute Units Generated
                const coalUnits = (coalGenerationCapacity * 24 * coalPlf * coalDaysInMonth) / 1000;

                // Display the result in the Units Generated cell
                coalUnitsGenerated.textContent = coalUnits.toFixed(2);
            });
            updateTotals();
        }

        // Function to calculate Coal Consumption based on input values and selected month
        function calculateCoalConsumption() {
            const coalRows = coalTableBody.querySelectorAll('tr');
            coalRows.forEach(coalRow => {
                const coalInputs = coalRow.querySelectorAll('input');
                const coalCoalConsumption = coalRow.querySelector('td:nth-child(6) span'); // Select the sixth column

                // Get input values and calculate Coal Consumption
                const coalGenerationCapacity = parseFloat(coalInputs[0].value) || 0;
                const coalPlf = parseFloat(coalInputs[1].value) || 0;
                const coalScc = parseFloat(coalInputs[2].value) || 0;

                // Get the selected month
                const coalMonthSelect = coalRow.querySelector('select');
                const coalSelectedMonth = parseInt(coalMonthSelect.value);
                const coalDaysInMonth = new Date(new Date().getFullYear(), coalSelectedMonth, 0).getDate();

                // Calculate Units Generated
                const coalUnits = (coalGenerationCapacity * 24 * coalPlf * coalDaysInMonth) / 1000;

                // Calculate Coal Consumption
                const coalConsumed = coalUnits * coalScc * 10;

                // Display the result in the Coal Consumption cell
                coalCoalConsumption.textContent = coalConsumed.toFixed(2);
            });
            updateTotals();
        }

        // Function to calculate Closing Coal Stock based on input values and update the opening stock of the next row
        function calculateClosingStock() {
            const coalRows = coalTableBody.querySelectorAll('tr');
            coalRows.forEach(coalRow => {
                const coalInputs = coalRow.querySelectorAll('input');
                const coalClosingStock = coalRow.querySelector('td:nth-child(9) span'); // Select the ninth column input
                const coalStockInDays = coalRow.querySelector('td:nth-child(10) span'); // Select the tenth column input
                // Get the span element for Coal Consumption
                const coalConsumptionSpan = coalRow.querySelector('td:nth-child(6) span');

                // Get input values
                const coalAvailable = parseFloat(coalInputs[3].value) || 0;
                const coalOpeningStock = parseFloat(coalInputs[4].value) || 0;

                // Get the value of Coal Consumption from the span element
                const coalConsumption = parseFloat(coalConsumptionSpan.textContent).toFixed(2) || 0;

                // Calculate Closing Coal Stock
                const ClosingStock = coalAvailable + coalOpeningStock - coalConsumption;
                //calculate Stock in Days
                const closingStockInDays = ClosingStock / (coalConsumption / 30);

                // Display the result in the Closing Coal Stock input
                coalClosingStock.textContent = ClosingStock.toFixed(2);
                coalStockInDays.textContent = closingStockInDays.toFixed(2);

                // Update the opening stock of the next row
                const nextRow = coalRow.nextElementSibling;
                if (nextRow) {
                    const nextOpeningStockInput = nextRow.querySelector('td:nth-child(8) input');
                    if (nextOpeningStockInput) {
                        nextOpeningStockInput.value = ClosingStock.toFixed(2);
                    }
                }
            });
        }

        // Function to update the total values
        function updateTotals() {
            const totalUnitsGenerated = document.getElementById('total-units-generated');
            const totalCoalConsumption = document.getElementById('total-coal-consumption');
            const totalCoalAvailable = document.getElementById('total-coal-available'); // Add this line

            // Calculate the total values based on the values in the table
            let totalUnits = 0;
            let totalConsumption = 0;
            let totalAvailable = 0; // Updated to include Coal Available

            const coalRows = coalTableBody.querySelectorAll('tr');
            coalRows.forEach(coalRow => {
                const coalInputs = coalRow.querySelectorAll('input');

                // Get input values for Units Generated, Coal Consumption
                const unitsGenerated = parseFloat(coalRow.querySelector('td:nth-child(4) span').textContent) || 0;
                const consumption = parseFloat(coalRow.querySelector('td:nth-child(6) span').textContent) || 0;

                // Get input value for Coal Available
                const available = parseFloat(coalInputs[3].value) || 0;

                totalUnits += unitsGenerated;
                totalConsumption += consumption;
                totalAvailable += available; // Updated to include Coal Available
            });

            // Update the total values in the Total Row
            totalUnitsGenerated.textContent = totalUnits.toFixed(2);
            totalCoalConsumption.textContent = totalConsumption.toFixed(2);
            totalCoalAvailable.textContent = totalAvailable.toFixed(2); // Update the total Coal Available
        }

        // Add an initial row
        addCoalRow();

        // Add a new row when the "Add Month" button is clicked
        coalAddRowBtn.addEventListener('click', addCoalRow);

        // Add a general event listener to all input cells for automatic recalculation
        coalTableBody.addEventListener('input', () => {
            // Recalculate all rows whenever any input changes
            recalculateAllRows();
        });


// Add an event listener to the first row's month select element
const firstRowMonthSelect = coalTableBody.querySelector('tr:first-child select');
firstRowMonthSelect.addEventListener('change', () => {
    updateAllMonths();
});

// Function to update the months in all rows
function updateAllMonths() {
    const rows = coalTableBody.querySelectorAll('tr');
    const newTableRows = coalSourcesTableBody.querySelectorAll('tr');
    let nextMonth = parseInt(firstRowMonthSelect.value);

    // Iterate through all rows and update the months
    rows.forEach((row, index) => {
        const monthSelect = row.querySelector('select');
        monthSelect.value = nextMonth;
        
        // Update months in the new table rows
        if (newTableRows[index]) {
            const newTableMonthCell = newTableRows[index].querySelector('td:first-child');
            newTableMonthCell.textContent = getMonthName(nextMonth);
        }

        nextMonth = getNextMonth(nextMonth);
    });checkForNegativeClosingStock(); calculateNegativeStockDate();
    
}

// Function to get the name of the month from its number
function getMonthName(monthNumber) {
    const months = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    return months[monthNumber - 1];
}

// Variable to store the original negative stock date
let originalNegativeStockDate = null;

// Function to calculate negative stock date based on your formula
function calculateNegativeStockDate(month, openingStock, coalUnitsGenerated, coalScc, coalAvailable) {
    // Check if the opening stock is already negative
    if (openingStock < 0) {
        return null;
    }

    const daysInMonth = new Date(new Date().getFullYear(), month, 0).getDate();
    const coalRequirementPerDay = (coalUnitsGenerated * coalScc * 10) / daysInMonth;

    // Assuming coalAvailable is the monthly value
    const coalAvailablePerDay = coalAvailable / daysInMonth;

    for (let day = 1; day <= daysInMonth; day++) {
        const closingStockDateCheck = openingStock + (coalAvailablePerDay - coalRequirementPerDay);
        openingStock = closingStockDateCheck;

        if (closingStockDateCheck < 0) {
            const negativeStockDate = new Date(new Date().getFullYear(), month - 1, day);         
                originalNegativeStockDate = negativeStockDate;
                return originalNegativeStockDate;
           
        }
    }

    return null;
}

document.getElementById('daysToMaintainStock').addEventListener('input', function() {
    checkForNegativeClosingStock(); // or your calculation function
});

function checkForNegativeClosingStock() {
    const coalRows = coalTableBody.querySelectorAll('tr');
    let negativeStockDetected = false;
    let negativeStockDate = null;
    let addCoalReqToAviodNegaStock = 0;
    let addCoalReqToBuildTenDaysStock = 0;

    coalRows.forEach(coalRow => {
        calculateCoalUnitsGenerated(coalRow);
        calculateCoalConsumption(coalRow);
        calculateClosingStock(coalRow);

        const coalClosingStock = coalRow.querySelector('td:nth-child(9) span');
        const closingStock = parseFloat(coalClosingStock.textContent);
        const coalconsumptionlastMonth = coalRow.querySelector('td:nth-child(6) span');
        const coalConsumptionlastMonthvalue = parseFloat(coalconsumptionlastMonth.textContent) || 0;
        if (closingStock < 0) {
            negativeStockDetected = true;

            // Get input values
            const coalMonthSelect = coalRow.querySelector('select');
            const month = parseInt(coalMonthSelect.value);
            const openingStockInput = coalRow.querySelector('td:nth-child(8) input');
            const openingStock = parseFloat(openingStockInput.value);
            const coalAvailableInput = coalRow.querySelector('td:nth-child(7) input');
            const coalAvailable = parseFloat(coalAvailableInput.value);
            const coalSccInput = coalRow.querySelector('td:nth-child(5) input');
            const coalScc = parseFloat(coalSccInput.value);
            const coalUnitsGenerated = parseFloat(coalRow.querySelector('td:nth-child(4) span').textContent);
            console.log('coalUnitsGenerated:', coalUnitsGenerated);

            // Get the number of months from the number of rows in the table
            const tableBody = document.getElementById('tbody');
            const rows = tableBody.querySelectorAll('tr');
            const numberofmonths = rows.length;
            // Get the last row
            //const lastRow = rows[rows.length - 1];

            // Assuming TotalCoalRequired and TotalCoalAvailable are in specific columns, e.g., 2nd and 3rd (index 1 and 2)
            // Adjust the indices as per your table structure
           // const TotalCoalRequired = parseFloat(lastRow.querySelectorAll('td')[5].textContent) || 0;
           // const TotalCoalAvailable = parseFloat(lastRow.querySelectorAll('td')[6].textContent) || 0;
          //  const LastMonthCoalCons = parseFloat(lastRow.querySelectorAll('td')[5].textContent) || 0;

           // console.log('TotalCoalRequired:', TotalCoalRequired);
           // console.log('TotalCoalAvailable:', TotalCoalAvailable);

            const daysInMonth = new Date(new Date().getFullYear(), month, 0).getDate();
            // Get the value from the input box
            const daysToMaintainStock = parseInt(document.getElementById('daysToMaintainStock').value, 10) || 10;

            const coalConsumption = (coalUnitsGenerated * coalScc * 10);
            addCoalReqToAviodNegaStock = ((coalConsumption - coalAvailable - openingStock)/daysInMonth)*30/(numberofmonths*daysInMonth);
            addCoalReqPerMonthToAviodNegaStock = addCoalReqToAviodNegaStock*daysInMonth;
            // Calculate additional coal required to build up 10 days stock
            if (numberofmonths > 0) {
        const lastRow = rows[rows.length-1];
        console.log('lastRow:', lastRow);
        const cells = lastRow.querySelectorAll('td');
        // Adjust the indices below to match your table structure
        const closingcoalstock_of_last_row = getNumericCellValue(cells[9]); // e.g., 10th column
        const LastMonthCoalCons = getNumericCellValue(cells[6]); // e.g., 7th column
        console.log('closingcoalstock_of_last_row:', closingcoalstock_of_last_row);
        console.log('LastMonthCoalCons:', LastMonthCoalCons);
        // Calculate additional coal required to build up 10 days stock
        addCoalReqToBuildTenDaysStockperday = (((coalConsumptionlastMonthvalue / daysInMonth * daysToMaintainStock) - closingStock)/numberofmonths)/daysInMonth;
        addCoalReqToBuildTenDaysStockpermonth = (((coalConsumptionlastMonthvalue / daysInMonth * daysToMaintainStock) - closingStock)/numberofmonths);


        console.log('closingStock:', closingStock);
        console.log('coalConsumptionlastMonthvalue:', coalConsumptionlastMonthvalue);
        console.log('numberofmonths:', numberofmonths);
    }

            //const coalRequirement = (coalUnitsGenerated * coalScc * 10) / 30; // Assuming 30 days in a month

            console.log('daysinmonth:', daysInMonth);
            console.log('units generated:', coalUnitsGenerated);
            console.log('scc:', coalScc);
            console.log('Coal Available:', coalAvailable);
            console.log('Coal consump:', coalConsumption);
            console.log('Opening Stock:', openingStock);
            console.log('adiitonal coal 1 :', addCoalReqToAviodNegaStock);
            console.log('additional coal 2:', addCoalReqToBuildTenDaysStock);
            
            // Calculate the negative stock date using the function
            const date = calculateNegativeStockDate(month, openingStock, coalUnitsGenerated, coalScc, coalAvailable);

           // console.log('Calculated Date:', date);

            if (date) {
                negativeStockDate = date.toDateString();
              //  console.log('Negative Stock Date:', negativeStockDate);
            }return negativeStockDate;
        }
    });

    // Display or hide the warning message with negative stock date
    const closingStockWarning = document.getElementById('closingStockWarning');
    if (negativeStockDetected) {
        closingStockWarning.style.display = 'block';
        //console.log('negative stock date :', negativeStockDate);
       // console.log('adiitonal coal 1 :', addCoalReqToAviodNegaStock);
       // console.log('additional coal 2:', addCoalReqToBuildTenDaysStock);

        closingStockWarning.textContent = `Warning: Coal Stock shall exhaust on: ${negativeStockDate}. 
        Additional coal required to avoid stock out at plant shall be ${addCoalReqToAviodNegaStock.toFixed(2)} MT per day (i.e. ${addCoalReqPerMonthToAviodNegaStock.toFixed(2)} MT per month). Further, to build up coal stock inventory of ${daysToMaintainStock.value} days coal at month end, about ${addCoalReqToBuildTenDaysStockperday.toFixed(2)} MT per day coal (i.e. ${addCoalReqToBuildTenDaysStockpermonth.toFixed(2)} MT per month) shall be required.`;
    } else {
        closingStockWarning.style.display = 'none';
        closingStockWarning.textContent = '';
    }

    updateTotals();
}

// Add an input event listener to continuously check for negative closing stock
coalTableBody.addEventListener('input', () => {
    checkForNegativeClosingStock(); 

// Check if the checkbox is checked and copy values from the previous row
if (copyValuesCheckbox.checked) {
        copyValuesFromPreviousRow();
    }
});
function getNumericCellValue(cell) {
    return parseFloat(cell.textContent.replace(/,/g, '').trim()) || 0;
}
    // Function to recalculate all rows when any input changes
        function recalculateAllRows() {
            const coalRows = coalTableBody.querySelectorAll('tr');
            coalRows.forEach(coalRow => {
                calculateCoalUnitsGenerated(coalRow);
                calculateCoalConsumption(coalRow);
                calculateClosingStock(coalRow);
            });checkForNegativeClosingStock();
            updateTotals(); // Update totals for all rowssyncTableRows();
        }
        // Function to get the next month
        function getNextMonth(currentMonth) {
            return currentMonth % 12 + 1;
        }



// Assuming 'coalsourcetablebody' is your source table body element
const coalSourceTableBody = document.querySelector('#coalSourcesTableBody');

// Add an event listener to the checkbox
const copyQuantityCheckbox = document.getElementById('copyQuantityCheckbox');

// Add an event listener to the checkbox
copyQuantityCheckbox.addEventListener('change', function () {
    // Check if the checkbox is checked
    if (this.checked) {
        // Copy values from the previous row
        copyQuantityFromPreviousRow(coalSourceTableBody);

        
    }
});
// Add an event listener to the "Add Month" button
coalAddRowBtn.addEventListener('click', function () {
    // Check if the copyQuantityCheckbox is checked
    const copyQuantityCheckbox = document.getElementById('copyQuantityCheckbox');
    if (copyQuantityCheckbox.checked) {
        // Call the function to copy values from the previous row
        copyQuantityFromPreviousRow(coalSourceTableBody);
    }

});

// Add input event listeners to relevant input elements
coalSourceTableBody.addEventListener('input', function (event) {
    const target = event.target;
    // Check if the checkbox is checked
    if (copyQuantityCheckbox.checked) {
        // Copy values dynamically when an input changes
        copyValuesDynamically(target);
    }
});

// Function to copy values dynamically when an input changes
function copyValuesDynamically(input) {
    const currentRow = input.closest('tr');
    const currentValue = input.textContent;

    // Iterate through other rows and set the same value in the corresponding input cell
    const rows = coalSourceTableBody.querySelectorAll('tr');
    for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        if (row !== currentRow) {
            const correspondingInput = row.querySelectorAll('td')[input.cellIndex];
            correspondingInput.textContent = currentValue;
        }
    }
}


// Function to copy values from the previous row
function copyQuantityFromPreviousRow(tableBody) {
    const rows = document.querySelectorAll('#coalSourcesTableBody tr');

    // Start from the second row, as there is no previous row for the first row
    for (let i = 1; i < rows.length; i++) {
        const currentRow = rows[i];
        const previousRow = rows[i - 1];
        console.log('current row', currentRow)
        console.log('previous row', previousRow)

        // Iterate through input cells and copy values
        for (let j = 1; j <6; j++) { // Assuming the first 5 input cells are the ones you want to copy
            const currentInput = currentRow.querySelectorAll('td')[j];
            const previousInput = previousRow.querySelectorAll('td')[j];

            console.log('current ip', currentInput)
        console.log('previous ip', previousInput)
        currentInput.textContent = previousInput.textContent;
        }
    }
    // Add additional calculations or updates specific to the coalsourcetablebody
    // For example, you can call relevant functions or perform other actions here
    updateTotal();
    updateTotals();
    updateTotals2();
   // updateTotalsourcerow();
}


















        
        // Add an event listener to all cells in the new table to allow only numbers
  const coalSourcesTableBody = document.getElementById('coalSourcesTableBody');
  const cells = coalSourcesTableBody.querySelectorAll('td:not(:first-child)');
  cells.forEach((cell) => {
    cell.addEventListener('input', restrictToNumbers);})

  // Function to handle the change of month in the "Coal Scenario" table
function handleMonthChange() {
    const firstMonthSelect = coalTableBody.querySelector('tr:first-child select');
    const selectedMonth = firstMonthSelect.value;
    const monthName = firstMonthSelect.options[firstMonthSelect.selectedIndex].text;

    // Update the month in the "Coal Availability" table
    const coalSourcesTableBody = document.getElementById('coalSourcesTableBody');
    const rows = coalSourcesTableBody.querySelectorAll('tr');
    rows.forEach((row) => {
        row.querySelector('td:first-child').textContent = monthName;syncTableRows();
    });
}

// Function to restrict input to numbers only and prevent negative values
function restrictToNumbers(event) {
  const input = event.target;
  let value = input.textContent;
  // Remove any non-numeric characters except dot
  value = value.replace(/[^0-9.]/g, '');
  // Prevent negative values
  if (value !== '' && parseFloat(value) < 0) {
    value = '0';
  }
  input.textContent = value;

  // Move the cursor to the end of the content
  const range = document.createRange();
  const selection = window.getSelection();
  range.selectNodeContents(input);
  range.collapse(false); // Collapse the range to the end
  selection.removeAllRanges();
  selection.addRange(range);

  updateTotals(); // Update totals when the input changes
}
        /// Function to add a month row to the coal sources table
        function addMonthRowToCoalSources(monthName, monthValue) {
            const coalSourcesTableBody = document.getElementById('coalSourcesTableBody');

            // Create a new row
            const newRow = document.createElement('tr');

            // Create a cell for the month
            const monthCell = document.createElement('td');
            monthCell.textContent = monthName;
            newRow.appendChild(monthCell);

            // Create editable cells for coal sources (initially empty)
            for (let i = 0; i < 5; i++) {
                const coalSourceCell = document.createElement('td');
                coalSourceCell.contentEditable = true;
                coalSourceCell.addEventListener('input', updateTotal);
                newRow.appendChild(coalSourceCell);
            }

            // Create a cell for the total (initially 0)
            const totalCell = document.createElement('td');
            totalCell.textContent = '0.00';
            newRow.appendChild(totalCell);

            // Append the new row to the table body
            coalSourcesTableBody.appendChild(newRow);

            // Set the month value (if provided)
            if (monthValue) {
                const monthSelect = newRow.querySelector('td:first-child');
                const selectElement = monthSelect.appendChild(document.createElement('select'));
                selectElement.innerHTML = firstRowMonthSelect.innerHTML;
                selectElement.value = monthValue;
                selectElement.disabled = true;
            }
            // Check if the copyQuantityCheckbox is checked
    const copyQuantityCheckbox = document.getElementById('copyQuantityCheckbox');
    if (copyQuantityCheckbox.checked) {
        // Call the function to copy values from the previous row
        copyQuantityFromPreviousRow(coalSourcesTableBody);
    }
        }

// Attach the updateTotals and restrictToNumbers functions to input and change events
const coalSourcesTable = document.getElementById('coalSourcesTableBody');
coalSourcesTable.addEventListener('input', (event) => {
  restrictToNumbers(event);
  updateTotals();checkForNegativeClosingStock();updateTotal();
});
coalSourcesTable.addEventListener('change', updateTotals);

// Call updateTotals initially to calculate totals for existing data
updateTotals();

        // Function to update the total column when values are entered
        function updateTotal() {
            const rows = document.getElementById('coalSourcesTableBody').querySelectorAll('tr');
            rows.forEach((row) => {
                let total = 0;
                const cells = row.querySelectorAll('td');
                for (let i = 1; i <= 5; i++) {
                    const cell = cells[i];
                    const value = parseFloat(cell.textContent) || 0;
                    total += value;
                }
                cells[6].textContent = total.toFixed(2);
            });
        }

// Function to handle the addition of a month in the first table
function handleMonthAdded(monthName) {
    addMonthRowToCoalSources(monthName);
    updateTotalsourcerow();checkForNegativeClosingStock();
}
        // Function to handle the addition of a month in the first table
        function handleMonthAdded(monthName) {
            addMonthRowToCoalSources(monthName);
            updateTotal();checkForNegativeClosingStock();
        }

// Function to handle the removal of a month in the "Coal Scenario" table
function handleMonthRemoved(monthName) {
    // Remove the corresponding month row from the "Coal Availability" table
    removeMonthRowFromCoalAvailability(monthName);checkForNegativeClosingStock();
}

// Add an event listener to the "Remove" buttons in the "Coal Scenario" table
coalTableBody.addEventListener('click', (event) => {
    if (event.target.classList.contains('btn-danger')) {
        const monthCell = event.target.closest('tr').querySelector('td:first-child');
        const monthName = monthCell.textContent;
        handleMonthRemoved(monthName);
    }
});

        // Function to convert a month name to its numeric representation
        function monthNameToNumber(monthName) {
            const months = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            return months.indexOf(monthName) + 1;
        }

        // Add an event listener to the "Add Month" button
        coalAddRowBtn.addEventListener('click', () => {
            const monthSelect = coalTableBody.querySelector('tr:last-child select');
            const monthName = monthSelect.options[monthSelect.selectedIndex].text;
            handleMonthAdded(monthName);
             // Check if the checkbox is checked and copy values from the previous row
    if (copyValuesCheckbox.checked) {
        copyValuesFromPreviousRow();
    }

        });

        // Add an event listener to the "Remove" buttons in the first table
        coalTableBody.addEventListener('click', (event) => {
            if (event.target.classList.contains('btn-danger')) {
                const monthCell = event.target.closest('tr').querySelector('td:first-child');
                const monthName = monthCell.textContent;
                handleMonthRemoved(monthName);
            }
        });

        // Initialize the new table with the default month
        handleMonthChange();

        // Function to update the totals for both rows and columns
function updateTotals2() {
  const coalSourcesTableBody = document.getElementById('coalSourcesTableBody');
  const rows = coalSourcesTableBody.querySelectorAll('tr');
  
  // Initialize an array to store column totals
  const columnTotals = [0, 0, 0, 0, 0, 0];

  rows.forEach((row) => {
    const cells = row.querySelectorAll('td');
    let rowTotal = 0;

    for (let i = 1; i <= 6; i++) {
      const cell = cells[i];
      const value = parseFloat(cell.textContent) || 0;
      rowTotal += value;
      columnTotals[i - 1] += value;
    }

    // Update the row total cell
    //cells[6].textContent = rowTotal.toFixed(2);
  });

  // Update column totals in the footer
  const totalRow = document.getElementById('totalRow');
  for (let i = 0; i < 6; i++) { // Updated index from 1 to 0 here
    totalRow.cells[i + 1].textContent = columnTotals[i].toFixed(2); // Updated index from i - 1 to i here
  }
}

// Attach the updateTotals function to input and change events
coalSourcesTable.addEventListener('input', updateTotals2);
coalSourcesTable.addEventListener('change', updateTotals2);



// Call updateTotals initially to calculate totals for existing data
updateTotals2();


// Function to copy Coal Availability values from the new table to the first table
function copyCoalAvailabilityToFirstTable() {
  const newTable = document.getElementById('coalSourcesTableBody');
  const firstTable = document.getElementById('tbody');
  const newTableRows = newTable.querySelectorAll('tr');
  const firstTableRows = firstTable.querySelectorAll('tr');

  const coalAvailabilityValues = [];

  // Extract Coal Availability values from the new table (last cell, excluding header and total rows)
  for (let i = 0; i < newTableRows.length; i++) {
    const row = newTableRows[i];            

    const cells = row.querySelectorAll('td');
    const coalAvailabilityCell = cells[cells.length - 1]; // Last cell is the Coal Availability
    coalAvailabilityValues.push(coalAvailabilityCell.textContent);
  }

  // Paste Coal Availability values into the 7th column of the first table
  firstTableRows.forEach((row, index) => {
    if (index < firstTableRows.length) { // Exclude header and total rows
      const cells = row.querySelectorAll('td');
      const coalAvailabilityCell = cells[6]; // 7th position is the Coal Availability column
      coalAvailabilityCell.querySelector('input').value= coalAvailabilityValues[index];
    }
  });
                    calculateClosingStock();
                    updateTotals(); // Update the total row
                    updateAllMonths();getNextMonth();recalculateAllRows();checkForNegativeClosingStock();
}

// Add an event listener to the "Copy Totals" button
const copyTotalsButton = document.getElementById('copyTotalsButton');
copyTotalsButton.addEventListener('click', copyCoalAvailabilityToFirstTable);

// Function to sync the number of rows between the two tables
function syncTableRows() {
    const coalTableBody = document.getElementById('tbody');
    const coalAvailabilityTableBody = document.getElementById('coalSourcesTableBody');
    
    const coalTableRows = coalTableBody.querySelectorAll('tr');
    const coalAvailabilityTableRows = coalAvailabilityTableBody.querySelectorAll('tr');
    
    const coalTableRowCount = coalTableRows.length;
    const coalAvailabilityTableRowCount = coalAvailabilityTableRows.length;
    
    // Check if the "Coal Availability" table has more rows than the "Coal Scenario" table
    if (coalAvailabilityTableRowCount > coalTableRowCount) {
        // Calculate the number of excess rows in the "Coal Availability" table
        const excessRows = coalAvailabilityTableRowCount - coalTableRowCount;
        
        // Remove excess rows from the "Coal Availability" table
        for (let i = 0; i < excessRows; i++) {
            coalAvailabilityTableRows[coalAvailabilityTableRowCount - 1].remove();
        }
    }
    // If the "Coal Scenario" table has more rows than the "Coal Availability" table, no action is taken.
}

// Call the syncTableRows function to synchronize the table rows
syncTableRows();

function generatePDFForCoalScenario() {
    const doc = new jsPDF({
        orientation: 'landscape',
        unit: 'mm',
        format: 'a4',
    });

    let yPosition = 15;
    const monthNamesTable1 = [];
    let firstMonthName = '';
    let lastMonthName = '';

    function getFirstAndLastMonthNames() {
        const table = document.getElementById('Table1');
        for (let i = 1; i < table.rows.length; i++) {
            const cells = table.rows[i].cells;
            if (cells[0].querySelector('select')) {
                const selectedMonthDropdown = cells[0].querySelector('select');
                const selectedIndex = selectedMonthDropdown.selectedIndex;
                if (selectedIndex !== -1) {
                    const selectedMonth = selectedMonthDropdown.options[selectedIndex].textContent;
                    monthNamesTable1.push(selectedMonth);
                    if (i === 1) {
                        firstMonthName = selectedMonth;
                    }
                    if (i === table.rows.length - 2) { // Changed to -2 to fix last month issue
                        lastMonthName = selectedMonth;
                    }
                }
            }
        }
    }

    getFirstAndLastMonthNames();

   
    function generateTableContent(tableId, title) {
        const table = document.getElementById(tableId);
        let year = new Date().getFullYear();

        const headerRow = ['Month'];

        for (let i = 1; i < table.rows[0].cells.length; i++) {
            if (tableId === 'Table1' && i === table.rows[0].cells.length - 1) {
                continue;
            }
            headerRow.push(table.rows[0].cells[i].textContent);
        }

        const content = [headerRow];

        for (let i = 1; i < table.rows.length; i++) {
            const tablelength=table.rows.length-1;
            const row = table.rows[i];
            const cells = row.cells;
            let selectedMonth = 'Invalid Month';

            if (tableId === 'Table1' && cells[0].querySelector('select')) {
                const selectedMonthDropdown = cells[0].querySelector('select');
                const selectedIndex = selectedMonthDropdown.selectedIndex;
                if (selectedIndex !== -1) {
                    selectedMonth = selectedMonthDropdown.options[selectedIndex].textContent;
                }
            } else if (tableId === 'Table2') {
                selectedMonth = monthNamesTable1[i - 1];
            }

            if (i === table.rows.length - 1) {
                selectedMonth = 'TOTAL';
                year='';
                doc.setFontSize(12); // Adjust the font size as needed
        doc.setFontStyle('bold'); // Set the font style to bold
            }

            let encounteredDecember = false;
            const rowContent = [`${selectedMonth}-${year}`];

// Check if December is encountered
if (selectedMonth === 'December') {
        encounteredDecember = true;
    }

    // Increment the year for the next rows after December
    if (encounteredDecember && i <= tablelength) {
        year+=1;
        encounteredDecember = false; // Reset the flag
    }
            for (let j = 1; j < cells.length; j++) {
                if (cells[j].querySelector('input')) {
                    const inputField = cells[j].querySelector('input');
                    rowContent.push(inputField.value);
                } else {
                    rowContent.push(cells[j].textContent);
                }
            }
            content.push(rowContent);
        }

        const tableStyles = {
            theme: 'grid',
            headStyles: { align: 'center' },
            bodyStyles: { align: 'center' },
            styles: {
                lineColor: [0, 0, 0],
                lineWidth: 0.2,
            },
        };

        doc.autoTable({
            head: [content[0]],
            body: content.slice(1),
            startY: yPosition,
            theme: 'striped',
            styles: {
                fontSize: 10,
                overflow: 'linebreak',
            },
            headStyles: { fillColor: [95, 135, 158], halign: 'center' },
            ...tableStyles,
            margin: { top: 20 },
            columnStyles: {
                0: {
                    halign: 'left',
                    tableWidth: 100,
                },
                1: {
                    halign: 'center',
                    tableWidth: 100,
                },
                2: {
                    halign: 'center',
                    tableWidth: 100,
                },
                3: {
                    halign: 'center',
                    tableWidth: 100,
                },
                4: {
                    halign: 'center',
                    tableWidth: 100,
                },
                5: {
                    halign: 'center',
                    tableWidth: 100,
                },
                6: {
                    halign: 'center',
                    tableWidth: 100,
                },
                7: {
                    halign: 'center',
                    tableWidth: 100,
                },
                8: {
                    halign: 'center',
                    tableWidth: 100,
                },
            },
        });

        const headingStyle = {
            fontSize: 14,
            textColor: [0, 0, 0],
        };
        doc.setFontSize(headingStyle.fontSize);
        doc.setTextColor(headingStyle.textColor[0], headingStyle.textColor[1], headingStyle.textColor[2]);

        doc.text(15, yPosition - 5, title);

        yPosition = doc.autoTable.previous.finalY + 20;
    }

    const powerplantName = document.getElementById('powerplantName').value;

    const year = new Date().getFullYear();
    const firstmonthforpdf = [`${firstMonthName}-${year}`];
    const lastmonthforpdf = [`${lastMonthName}-${year}`];
    if(firstMonthName==lastMonthName){ generateTableContent('Table1', 'Coal Scenario at ' + powerplantName + ' during ' + firstmonthforpdf +  ' shall be as under:');

yPosition = doc.autoTable.previous.finalY + 20;

generateTableContent('Table2', 'Envisaged Coal Availability at ' + powerplantName + ' during ' + firstmonthforpdf + ' is under:');
}else{

    generateTableContent('Table1', 'Coal Scenario at ' + powerplantName + ' from ' + firstmonthforpdf + ' to ' + lastmonthforpdf + ' shall be as under:');

    yPosition = doc.autoTable.previous.finalY + 20;

    generateTableContent('Table2', 'Envisaged Coal Availability at ' + powerplantName + ' from ' + firstmonthforpdf + ' to ' + lastmonthforpdf + ' is under:');
    
}
    // Calculate the Negative Stock Warning message
    const warningText = getNegativeStockDate();
    
    var comments = document.querySelector("#coalScenarioComments textarea").value;


    if (warningText) {
    // Set the font size and color for warning text
    doc.setFontSize(14); // Adjust the font size as needed
    doc.setTextColor(255, 0, 0); // Set text color to red

    doc.text(15, yPosition - 5, 'Coal Stock at ' + powerplantName + ' will exhaust on: ' + warningText);

    // Reset the font size and color for subsequent content
    doc.setFontSize(10); // Reset font size to the default
    doc.setTextColor(0, 0, 0); // Reset text color to black

    yPosition = doc.autoTable.previous.finalY + 30;

    // Check if there are comments before adding them to the PDF
    if (comments) {
        // Set the font size and color for comments
        doc.setFontSize(14); // Adjust the font size as needed
        doc.setTextColor(0, 0, 0); // Set text color to black
        doc.setFontStyle('italic'); // Set the font style to Italic

        doc.text(15, yPosition - 5, 'Comments: ' + comments);

        // Reset the font size and color for subsequent content
        doc.setFontSize(10); // Reset font size to the default
        doc.setTextColor(0, 0, 0); // Reset text color to black

        yPosition = doc.autoTable.previous.finalY + 20;
    }
}

// Save the PDF
doc.save('CoalScenario.pdf');
}

// Add this function to calculate and get the negative stock date
function getNegativeStockDate() {
    const coalRows = coalTableBody.querySelectorAll('tr');
    let negativeStockDate = null;

    coalRows.forEach(coalRow => {
        calculateCoalUnitsGenerated(coalRow);
        calculateCoalConsumption(coalRow);
        calculateClosingStock(coalRow);

        const coalClosingStock = coalRow.querySelector('td:nth-child(9) span');
        const closingStock = parseFloat(coalClosingStock.textContent);

        if (closingStock < 0) {
            const coalMonthSelect = coalRow.querySelector('select');
            const month = parseInt(coalMonthSelect.value);
            const openingStockInput = coalRow.querySelector('td:nth-child(8) input');
            const openingStock = parseFloat(openingStockInput.value);
            const coalAvailableInput = coalRow.querySelector('td:nth-child(7) input');
            const coalAvailable = parseFloat(coalAvailableInput.value);
            const coalSccInput = coalRow.querySelector('td:nth-child(5) input');
            const coalScc = parseFloat(coalSccInput.value);
            const coalUnitsGenerated = parseFloat(coalRow.querySelector('td:nth-child(4) span').textContent);

            const date = calculateNegativeStockDate(month, openingStock, coalUnitsGenerated, coalScc, coalAvailable);

            if (date) {
                negativeStockDate = date.toDateString();
            }
        }
    });

    return negativeStockDate;
}

// Update the HTML to display the warning message
const closingStockWarning = document.getElementById('closingStockWarning');





</script>
</body>
</html>
